webpackJsonp([29],{0:function(module,exports,__webpack_require__){"use strict";var _stringify=__webpack_require__(99);var _stringify2=_interopRequireDefault(_stringify);var _index=__webpack_require__(1);var _index2=_interopRequireDefault(_index);__webpack_require__(5);__webpack_require__(245);__webpack_require__(441);__webpack_require__(224);__webpack_require__(247);__webpack_require__(246);var _tinymce=__webpack_require__(1711);var _tinymce2=_interopRequireDefault(_tinymce);var _rest=__webpack_require__(1712);var _rest2=_interopRequireDefault(_rest);var _interceptor=__webpack_require__(1713);var _interceptor2=_interopRequireDefault(_interceptor);var _main=__webpack_require__(1714);var _main2=_interopRequireDefault(_main);var _chapterComponent=__webpack_require__(1715);var _chapterComponent2=_interopRequireDefault(_chapterComponent);var _chapter=__webpack_require__(1716);var _chapter2=_interopRequireDefault(_chapter);var _chapter3=__webpack_require__(1718);var _chapter4=_interopRequireDefault(_chapter3);var _noChapterComponent=__webpack_require__(1719);var _noChapterComponent2=_interopRequireDefault(_noChapterComponent);var _newChapterComponent=__webpack_require__(1720);var _newChapterComponent2=_interopRequireDefault(_newChapterComponent);var _editChapterComponent=__webpack_require__(1721);var _editChapterComponent2=_interopRequireDefault(_editChapterComponent);var _moveChapterComponent=__webpack_require__(1722);var _moveChapterComponent2=_interopRequireDefault(_moveChapterComponent);var _duplicateChapterComponent=__webpack_require__(1723);var _duplicateChapterComponent2=_interopRequireDefault(_duplicateChapterComponent);var _notFoundPartial=__webpack_require__(1724);var _notFoundPartial2=_interopRequireDefault(_notFoundPartial);var _treeComponent=__webpack_require__(1725);var _treeComponent2=_interopRequireDefault(_treeComponent);var _tree=__webpack_require__(1726);var _tree2=_interopRequireDefault(_tree);var _tree3=__webpack_require__(1727);var _tree4=_interopRequireDefault(_tree3);var _alertsPartial=__webpack_require__(1728);var _alertsPartial2=_interopRequireDefault(_alertsPartial);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}_index2.default.element(document).ready(function(){_index2.default.bootstrap(_index2.default.element(document).find("body")[0],["LessonModule"],{strictDi:true})});_index2.default.module("LessonModule",["ui.bootstrap","ngRoute","ui.tinymce","ui.tree","angular-loading-bar"]).service("tinyMceConfig",_tinymce2.default).service("restService",_rest2.default).factory("restInterceptor",["$location","Alerts",function($location,Alerts){return new _interceptor2.default($location,Alerts)}]).factory("lessonModal",["$uibModal",function($modal){return{open:function open(template,scope){return $modal.open({template:template,scope:scope})}}}]).factory("Alerts",function(){return[]}).factory("Chapter",function(){return new _chapter4.default}).service("Tree",_tree4.default).controller("mainController",_main2.default).controller("chapterController",_chapter2.default).controller("treeController",_tree2.default).directive("noChapter",function(){return{controllerAs:"cc",controller:"chapterController",template:_noChapterComponent2.default}}).directive("lessonAlerts",function(){return{restrict:"E",template:_alertsPartial2.default}}).directive("lessonTree",function(){return{restrict:"E",controllerAs:"vm",controller:"treeController",template:_treeComponent2.default}}).directive("confirmDiscardChanges",function(){return{restrict:"A",require:"form",link:function link($scope,element,attrs,controller){$scope.$on("$locationChangeStart",function(event,next,current){if(controller.$dirty&&!controller.$submitted){if(!window.confirm(Translator.trans("unsaved_changes","icap_lesson"))){event.preventDefault()}}})}}}).directive("giveFocus",["$timeout",function($timeout){return{restrict:"A",link:function link($scope,element,attrs,controller){$timeout(function(){element[0].focus()})}}}]).filter("trans",function(){return function(string){var domain=arguments.length>1&&arguments[1]!==undefined?arguments[1]:"icap_lesson";return Translator.trans(string,domain)}}).filter("trustedHtml",["$sce",function($sce){return function(text){return $sce.trustAsHtml(text)}}]).filter("prettyJSON",function(){return function(json){return(0,_stringify2.default)(json,null," ")}}).config(["$routeProvider","$httpProvider",function($routeProvider,$httpProvider){$routeProvider.when("/",{template:_chapterComponent2.default,controllerAs:"vm",controller:"chapterController"}).when("/new",{template:_newChapterComponent2.default,controllerAs:"vm",controller:"chapterController"}).when("/:slug",{template:_chapterComponent2.default,controllerAs:"vm",controller:"chapterController"}).when("/:slug/new",{template:_newChapterComponent2.default,controllerAs:"vm",controller:"chapterController"}).when("/:slug/edit",{template:_editChapterComponent2.default,controllerAs:"vm",controller:"chapterController"}).when("/:slug/move",{template:_moveChapterComponent2.default,controllerAs:"vm",controller:"chapterController"}).when("/:slug/duplicate",{template:_duplicateChapterComponent2.default,controllerAs:"vm",controller:"chapterController"}).when("/error/404",{template:_notFoundPartial2.default}).otherwise("/");$httpProvider.interceptors.push("restInterceptor")}])},1711:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _keys=__webpack_require__(179);var _keys2=_interopRequireDefault(_keys);var _classCallCheck2=__webpack_require__(13);var _classCallCheck3=_interopRequireDefault(_classCallCheck2);var _createClass2=__webpack_require__(14);var _createClass3=_interopRequireDefault(_createClass2);var _weakMap=__webpack_require__(254);var _weakMap2=_interopRequireDefault(_weakMap);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var _tinymce=new _weakMap2.default;var _lessonData=new _weakMap2.default;var tinyMceConfig=function(){function tinyMceConfig(lessonData){(0,_classCallCheck3.default)(this,tinyMceConfig);_tinymce.set(this,window.tinymce);_tinymce.get(this).claroline.init=_tinymce.get(this).claroline.init||{};_tinymce.get(this).claroline.plugins=_tinymce.get(this).claroline.plugins||{};_lessonData.set(this,lessonData);this._setFromTinymceConfiguration(_tinymce.get(this).claroline.configuration);this._setPluginsToolbarAndFormat();this._configurationOverrides();this._hacks()}(0,_createClass3.default)(tinyMceConfig,[{key:"_setPluginsToolbarAndFormat",value:function _setPluginsToolbarAndFormat(){var plugins=["autoresize advlist autolink lists link image charmap print preview hr anchor pagebreak","searchreplace wordcount visualblocks visualchars fullscreen","insertdatetime media nonbreaking save table directionality","template paste textcolor emoticons code -accordion -codemirror"];var toolbar1="bold italic underline strikethrough | alignleft aligncenter alignright alignjustify | fullscreen displayAllButtons";var tinyPlugins=_tinymce.get(this).claroline.plugins;(0,_keys2.default)(tinyPlugins).forEach(function(key){var value=tinyPlugins[key];if("autosave"!=key&&value===true){plugins.push(key);toolbar1+=" "+key}});this.plugins=plugins;this.toolbar1=toolbar1}},{key:"_setFromTinymceConfiguration",value:function _setFromTinymceConfiguration(config){var _this=this;angular.forEach(config,function(value,key){_this[key]=value})}},{key:"_configurationOverrides",value:function _configurationOverrides(){this.content_css=_lessonData.get(this).tinymceStylesheets;this.autoresize_max_height=false}},{key:"_hacks",value:function _hacks(){this.setup=function(ed){ed.on("init",function(event){var oldApply=ed.formatter.apply;ed.formatter.apply=function apply(name,vars,node){oldApply(name,vars,node);ed.fire("ExecCommand",{name:name,vars:vars})}})}}}]);return tinyMceConfig}();exports.default=tinyMceConfig;tinyMceConfig.$inject=["lesson.data"]},1712:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _classCallCheck2=__webpack_require__(13);var _classCallCheck3=_interopRequireDefault(_classCallCheck2);var _createClass2=__webpack_require__(14);var _createClass3=_interopRequireDefault(_createClass2);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var RestService=function(){function RestService($http,$q){(0,_classCallCheck3.default)(this,RestService);this.$http=$http;this.$q=$q}(0,_createClass3.default)(RestService,[{key:"getTree",value:function getTree(lesson){var _this=this;var url=Routing.generate("icap_lesson_api_get_tree",{lesson:lesson});return this.$http.get(url).then(function(response){return response.data},function(reason){return _this.$q.reject(reason)})}},{key:"getChapterList",value:function getChapterList(lesson){var _this2=this;var url=Routing.generate("icap_lesson_api_get_chapter_list",{lesson:lesson});return this.$http.get(url).then(function(response){return response.data},function(reason){return _this2.$q.reject(reason)})}},{key:"getDefaultChapter",value:function getDefaultChapter(lesson){var _this3=this;var url=Routing.generate("icap_lesson_api_get_default_chapter",{lesson:lesson});return this.$http.get(url).then(function(response){return response.data},function(reason){return _this3.$q.reject(reason)})}},{key:"getChapter",value:function getChapter(lesson,slug){var _this4=this;var url=Routing.generate("icap_lesson_api_view_chapter",{lesson:lesson,chapter:slug});return this.$http.get(url).then(function(response){return response.data},function(reason){return _this4.$q.reject(reason)})}},{key:"createChapter",value:function createChapter(lesson,newChapter){var _this5=this;var url=Routing.generate("icap_lesson_api_create_chapter",{lesson:lesson});return this.$http.post(url,{chapter:newChapter}).then(function(response){return response.data},function(reason){return _this5.$q.reject(reason)})}},{key:"updateChapter",value:function updateChapter(lesson,slug,updatedChapter){var _this6=this;var url=Routing.generate("icap_lesson_api_edit_chapter",{lesson:lesson,chapter:slug});return this.$http.put(url,{chapter:updatedChapter}).then(function(response){return response.data},function(reason){return _this6.$q.reject(reason)})}},{key:"copyChapter",value:function copyChapter(lesson,slug,newChapter,copyChildren){var _this7=this;var url=Routing.generate("icap_lesson_api_duplicate_chapter",{lesson:lesson,chapter:slug});newChapter.copyChildren=copyChildren;return this.$http.post(url,{chapter:newChapter}).then(function(response){return response.data},function(reason){return _this7.$q.reject(reason)})}},{key:"deleteChapter",value:function deleteChapter(lesson,slug,deleteChildren){var _this8=this;var url=Routing.generate("icap_lesson_api_delete_chapter",{lesson:lesson,chapter:slug,deleteChildren:deleteChildren});return this.$http.delete(url).then(function(response){return response.data},function(reason){return _this8.$q.reject(reason)})}},{key:"moveChapter",value:function moveChapter(lesson,chapter,parent,prevSibling){var _this9=this;var url=Routing.generate("icap_lesson_api_move_chapter",{chapter:chapter,lesson:lesson});var data={newParent:parent,prevSibling:prevSibling};return this.$http.patch(url,data).then(function(response){return response.data},function(reason){return _this9.$q.reject(reason)})}}]);return RestService}();exports.default=RestService;RestService.$inject=["$http","$q"]},1713:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _classCallCheck2=__webpack_require__(13);var _classCallCheck3=_interopRequireDefault(_classCallCheck2);var _createClass2=__webpack_require__(14);var _createClass3=_interopRequireDefault(_createClass2);var _weakMap=__webpack_require__(254);var _weakMap2=_interopRequireDefault(_weakMap);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var _$location=new _weakMap2.default;var _Alerts=new _weakMap2.default;var InterceptorFactory=function(){function InterceptorFactory($location,Alerts){(0,_classCallCheck3.default)(this,InterceptorFactory);_$location.set(this,$location);_Alerts.set(this,Alerts)}(0,_createClass3.default)(InterceptorFactory,[{key:"responseError",get:function get(){var _this=this;return function(rejection){if(rejection.status===401||rejection.status===500){_Alerts.get(_this).push({type:"danger",msg:Translator.trans("error_"+rejection.status,"icap_lesson")})}if(rejection.status===404){_$location.get(_this).path("/error/404")}}}}]);return InterceptorFactory}();exports.default=InterceptorFactory},1714:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _classCallCheck2=__webpack_require__(13);var _classCallCheck3=_interopRequireDefault(_classCallCheck2);var _createClass2=__webpack_require__(14);var _createClass3=_interopRequireDefault(_createClass2);var _weakMap=__webpack_require__(254);var _weakMap2=_interopRequireDefault(_weakMap);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var _$rootScope=new _weakMap2.default;var _restService=new _weakMap2.default;var MainController=function(){function MainController($rootScope,lessonData,restService,$q,Alerts){(0,_classCallCheck3.default)(this,MainController);_$rootScope.set(this,$rootScope);_restService.set(this,restService);this.lessonData=lessonData;this.alerts=Alerts}(0,_createClass3.default)(MainController,[{key:"closeAlert",value:function closeAlert(index){this.alerts.splice(index,1)}}]);return MainController}();exports.default=MainController;MainController.$inject=["$rootScope","lesson.data","restService","$q","Alerts"]},1715:function(module,exports){module.exports='<div class=\'panel-heading chapter_title\'>\n    <h4 data-ng-bind-html="vm.chapter.current.title|trustedHtml">\n        {{ vm.chapter.current.title }}\n    </h4>\n\n</div>\n\n<nav data-ng-if="vm.isGranted" class="navbar navbar-default navbar-static-top">\n    <div class=\'pull-right\'>\n        <a\n                class="createchapter btn btn-sm lesson_tooltip btn-primary navbar-btn"\n                data-ng-click="vm.newChapter(vm.chapter.current.slug)">\n            <span class="fa fa-plus"></span>\n            <span class="chapter_menu_labels">{{ \'new_subchapter\'|trans:\'icap_lesson\' }}</span>\n        </a>\n        <a\n                class="editchapter btn btn-default btn-sm navbar-btn lesson_tooltip"\n                data-ng-click="vm.updateChapter(vm.chapter.current.slug)">\n            <span class="fa fa-edit"></span>\n            <span class=\'chapter_menu_labels\'>{{ \'edit\'|trans:\'icap_lesson\' }}</span>\n        </a>\n        <div class="btn-group btn-group-sm">\n            <a\n                    class="movechapter btn btn-default navbar-btn lesson_tooltip"\n                    data-ng-click="vm.moveChapter(vm.chapter.current.slug)"\n                    tooltip-placement="top"\n                    uib-tooltip="{{ \'move_chapter_button\' | trans: \'icap_lesson\' }}"\n                    tooltip-append-to-body="true">\n                <i class="fa fa-arrows"></i>\n            </a>\n            <a\n                    class="duplicatechapter btn btn-default navbar-btn lesson_tooltip"\n                    data-ng-click="vm.duplicateChapter(vm.chapter.current.slug)"\n                    tooltip-placement="top"\n                    uib-tooltip="{{ \'duplicate_chapter_button\' | trans: \'icap_lesson\' }}"\n                    tooltip-append-to-body="true">\n                <i class="fa fa-copy"></i>\n            </a>\n            <a\n                    class="deletechapter-old btn btn-danger navbar-btn lesson_tooltip"\n                    data-ng-click="vm.confirmDeleteChapter(vm.chapter.current.slug)"\n                    tooltip-placement="top"\n                    uib-tooltip="{{ \'delete_chapter_button\' | trans: \'icap_lesson\' }}"\n                    tooltip-append-to-body="true">\n                <i class="fa fa-trash-o"></i>\n            </a>\n        </div>\n    </div>\n</nav>\n\n<div data-ng-bind-html="vm.chapter.current.text|trustedHtml" class="chapter_content_text"></div>\n\n<div class=\'lesson_footer row\'>\n    <div class=\'col-md-1 col-xs-6 align_left\'>\n        <a\n                class="btn lesson_tooltip"\n                data-ng-class="vm.chapter.current.previous == null ? \'disabled btn-default\': \'btn-primary\'"\n                data-ng-href="{{ vm.getPreviousChapterUrl() }}"\n                tooltip-placement="right" uib-tooltip="{{ \'previous\' | trans: \'icap_lesson\' }}">\n            <i class="fa fa-arrow-left lesson_footer_icon"></i>\n        </a>\n    </div>\n    <div class=\'col-md-10 col-xs-1\'>\n        <a\n                class="lesson_tooltip btn btn_up btn-primary hidden"\n                href=""\n                data-ng-click="vm.goToAnchor(\'resource-breadcrumb\')"\n                tooltip-placement="top" uib-tooltip="{{ \'back_top\' | trans: \'icap_lesson\' }}">\n            <i class="fa fa-arrow-up lesson_footer_icon"></i>\n        </a>\n    </div>\n    <div class=\'col-md-1 col-xs-5 align-right\'>\n        <a\n                class="btn lesson_tooltip"\n                data-ng-class="vm.chapter.current.next == null ? \'disabled btn-default\' : \'btn-primary\'"\n                data-ng-href="{{ vm.getNextChapterUrl() }}"\n                tooltip-placement="left" uib-tooltip="{{ \'next\' | trans: \'icap_lesson\' }}">\n            <i class="fa fa-arrow-right lesson_footer_icon"></i>\n        </a>\n    </div>\n</div>\n'},1716:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _classCallCheck2=__webpack_require__(13);var _classCallCheck3=_interopRequireDefault(_classCallCheck2);var _createClass2=__webpack_require__(14);var _createClass3=_interopRequireDefault(_createClass2);var _weakMap=__webpack_require__(254);var _weakMap2=_interopRequireDefault(_weakMap);var _confirmDeletionPartial=__webpack_require__(1717);var _confirmDeletionPartial2=_interopRequireDefault(_confirmDeletionPartial);var _index=__webpack_require__(1);var _index2=_interopRequireDefault(_index);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var _$rootScope=new _weakMap2.default;var _$scope=new _weakMap2.default;var _modalInstance=new _weakMap2.default;var _modalFactory=new _weakMap2.default;var _$route=new _weakMap2.default;var _$location=new _weakMap2.default;var _$anchorScroll=new _weakMap2.default;var _restService=new _weakMap2.default;var ChapterController=function(){function ChapterController($rootScope,$scope,lessonData,modal,$route,$location,$anchorScroll,restService,Chapter,Tree,Alerts,tinyMceConfig){(0,_classCallCheck3.default)(this,ChapterController);_$rootScope.set(this,$rootScope);_$scope.set(this,$scope);_$route.set(this,$route);_$location.set(this,$location);_$anchorScroll.set(this,$anchorScroll);_modalInstance.set(this,null);_modalFactory.set(this,modal);_restService.set(this,restService);this.lessonData=lessonData;this.isGranted=lessonData.isGranted;this.tinymceOptions=tinyMceConfig;this.chapter=Chapter;this.tree=Tree;this.alerts=Alerts;this.chapters=[];this._createdChapter={};this._deletedChapter={};this._editedChapter={};this.buttonSubmit={disabled:false};this.init()}(0,_createClass3.default)(ChapterController,[{key:"init",value:function init(){var _this=this;if(this.lessonData.defaultChapter){var chapterToLoad=_$route.get(this).current.pathParams.slug?_$route.get(this).current.pathParams.slug:this.lessonData.defaultChapter;this._createdChapter.parent=_$route.get(this).current.pathParams.slug?chapterToLoad:this.lessonData.root;this._getChapterList(this.lessonData.lessonId);if(chapterToLoad!=this.chapter.current.slug){_restService.get(this).getChapter(this.lessonData.lessonId,chapterToLoad).then(function(response){_this.chapter.refresh(response)})}}}},{key:"newChapter",value:function newChapter(slug){_$location.get(this).url("/"+slug+"/new")}},{key:"updateChapter",value:function updateChapter(slug){_$location.get(this).url("/"+slug+"/edit")}},{key:"moveChapter",value:function moveChapter(slug){_$location.get(this).url("/"+slug+"/move")}},{key:"duplicateChapter",value:function duplicateChapter(slug){_$location.get(this).url("/"+slug+"/duplicate")}},{key:"getPreviousChapterUrl",value:function getPreviousChapterUrl(){return this.chapter.current.previous?"#/"+this.chapter.current.previous:null}},{key:"getNextChapterUrl",value:function getNextChapterUrl(){return this.chapter.current.next?"#/"+this.chapter.current.next:null}},{key:"createFirstChapter",value:function createFirstChapter(){this.lessonData.createNew=true;_$location.get(this).url("/new")}},{key:"createChapter",value:function createChapter(form){var _this2=this;if(form.$valid){this.buttonSubmit.disabled=true;_restService.get(this).createChapter(this.lessonData.lessonId,this._createdChapter).then(function(response){_this2.lessonData.createNew=false;_this2.chapter.refresh(response.chapter);_this2.tree.refresh(_this2.lessonData.lessonId);_this2._getDefaultChapter(_this2.lessonData.lessonId);_this2.alerts.push({type:"success",msg:response.message});form.$setPristine();_$location.get(_this2).url("/"+response.chapter.slug)},function(){_this2.buttonSubmit.disabled=false})}else{this.alerts.push({type:"danger",msg:window.Translator.trans("form_error","icap_lesson")})}}},{key:"editChapter",value:function editChapter(form){var _this3=this;if(form.$valid){this.buttonSubmit.disabled=true;_restService.get(this).updateChapter(this.lessonData.lessonId,this.chapter.current.slug,this.chapter.edited).then(function(response){_this3.chapter.refresh(response.chapter);_this3.tree.refresh(_this3.lessonData.lessonId);_this3.alerts.push({type:"success",msg:response.message});form.$setPristine();_$location.get(_this3).url("/"+response.chapter.slug)},function(){_this3.buttonSubmit.disabled=false})}else{this.alerts.push({type:"danger",msg:window.Translator.trans("form_error","icap_lesson")})}}},{key:"copyChapter",value:function copyChapter(form){var _this4=this;if(form.$valid){this.buttonSubmit.disabled=true;var copyChildren=!!(form.copyChildren&&form.copyChildren.$modelValue);_restService.get(this).copyChapter(this.lessonData.lessonId,this.chapter.current.slug,this.chapter.current,copyChildren).then(function(response){_this4.chapter.refresh(response.chapter);_this4.tree.refresh(_this4.lessonData.lessonId);_this4._getDefaultChapter(_this4.lessonData.lessonId);_this4.alerts.push({type:"success",msg:response.message});_$location.get(_this4).url("/"+response.chapter.slug)},function(){_this4.buttonSubmit.disabled=false})}else{this.alerts.push({type:"danger",msg:window.Translator.trans("form_error","icap_lesson")})}}},{key:"confirmDeleteChapter",value:function confirmDeleteChapter(){this._modal(_confirmDeletionPartial2.default)}},{key:"deleteChapter",value:function deleteChapter(form){var _this5=this;this.buttonSubmit.disabled=true;var deleteChildren=!!(form.deleteChildren&&form.deleteChildren.$modelValue);_restService.get(this).deleteChapter(this.lessonData.lessonId,this.chapter.current.slug,deleteChildren).then(function(response){_this5.tree.refresh(_this5.lessonData.lessonId);_this5.alerts.push({type:"success",msg:response.message});_this5.cancelModal();_this5._getDefaultChapter(_this5.lessonData.lessonId).then(function(){return _$location.get(_this5).url("/")})},function(){_this5.buttonSubmit.disabled=false})}},{key:"goToAnchor",value:function goToAnchor(anchor){var $location=_$location.get(this);var $anchorScroll=_$anchorScroll.get(this);if($location.hash()!==anchor){$location.hash(anchor)}else{$anchorScroll()}}},{key:"_moveChapter",value:function _moveChapter(form){var _this6=this;this.buttonSubmit.disabled=true;var parentAsSibling=!!(form.asSibling&&form.asSibling.$modelValue);var newParent=parentAsSibling?null:form.parent.$modelValue;var prevSibling=parentAsSibling?form.parent.$modelValue:null;_restService.get(this).moveChapter(this.lessonData.lessonId,this.chapter.current.slug,newParent,prevSibling).then(function(response){_this6.tree.refresh(_this6.lessonData.lessonId);_this6.alerts.push({type:"success",msg:response.message});_$location.get(_this6).url("/"+response.chapter.slug)},function(){_this6.buttonSubmit.disabled=false})}},{key:"_getChapterList",value:function _getChapterList(lesson){var _this7=this;return _restService.get(this).getChapterList(lesson).then(function(response){_index2.default.forEach(response,function(value){if(value.slug==_this7.lessonData.root){value.title=window.Translator.trans("Root","icap_lesson");_this7.break}});_this7.lessonData.chapters=response;_this7.lessonData.isEmpty=response.length-1===0})}},{key:"_getDefaultChapter",value:function _getDefaultChapter(lesson){var _this8=this;return _restService.get(this).getDefaultChapter(lesson).then(function(response){if("defaultChapter"in response){_this8.lessonData.defaultChapter=response.defaultChapter;_this8.lessonData.isEmpty=false}else{_this8.lessonData.defaultChapter=null;_this8.lessonData.isEmpty=true}})}},{key:"cancelForm",value:function cancelForm(slug){var url=!_index2.default.isDefined(slug)?"/":"/"+slug;this.lessonData.createNew=false;_$location.get(this).url(url)}},{key:"cancelModal",value:function cancelModal(form){if(form){this._resetForm(form)}_modalInstance.get(this).dismiss()}},{key:"_modal",value:function _modal(template){_modalInstance.set(this,_modalFactory.get(this).open(template,_$scope.get(this)))}}]);return ChapterController}();exports.default=ChapterController;ChapterController.$inject=["$rootScope","$scope","lesson.data","lessonModal","$route","$location","$anchorScroll","restService","Chapter","Tree","Alerts","tinyMceConfig"]},1717:function(module,exports){module.exports='<form\n        novalidate\n        name="deleteForm"\n        class="form-horizontal">\n\n    <div class="modal-header">\n        <button\n                class="close"\n                data-ng-click="vm._cancelModal()">Ã—\n        </button>\n        <h3>\n            {{ \'Chapter Suppression\'|trans: \'icap_lesson\' }}\n        </h3>\n    </div>\n\n    <div class="modal-body">\n\n        <fieldset>\n            <div class="control-group">\n                <div class="delete_chapter_title">\n                    {{ cc.chapter.title }}\n                </div>\n\n                <div\n                    class="control-group"\n                    data-ng-hide="!vm.chapter.current.hasChildren">\n                    <input\n                            id="deleteChildren"\n                            type="checkbox"\n                            name="deleteChildren"\n                            data-ng-model="vm.deleteChildren"\n                    />\n                    <label class="control-label" for="deleteChildren">\n                        {{ \'delete_also_children\'|trans: \'icap_lesson\' }}\n                    </label>\n                    <br/>\n                    {{ \'delete_also_children_more\'|trans: \'icap_lesson\' }}\n                </div>\n\n                <div class=\'delete_chapter_warning\'>\n                    {{ \'delete_warning\'|trans: \'icap_lesson\' }}\n                </div>\n\n            </div>\n\n        </fieldset>\n\n    </div>\n    <div class="modal-footer">\n        <button\n                class="btn"\n                data-ng-click="vm.cancelModal()">\n            {{ \'Cancel\'|trans: \'icap_lesson\' }}\n        </button>\n        <button\n                type="submit"\n                class="btn btn-primary"\n                data-ng-disable="vm.buttonSubmit.disabled"\n                data-ng-click="vm.deleteChapter(deleteForm)">\n            {{ \'confirm\'|trans: \'icap_lesson\' }}\n        </button>\n    </div>\n</form>\n\n'},1718:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _classCallCheck2=__webpack_require__(13);var _classCallCheck3=_interopRequireDefault(_classCallCheck2);var _createClass2=__webpack_require__(14);var _createClass3=_interopRequireDefault(_createClass2);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var ChapterFactory=function(){function ChapterFactory(){(0,_classCallCheck3.default)(this,ChapterFactory);this.current={};this.edited={}}(0,_createClass3.default)(ChapterFactory,[{key:"refresh",value:function refresh(chapter){this.current.id=chapter.id;this.current.title=this.edited.title=chapter.title;this.current.text=this.edited.text=chapter.text;this.current.slug=chapter.slug;this.current.parent=chapter.parent;this.current.previous=chapter.previous;this.current.next=chapter.next;this.current.hasChildren=chapter.hasChildren}}]);return ChapterFactory}();exports.default=ChapterFactory},1719:function(module,exports){module.exports="<div class='panel panel-default' id='chapter_content'>\n    <div class='chapter_content_text'>\n        <div class='welcome'>\n            <div>{{ 'lesson_welcome'|trans: 'icap_lesson' }}</div>\n            <div data-ng-if=\"cc.isGranted\">\n                <button\n                        class=\"createchapter btn btn-primary\"\n                        data-ng-click=\"cc.createFirstChapter()\">\n                    {{ 'lesson_welcome_create'|trans: 'icap_lesson' }}\n                </button>\n            </div>\n        </div>\n    </div>\n</div>"},1720:function(module,exports){module.exports='<div\n        class=\'panel-heading chapter_title\'>\n    <h4>\n        {{ \'Chapter Creation\'|trans: \'icap_lesson\' }}\n    </h4>\n</div>\n\n<form\n        data-confirm-discard-changes\n        novalidate\n        name="createForm"\n        class="form-horizontal">\n    <div class=\'chapter_content\'>\n        <fieldset>\n            <div\n                data-ng-if="!vm.lessonData.createNew"\n                class="control-group">\n                <label\n                        class="control-label"\n                        for="icap_lesson_chaptertype_parentChapter">\n                    {{ \'location\'|trans: \'icap_lesson\' }}\n                </label>\n\n                <div\n                    class="controls">\n                    <select\n                        id="icap_lesson_chaptertype_parentChapter"\n                        required\n                        name="parent"\n                        class="form-control"\n                        data-ng-model="vm._createdChapter.parent"\n                        data-ng-options="chapter.slug as chapter.title for chapter in vm.lessonData.chapters">\n                    </select>\n                </div>\n            </div>\n\n            <div class="control-group">\n                <label\n                        class="control-label"\n                        for="icap_lesson_chaptertype_title">\n                    {{ \'Title\'|trans: \'icap_lesson\' }}\n                </label>\n                <div class="controls">\n                    <input\n                        type="text"\n                        id="icap_lesson_chaptertype_title"\n                        name="title"\n                        required\n                        data-give-focus\n                        class="form-control"\n                        data-ng-model="vm._createdChapter.title"\n                        data-uib-popover="{{ \'field_mandatory\'|trans: \'icap_lesson\' }}"\n                        data-popover-trigger="none"\n                        data-popover-is-open="createForm.$submitted && createForm.title.$invalid"\n                    />\n                </div>\n            </div>\n\n            <div class="control-group">\n                <label\n                        class="control-label"\n                        for="icap_lesson_chaptertype_text">\n                    {{ \'Text\'|trans: \'icap_lesson\' }}\n                </label>\n                <div class="controls">\n                    <input\n                        name="text"\n                        id="icap_lesson_chaptertype_text"\n                        type="text"\n                        data-ui-tinymce="vm.tinymceOptions"\n                        data-ng-model="vm._createdChapter.text"\n                    />\n                </div>\n            </div>\n        </fieldset>\n\n        <div class="form-actions">\n            <button\n                type="submit"\n                class="btn btn-primary"\n                data-ng-disabled="vm.buttonSubmit.disabled"\n                data-ng-click="vm.createChapter(createForm)">\n                {{ \'Save\'|trans: \'icap_lesson\' }}\n            </button>\n\n            <button\n                type="button"\n                class="btn btn-default btncancel"\n                data-ng-click="vm.cancelForm(vm.chapter.current.slug)">\n                {{ \'Cancel\'|trans: \'icap_lesson\' }}\n            </button>\n        </div>\n    </div>\n</form>';
},1721:function(module,exports){module.exports='<div class=\'panel-heading chapter_title\'>\n    <h4>\n        {{ \'Chapter Edition\'|trans: \'icap_lesson\' }}\n    </h4>\n</div>\n\n<form\n    data-confirm-discard-changes\n    novalidate\n    name=\'updateForm\'\n    class="form-horizontal">\n    <div class=\'chapter_content\'>\n        <fieldset>\n            <label\n                    class="control-label"\n                    for="icap_lesson_chaptertype_title">\n                {{ \'Title\'|trans: \'icap_lesson\' }}\n            </label>\n            <div class="controls">\n                <input\n                        type="text"\n                        id="icap_lesson_chaptertype_title"\n                        name="title"\n                        required\n                        class="form-control"\n                        data-ng-model="vm.chapter.edited.title"\n                        data-uib-popover="{{ \'field_mandatory\'|trans: \'icap_lesson\' }}"\n                        data-popover-trigger="none"\n                        data-popover-is-open="updateForm.$submitted && updateForm.title.$invalid"\n                />\n            </div>\n\n            <div class="control-group">\n                <label\n                        class="control-label"\n                        for="icap_lesson_chaptertype_text">\n                    {{ \'Text\'|trans: \'icap_lesson\' }}\n                </label>\n                <div class="controls">\n\n                    <textarea id="icap_lesson_chaptertype_text"\n                              data-bind-html-unsafe\n                    name="text"\n                    data-ui-tinymce="vm.tinymceOptions"\n                    data-ng-model="vm.chapter.edited.text"></textarea>\n                </div>\n            </div>\n\n        </fieldset>\n\n        <div class="form-actions">\n            <button\n                    type="submit"\n                    class="btn btn-primary"\n                    data-ng-disabled="vm.buttonSubmit.disabled"\n                    data-ng-click="vm.editChapter(updateForm)">\n                {{ \'Save\'|trans: \'icap_lesson\' }}\n            </button>\n            <button\n                type="button"\n                class="btn btn-default"\n                data-ng-click="vm.cancelForm(vm.chapter.current.slug)">\n                {{ \'Cancel\'|trans: \'icap_lesson\' }}\n            </button>\n        </div>\n    </div>\n</form>\n'},1722:function(module,exports){module.exports='<div class=\'panel-heading chapter_title\'>\n    <h4>{{ \'Chapter Move\'|trans: \'icap_lesson\' }}</h4>\n</div>\n<form\n    name="formMove"\n    class="form-horizontal">\n    <fieldset>\n        <div class=\'chapter_content\'>\n            <div class="control-group">\n                <div class="controls">\n                    {{ vm.chapter.current.title }}\n                </div>\n            </div>\n            <div class="control-group">\n                <label class="control-label" for="icap_lesson_movechaptertype_choiceChapter">\n                    {{ \'move_destination\'|trans: \'icap_lesson\' }}\n                </label>\n                <div class="controls">\n                    <select\n                        id="icap_lesson_movechaptertype_choiceChapter"\n                        required\n                        name="parent"\n                        class="form-control"\n                        data-ng-model="vm.chapter.current.parent"\n                        data-ng-options="chapter.slug as chapter.title for chapter in vm.lessonData.chapters">\n                    </select>\n\n                </div>\n            </div>\n            <div class="control-group" data-ng-if="formMove.parent.$viewValue != \'root-\' + vm.lessonData.lessonId">\n                <label class="control-label" for="icap_lesson_movechaptertype_brother">\n                    {{ \'same_level\'|trans: \'icap_lesson\' }}\n                </label>\n                <input\n                    id="icap_lesson_movechaptertype_brother"\n                    data-ng-model="vm.asSibling"\n                    name="asSibling"\n                    type="checkbox"\n                    data-ng-disabled="formMove.parent.$viewValue == \'root-\' + vm.lessonData.lessonId"/>\n            </div>\n        </div>\n\n    </fieldset>\n    <br/>\n    <div class="form-actions">\n        <button\n            type="submit"\n            class="btn btn-primary"\n            value="{{ \'Ok\'|trans: \'icap_lesson\' }}"\n            data-ng-click="vm._moveChapter(formMove)"\n            data-ng-disabled="vm.buttonSubmit.disabled">\n            {{ \'Ok\'|trans: \'icap_lesson\' }}\n        </button>\n\n        <button\n            type="button"\n            class="btn btn-default"\n            data-ng-click="vm.cancelForm(vm.chapter.current.slug)">\n            {{ \'Cancel\'|trans: \'icap_lesson\' }}\n        </button>\n    </div>\n</form>'},1723:function(module,exports){module.exports='<div class=\'panel-heading chapter_title\'>\n    <h4>\n        {{ \'chapter_duplicate\'|trans: \'icap_lesson\' }}\n    </h4>\n</div>\n\n<form\n        novalidate\n        name="duplicateForm"\n        class="form-horizontal">\n    <fieldset>\n        <div class=\'chapter_content\'>\n            <div class="control-group">\n                <div class="controls">\n                    {{::vm.chapter.current.title}}\n                </div>\n            </div>\n            <div class="control-group">\n                <div>\n                    <label\n                            class="control-label"\n                            for="icap_lesson_duplicatechaptertype_title">\n                        {{ \'duplicate_title\'|trans: \'icap_lesson\' }}\n                    </label>\n                    <div class="controls">\n                        <input\n                                type="text"\n                                id="icap_lesson_duplicatechaptertype_title"\n                                name="title"\n                                required\n                                class="form-control"\n                                data-ng-model="vm.chapter.current.title"\n                                data-uib-popover="{{ \'field_mandatory\'|trans: \'icap_lesson\' }}"\n                                data-popover-trigger="none"\n                                data-popover-is-open="duplicateForm.$submitted && duplicateForm.title.$invalid"\n                        />\n                        <label class="control-label" for="icap_lesson_duplicatechaptertype_chapters">\n                            {{ \'duplicate_destination\'|trans: \'icap_lesson\' }}\n                        </label>\n                        <select\n                                id="icap_lesson_duplicatechaptertype_chapters"\n                                name="parent"\n                                required\n                                class="form-control"\n                                data-ng-model="vm.chapter.current.parent"\n                                data-ng-options="chapter.slug as chapter.title for chapter in vm.lessonData.chapters">\n                        </select>\n                    </div>\n\n                    <div data-ng-if="vm.chapter.hasChildren">\n                        <input\n                                type="checkbox"\n                                id="icap_lesson_duplicatechaptertype_duplicate_children"\n                                name="copyChildren"\n                                data-ng-model="vm.copyChildren"\n                                class="control-standalone control-standalone"\n                                value="1"\n                        />\n                        <label\n                                class="control-label"\n                                for="icap_lesson_duplicatechaptertype_duplicate_children">\n                            {{ \'duplicate_children\'|trans: \'icap_lesson\' }}\n                        </label>\n                    </div>\n\n                </div>\n            </div>\n        </div>\n    </fieldset>\n\n    <br/>\n\n    <div class="form-actions">\n        <button\n                type="submit"\n                class="btn btn-primary"\n                data-ng-disabled="vm.buttonSubmit.disabled"\n                data-ng-click="vm.copyChapter(duplicateForm)"\n                >\n            {{ \'Ok\'|trans: \'icap_lesson\' }}\n        </button>\n        <button\n                type="cancel"\n                class="btn btn-default"\n                data-ng-click="vm.cancelForm(vm.chapter.current.slug)">\n            {{ \'Cancel\'|trans: \'icap_lesson\' }}\n        </button>\n    </div>\n\n</form>\n'},1724:function(module,exports){module.exports="<div class='panel panel-default' id='chapter_content'>\n    <div class='chapter_content_text'>\n        <div class='welcome'>\n            <div>{{ 'error_404' | trans: 'icap_lesson' }}</div>\n        </div>\n    </div>\n</div>"},1725:function(module,exports){module.exports='<div\n        data-ui-tree="vm.treeOptions"\n        data-drag-enabled="vm.dragEnabled"\n        class="panel panel-default menu_lesson">\n    <div class=\'chapter_list_header\'>\n\n        {{ \'chapter_list_header\'|trans: \'icap_lesson\' }}\n\n        <div class="icon_chapter_list_header">\n            <button\n                data-ng-if="vm.displayDrag"\n                class="btn-xs btn btn-default lesson_tooltip menu_lesson_button"\n                data-ng-click="vm.dragEnabled=!vm.dragEnabled"\n                data-ng-class="{\'enabled\': vm.dragEnabled}"\n                tooltip-placement="top" uib-tooltip="{{ vm.getDragEnableButtonText() }}">\n                <i class="fa fa-arrows text-primary" ></i>\n            </button>\n            <button\n                data-ng-click="vm.collapseAll()"\n                class="btn-xs btn btn-default lesson_tooltip menu_lesson_button"\n                tooltip-placement="top" uib-tooltip="{{ \'collapse_all\'|trans: \'icap_lesson\' }}">\n                <i class="fa fa-long-arrow-up text-primary" ></i>\n                <i class="fa fa-minus text-primary"></i>\n            </button>\n            <button\n                data-ng-click="vm.expandAll()"\n                class="btn-xs btn btn-default lesson_tooltip menu_lesson_button"\n                tooltip-placement="top" uib-tooltip="{{ \'expand_all\'|trans: \'icap_lesson\' }}">\n                <i class="fa fa-long-arrow-down text-primary"></i>\n                <i class="fa fa-reorder text-primary"></i>\n            </button>\n        </div>\n\n    </div>\n\n    <ul\n        id="lesson_menu"\n        class="jquery-sortable-list"\n        data-ui-tree-nodes=""\n        data-ng-model="vm.tree.data.__children">\n        <li\n            ui-tree-handle\n            data-ng-repeat="node in vm.tree.data.__children"\n            data-ui-tree-node\n            data-ng-include="\'nodes_renderer.html\'"\n            class="draggable-item"\n            data-ng-class="{\'draggable-list\': vm.dragEnabled}">\n        </li>\n    </ul>\n    <script type="text/ng-template" id="nodes_renderer.html">\n        <div\n                id = "menu_item_{{ node.id }}"\n                class="menu-item"\n                data-ng-class="{\'cursor_move\': vm.dragEnabled, \'active_chapter\': node.id == vm.chapter.current.id}">\n            <i\n                    data-nodrag\n                    data-ng-click="vm.toggle(this)"\n                    data-ng-class="{\'fa-caret-right\': collapsed, \'fa-caret-down\': !collapsed, \'invisible\': node.__children.length == 0}"\n                    class="fa collapsor"></i>\n            <a\n                    data-ng-href="{{ vm.getChapterUrl(node.slug) }}"\n                    class="draggableLink">\n                {{ node.title }}\n            </a>\n        </div>\n        <ul\n                id="list_{{ node.id }}"\n                data-ui-tree-nodes\n                data-ng-model="node.__children"\n                data-ng-class="{\'hidden\': collapsed}">\n            <li\n                    ui-tree-handle\n                    class="draggable-item"\n                    data-ng-class="{\'draggable-list\': vm.dragEnabled}"\n                    data-ng-repeat="node in node.__children"\n                    data-ui-tree-node\n                    data-ng-include="\'nodes_renderer.html\'">\n            </li>\n        </ul>\n    </script>\n\n    <br />\n\n</div>\n\n'},1726:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _classCallCheck2=__webpack_require__(13);var _classCallCheck3=_interopRequireDefault(_classCallCheck2);var _createClass2=__webpack_require__(14);var _createClass3=_interopRequireDefault(_createClass2);var _weakMap=__webpack_require__(254);var _weakMap2=_interopRequireDefault(_weakMap);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var _$rootScope=new _weakMap2.default;var _$scope=new _weakMap2.default;var _$location=new _weakMap2.default;var _$q=new _weakMap2.default;var _restService=new _weakMap2.default;var _$filter=new _weakMap2.default;var TreeController=function(){function TreeController($rootScope,$scope,$location,$q,lessonData,restService,Chapter,Tree,$filter){(0,_classCallCheck3.default)(this,TreeController);_$rootScope.set(this,$rootScope);_$scope.set(this,$scope);_$location.set(this,$location);_$q.set(this,$q);_restService.set(this,restService);_$filter.set(this,$filter);this.lessonData=lessonData;this.tree=Tree;this.displayDrag=false;this.dragEnabled=false;this.chapter=Chapter;this.init()}(0,_createClass3.default)(TreeController,[{key:"init",value:function init(){var _this=this;this.tree.refresh(this.lessonData.lessonId);_$rootScope.get(this).$on("$routeChangeSuccess",function(event,current){_this.displayDrag=current.$$route.originalPath=="/:slug";if(current.$$route.originalPath!="/:slug"){_this.dragEnabled=false}})}},{key:"_dragChapter",value:function _dragChapter(event){var _this2=this;var chapter=event.source.nodeScope.$modelValue.slug;var newParent="root-"+this.lessonData.lessonId;var previousSibling=null;if(event.dest.nodesScope.$parent.$type=="uiTreeNode"){newParent=event.dest.nodesScope.$parent.$modelValue.slug;if(event.dest.index>0){previousSibling=event.dest.nodesScope.$parent.$modelValue.__children[event.dest.index-1].slug}}else{if(event.dest.index>0){previousSibling=event.dest.nodesScope.$modelValue[event.dest.index-1].slug}}return _restService.get(this).moveChapter(this.lessonData.lessonId,chapter,newParent,previousSibling).then(function(response){_$rootScope.get(_this2).$emit("chapterMoved",response.message,response.chapter);_this2.chapter.refresh(response.chapter);_$location.get(_this2).url("/"+response.chapter.slug)})}},{key:"getChapterUrl",value:function getChapterUrl(slug){if(!this.dragEnabled){return"#/"+slug}}},{key:"toggle",value:function toggle(element){element.toggle()}},{key:"collapseAll",value:function collapseAll(){_$scope.get(this).$broadcast("angular-ui-tree:collapse-all")}},{key:"expandAll",value:function expandAll(){_$scope.get(this).$broadcast("angular-ui-tree:expand-all")}},{key:"getDragEnableButtonText",value:function getDragEnableButtonText(){return!this.dragEnabled?_$filter.get(this)("trans")("enable_move","icap_lesson"):_$filter.get(this)("trans")("disable_move","icap_lesson")}},{key:"treeOptions",get:function get(){return{beforeDrop:this._dragChapter.bind(this)}}}]);return TreeController}();exports.default=TreeController;TreeController.$inject=["$rootScope","$scope","$location","$q","lesson.data","restService","Chapter","Tree","$filter"]},1727:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _classCallCheck2=__webpack_require__(13);var _classCallCheck3=_interopRequireDefault(_classCallCheck2);var _createClass2=__webpack_require__(14);var _createClass3=_interopRequireDefault(_createClass2);var _weakMap=__webpack_require__(254);var _weakMap2=_interopRequireDefault(_weakMap);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var _restService=new _weakMap2.default;var TreeService=function(){function TreeService(restService){(0,_classCallCheck3.default)(this,TreeService);_restService.set(this,restService);this.data={}}(0,_createClass3.default)(TreeService,[{key:"refresh",value:function refresh(lesson){var _this=this;_restService.get(this).getTree(lesson).then(function(response){_this.data=response})}}]);return TreeService}();exports.default=TreeService;TreeService.$inject=["restService"]},1728:function(module,exports){module.exports='<uib-alert\n        id="lesson-alert"\n        data-ng-repeat="alert in lesson.alerts"\n        data-type="{{ alert.type }}"\n        data-close="lesson.closeAlert($index)"\n        data-dismiss-on-timeout="10000">\n    {{ alert.msg }}\n</uib-alert>'}});