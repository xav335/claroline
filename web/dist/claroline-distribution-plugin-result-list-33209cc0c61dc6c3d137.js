webpackJsonp([36],{0:function(module,exports,__webpack_require__){"use strict";var _index=__webpack_require__(1);var _index2=_interopRequireDefault(_index);__webpack_require__(5);__webpack_require__(150);var _listComponent=__webpack_require__(1872);var _listComponent2=_interopRequireDefault(_listComponent);var _listComponent3=__webpack_require__(1873);var _listComponent4=_interopRequireDefault(_listComponent3);var _resultsService=__webpack_require__(1879);var _resultsService2=_interopRequireDefault(_resultsService);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}_index2.default.module("ResultModule",["ui.bootstrap","ngFileUpload"]).service("resultService",["$http","Upload",_resultsService2.default]).factory("resultModal",["$uibModal",function($modal){return{open:function open(template){return $modal.open({template:template})}}}]).controller("resultCtrl",["resultService","resultModal",_listComponent4.default]).directive("results",function(){return{controllerAs:"vm",bindToController:true,controller:"resultCtrl",template:_listComponent2.default}}).directive("validUser",["resultService",function(service){return{require:"ngModel",link:function link(scope,elm,attrs,ctrl){ctrl.$validators.validUser=function(modelValue){return ctrl.$isEmpty(modelValue)||service.getUsers().some(function(user){return user.name===modelValue})}}}}]).directive("validMark",["resultService",function(service){return{require:"ngModel",link:function link(scope,elm,attrs,ctrl){ctrl.$validators.validMark=function(modelValue){return ctrl.$isEmpty(modelValue)||service.getMaximumMark()>=service.formatMark(modelValue)}}}}]).filter("trans",function(){return function(string){var domain=arguments.length>1&&arguments[1]!==undefined?arguments[1]:"platform";return Translator.trans(string,domain)}})},1249:function(module,exports,__webpack_require__){"use strict";exports.__esModule=true;var _from=__webpack_require__(1250);var _from2=_interopRequireDefault(_from);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}exports.default=function(arr){if(Array.isArray(arr)){for(var i=0,arr2=Array(arr.length);i<arr.length;i++){arr2[i]=arr[i]}return arr2}else{return(0,_from2.default)(arr)}}},1250:function(module,exports,__webpack_require__){module.exports={default:__webpack_require__(1251),__esModule:true}},1251:function(module,exports,__webpack_require__){__webpack_require__(37);__webpack_require__(1252);module.exports=__webpack_require__(20).Array.from},1252:function(module,exports,__webpack_require__){"use strict";var ctx=__webpack_require__(21),$export=__webpack_require__(18),toObject=__webpack_require__(65),call=__webpack_require__(265),isArrayIter=__webpack_require__(266),toLength=__webpack_require__(55),createProperty=__webpack_require__(1253),getIterFn=__webpack_require__(267);$export($export.S+$export.F*!__webpack_require__(438)(function(iter){Array.from(iter)}),"Array",{from:function from(arrayLike){var O=toObject(arrayLike),C=typeof this=="function"?this:Array,aLen=arguments.length,mapfn=aLen>1?arguments[1]:undefined,mapping=mapfn!==undefined,index=0,iterFn=getIterFn(O),length,result,step,iterator;if(mapping)mapfn=ctx(mapfn,aLen>2?arguments[2]:undefined,2);if(iterFn!=undefined&&!(C==Array&&isArrayIter(iterFn))){for(iterator=iterFn.call(O),result=new C;!(step=iterator.next()).done;index++){createProperty(result,index,mapping?call(iterator,mapfn,[step.value,index],true):step.value)}}else{length=toLength(O.length);for(result=new C(length);length>index;index++){createProperty(result,index,mapping?mapfn(O[index],index):O[index])}}result.length=index;return result}})},1253:function(module,exports,__webpack_require__){"use strict";var $defineProperty=__webpack_require__(24),createDesc=__webpack_require__(32);module.exports=function(object,index,value){if(index in object)$defineProperty.f(object,index,createDesc(0,value));else object[index]=value}},1872:function(module,exports){module.exports='<div class="panel-body" >\n  <table class="table table-condensed table-bordered"\n         data-ng-if="vm.results.length > 0">\n    <thead>\n      <tr>\n        <th>{{ \'name\'|trans }}</th>\n        <th>{{ \'mark\'|trans:\'results\' }}</th>\n        <th>{{ \'total\'|trans }}</th>\n        <th colspan="2" data-ng-if="!vm.isReadOnly"></th>\n      </tr>\n    </thead>\n    <tbody>\n      <tr data-ng-repeat="result in vm.results track by result.markId">\n        <td>{{ result.name }}</td>\n        <td>{{ result.mark }}</td>\n        <td>{{ vm.max }}</td>\n        <td style="text-align: center" data-ng-if="!vm.isReadOnly">\n          <a href="#"\n             aria-label="{{ \'edit\'|trans }}"\n             onclick="return false"\n             style="outline: 0"\n             data-uib-tooltip="{{ \'edit\'|trans }}"\n             data-ng-if="result.markId"\n             data-ng-click="vm.displayEditionForm(result)">\n            <i class="fa fa-edit"></i>\n          </a>\n        </td>\n        <td style="text-align: center" data-ng-if="!vm.isReadOnly">\n          <a href="#"\n             aria-label="{{ \'delete\'|trans }}"\n             onclick="return false"\n             style="outline: 0"\n             data-uib-tooltip="{{ \'delete\'|trans }}"\n             data-ng-if="result.markId"\n             data-ng-click="vm.confirmDeletion(result)">\n            <i class="fa fa-remove"></i>\n          </a>\n        </td>\n      </tr>\n    </tbody>\n  </table>\n\n  <div class="alert alert-info"\n       data-ng-if="vm.results.length == 0">\n    <i class="fa fa-info-circle"></i>\n    {{ \'marks.empty\'|trans:\'results\' }}\n  </div>\n</div>\n\n<div class="panel-footer" data-ng-if="!vm.isReadOnly">\n  <button class="btn btn-primary"\n          data-ng-click="vm.displayCreationForm()">\n    {{ \'marks.add\'|trans:\'results\' }}\n  </button>\n  <button class="btn btn-primary"\n          data-ng-click="vm.displayImportForm()">\n    {{ \'marks.import\'|trans:\'results\' }}\n  </button>\n</div>\n'},1873:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _classCallCheck2=__webpack_require__(13);var _classCallCheck3=_interopRequireDefault(_classCallCheck2);var _createClass2=__webpack_require__(14);var _createClass3=_interopRequireDefault(_createClass2);var _confirmPartial=__webpack_require__(1874);var _confirmPartial2=_interopRequireDefault(_confirmPartial);var _createPartial=__webpack_require__(1875);var _createPartial2=_interopRequireDefault(_createPartial);var _editPartial=__webpack_require__(1876);var _editPartial2=_interopRequireDefault(_editPartial);var _errorPartial=__webpack_require__(1877);var _errorPartial2=_interopRequireDefault(_errorPartial);var _importPartial=__webpack_require__(1878);var _importPartial2=_interopRequireDefault(_importPartial);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var ListComponent=function(){function ListComponent(service,modal){(0,_classCallCheck3.default)(this,ListComponent);this.results=service.getResults();this.users=service.getUsers();this.max=service.getMaximumMark();this.isReadOnly=service.isReadOnly();this.editedMark={};this.createdMark={};this.importFile=null;this.errorMessage=null;this.importType="fullname";this.errors=[];this._deletedResult=null;this._service=service;this._modalFactory=modal;this._modalInstance=null}(0,_createClass3.default)(ListComponent,[{key:"displayCreationForm",value:function displayCreationForm(){this._modal(_createPartial2.default)}},{key:"createResult",value:function createResult(form){var _this=this;if(form.$valid){this._service.createMark(this.createdMark,function(){_this._modal(_errorPartial2.default,"errors.mark.creation_failure")});this._resetForm(form);this._closeModal()}}},{key:"displayEditionForm",value:function displayEditionForm(result){this.editedMark.original=result;this.editedMark.newValue=result.mark;this._modal(_editPartial2.default)}},{key:"editResult",value:function editResult(form){var _this2=this;if(form.$valid){this._closeModal();this._service.editMark(this.editedMark.original,this.editedMark.newValue,function(){return _this2._modal(_errorPartial2.default,"errors.mark_edition_failure")})}}},{key:"displayImportForm",value:function displayImportForm(){this._modal(_importPartial2.default)}},{key:"importResults",value:function importResults(form){var _this3=this;this._service.importMarks(this.importFile,this.importType,function(errors){return _this3._modal(_errorPartial2.default,"errors.mark_import_failure",errors)});this._resetForm(form);this._closeModal()}},{key:"confirmDeletion",value:function confirmDeletion(result){this._deletedResult=result;this._modal(_confirmPartial2.default)}},{key:"deleteResult",value:function deleteResult(){var _this4=this;this._service.deleteMark(this._deletedResult,function(){return _this4._modal(_errorPartial2.default,"errors.mark_suppression_failure")});this._closeModal()}},{key:"cancel",value:function cancel(form){if(form){this._resetForm(form)}this._modalInstance.dismiss()}},{key:"_modal",value:function _modal(template,errorMessage,errors){if(errorMessage){this.errorMessage=errorMessage}if(errors){this.errors=errors}this._modalInstance=this._modalFactory.open(template)}},{key:"_closeModal",value:function _closeModal(){this._modalInstance.close()}},{key:"_resetForm",value:function _resetForm(form){this.createdMark={};this.editedMark={};this.importFile=null;this.errorMessage=null;this.errors=[];this._deletedResult=null;form.$setPristine();form.$setUntouched()}}]);return ListComponent}();exports.default=ListComponent},1874:function(module,exports){module.exports='<form name="confirmForm" novalidate>\n  <div class="modal-header">\n    <button type="button"\n            class="close"\n            data-dismiss="modal"\n            aria-label="{{ \'close\'|trans }}">\n      <span aria-hidden="true" data-ng-click="vm.cancel()">&times;</span>\n    </button>\n    <h3 class="modal-title">{{ \'marks.delete\'|trans:\'results\' }}</h3>\n  </div>\n  <div class="modal-body">\n    {{ \'marks.confirm_delete\'|trans:\'results\' }}\n  </div>\n  <div class="modal-footer">\n    <button type="submit"\n            class="btn btn-primary"\n            data-ng-click="vm.deleteResult()">\n      {{ \'delete\'|trans }}\n    </button>\n    <button type="button"\n            class="btn btn-default"\n            data-ng-click="vm.cancel()">\n      {{ \'cancel\'|trans }}\n    </button>\n  </div>\n</form>\n'},1875:function(module,exports){module.exports='<form name="createForm" novalidate>\n  <div class="modal-header">\n    <button type="button"\n            class="close"\n            data-dismiss="modal"\n            aria-label="{{ \'close\'|trans }}">\n      <span aria-hidden="true" data-ng-click="vm.cancel(createForm)">&times;</span>\n    </button>\n    <h3 class="modal-title">{{ \'marks.add\'|trans:\'results\' }}</h3>\n  </div>\n  <div class="modal-body">\n    <div class="form-group"\n         data-ng-class="{ \'has-error\': (createForm.$submitted || createForm.user.$dirty) && !createForm.user.$valid }">\n      <label for="mark-user">{{ \'user\'|trans }}</label>\n      <input id="mark-user"\n             type="text"\n             name="user"\n             class="form-control"\n             data-ng-model="vm.createdMark.user"\n             data-uib-typeahead="user.name for user in vm.users | filter:$viewValue | limitTo:8"\n             data-valid-user\n             required />\n      <p class="help-block"\n         data-ng-if="(createForm.$submitted || createForm.user.$dirty) && createForm.user.$error.required">\n        {{ \'errors.not_blank\'|trans:\'results\' }}\n      </p>\n      <p class="help-block"\n         data-ng-if="(createForm.$submitted || createForm.user.$dirty) && createForm.user.$error.validUser">\n        {{ \'errors.unknown_user\'|trans:\'results\' }}\n      </p>\n    </div>\n    <div class="form-group"\n         data-ng-class="{ \'has-error\': (createForm.$submitted || createForm.mark.$dirty) && !createForm.mark.$valid }">\n      <label for="mark-value">{{ \'mark\'|trans:\'results\' }}</label>\n      <input id="mark-value"\n             type="text"\n             name="mark"\n             class="form-control"\n             data-ng-model="vm.createdMark.mark"\n             data-valid-mark\n             required />\n      <p class="help-block"\n         data-ng-if="(createForm.$submitted || createForm.mark.$dirty) && createForm.mark.$error.required">\n        {{ \'errors.not_blank\'|trans:\'results\' }}\n      </p>\n      <p class="help-block"\n         data-ng-if="(createForm.$submitted || createForm.mark.$dirty) && createForm.mark.$error.validMark">\n        {{ \'errors.invalid_mark\'|trans:\'results\' }}\n      </p>\n    </div>\n  </div>\n  <div class="modal-footer">\n    <button type="submit"\n            class="btn btn-primary"\n            data-ng-disabled="!createForm.$valid"\n            data-ng-click="vm.createResult(createForm)">\n      {{ \'create\'|trans }}\n    </button>\n    <button type="button"\n            class="btn btn-default"\n            data-ng-click="vm.cancel(createForm)">\n      {{ \'cancel\'|trans }}\n    </button>\n  </div>\n</form>\n'},1876:function(module,exports){module.exports='<form name="markForm" novalidate>\n  <div class="modal-header">\n    <button type="button"\n            class="close"\n            data-dismiss="modal"\n            aria-label="{{ \'close\'|trans }}">\n      <span aria-hidden="true" data-ng-click="vm.cancel()">&times;</span>\n    </button>\n    <h3 class="modal-title">{{ \'marks.edit\'|trans:\'results\' }}</h3>\n  </div>\n  <div class="modal-body">\n    <div class="form-group"\n         data-ng-class="{ \'has-error\': (markForm.$submitted || markForm.value.$dirty) && !markForm.value.$valid }">\n      <label for="mark-value">{{ \'mark\'|trans:\'results\' }}</label>\n      <input id="mark-value"\n             type="text"\n             name="value"\n             class="form-control"\n             data-ng-model="vm.editedMark.newValue"\n             data-valid-mark\n             required />\n      <p class="help-block"\n         data-ng-if="(markForm.$submitted || markForm.value.$dirty) && markForm.value.$error.required">\n        {{ \'errors.not_blank\'|trans:\'results\' }}\n      </p>\n      <p class="help-block"\n         data-ng-if="(markForm.$submitted || markForm.value.$dirty) && markForm.value.$error.validMark">\n        {{ \'errors.invalid_mark\'|trans:\'results\' }}\n      </p>\n    </div>\n  </div>\n  <div class="modal-footer">\n    <button type="submit"\n            class="btn btn-primary"\n            data-ng-disabled="!markForm.$valid"\n            data-ng-click="vm.editResult(markForm)">\n      {{ \'edit\'|trans }}\n    </button>\n    <button type="button"\n            class="btn btn-default"\n            data-ng-click="vm.cancel()">\n      {{ \'cancel\'|trans }}\n    </button>\n  </div>\n</form>\n'},1877:function(module,exports){module.exports='<div class="modal-header">\n  <button type="button"\n          class="close"\n          data-dismiss="modal"\n          aria-label="{{ \'close\'|trans }}">\n    <span aria-hidden="true" data-ng-click="vm.cancel()">&times;</span>\n  </button>\n  <h3 class="modal-title">{{ \'errors.title\'|trans:\'results\' }}</h3>\n</div>\n<div class="modal-body">\n  <div class="alert alert-danger">\n    <i class="fa fa-warning"></i>\n    {{ vm.errorMessage|trans:\'results\' }}\n    <ul>\n      <li data-ng-repeat="error in vm.errors track by error.line">\n        {{ error.message|trans:\'result\' }}\n        <span data-ng-if="error.line">\n          ({{ \'errors.line\'|trans:\'result\' }} {{ error.line }})\n        </span>\n      </li>\n    </ul>\n  </div>\n</div>\n<div class="modal-footer">\n  <button class="btn btn-primary" type="submit" data-ng-click="vm.cancel()">\n    {{ \'close\'|trans }}\n  </button>\n</div>\n'},1878:function(module,exports){module.exports='<form name="importForm" enctype="multipart/form-data" novalidate>\n  <div class="modal-header">\n    <button type="button"\n            class="close"\n            data-dismiss="modal"\n            aria-label="{{ \'close\'|trans }}">\n      <span aria-hidden="true" data-ng-click="vm.cancel(importForm)">&times;</span>\n    </button>\n    <h3 class="modal-title">{{ \'marks.import\'|trans:\'results\' }}</h3>\n  </div>\n  <div class="modal-body">\n    <div class="alert alert-info" ng-switch on="vm.importType">\n      <i class="fa fa-info-circle"></i>\n      <div ng-switch-when="fullname"> {{ \'marks.import_fullname\'|trans:\'results\' }} </div>\n      <div ng-switch-when="code"> {{ \'marks.import_code\'|trans:\'results\' }} </div>\n      <div ng-switch-when="username"> {{ \'marks.import_username\'|trans:\'results\' }} </div>\n    </div>\n    <div class="form-group">\n      <label for="import_type"> {{ \'marks.import_type\'|trans:\'results\' }}: </label>\n      <input type="radio" ng-model="vm.importType" value="fullname"> {{ \'full_name\'|trans:\'results\' }} </input>\n      <input type="radio" ng-model="vm.importType" value="code"> {{ \'administrative_code\'|trans }} </input>\n      <input type="radio" ng-model="vm.importType" value="username"> {{ \'username\'|trans }} </input>\n    </div>\n    <div class="form-group"\n         data-ng-class="{ \'has-error\': (importForm.$submitted || importForm.file.$dirty) && !importForm.file.$valid }">\n      <label for="mark-file">{{ \'file\'|trans }}</label>\n      <input id="mark-file"\n             type="file"\n             name="file"\n             class="form-control"\n             data-ngf-select\n             data-ng-model="vm.importFile"\n             required />\n      <p class="help-block"\n         data-ng-if="(importForm.$submitted || importForm.file.$dirty) && importForm.file.$error.required">\n        {{ \'errors.not_blank\'|trans:\'results\' }}\n      </p>\n    </div>\n  </div>\n  <div class="modal-footer">\n    <button type="submit"\n            class="btn btn-primary"\n            data-ng-disabled="!importForm.$valid"\n            data-ng-click="vm.importResults(importForm)">\n      {{ \'import\'|trans }}\n    </button>\n    <button type="button"\n            class="btn btn-default"\n            data-ng-click="vm.cancel(importForm)">\n      {{ \'cancel\'|trans }}\n    </button>\n  </div>\n</form>\n'},1879:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _toConsumableArray2=__webpack_require__(1249);var _toConsumableArray3=_interopRequireDefault(_toConsumableArray2);var _classCallCheck2=__webpack_require__(13);var _classCallCheck3=_interopRequireDefault(_classCallCheck2);var _createClass2=__webpack_require__(14);var _createClass3=_interopRequireDefault(_createClass2);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var ResultsService=function(){function ResultsService($http,uploader){(0,_classCallCheck3.default)(this,ResultsService);this.$http=$http;this.uploader=uploader;this._resultId=ResultsService._getGlobal("resultId");this._resultMax=ResultsService._getGlobal("resultMax");this._marks=ResultsService._getGlobal("resultMarks");this._users=ResultsService._getGlobal("workspaceUsers");this._isReadOnly=ResultsService._getGlobal("isReadOnly")}(0,_createClass3.default)(ResultsService,[{key:"getResults",value:function getResults(){return this._marks}},{key:"getUsers",value:function getUsers(){return this._users}},{key:"getMaximumMark",value:function getMaximumMark(){return this._resultMax}},{key:"formatMark",value:function formatMark(mark){return parseInt(mark.replace(".",","))}},{key:"isReadOnly",value:function isReadOnly(){return this._isReadOnly}},{key:"createMark",value:function createMark(props,onFail){var _this=this;var user=this._users.find(function(user){return user.name===props.user});var result={name:props.user,mark:props.mark};var url=Routing.generate("claro_create_mark",{id:this._resultId,userId:user.id});this._marks.push(result);this.$http.post(url,{mark:props.mark}).then(function(response){result.markId=response.data},function(){_this._deleteMark(result);onFail()})}},{key:"deleteMark",value:function deleteMark(mark,onFail){var _this2=this;var url=Routing.generate("claro_delete_mark",{id:mark.markId});this._deleteMark(mark);this.$http.delete(url).then(null,function(){_this2._marks.push(mark);onFail()})}},{key:"editMark",value:function editMark(originalMark,newValue,onFail){if(originalMark.mark===newValue){return}var originalValue=originalMark.mark;var url=Routing.generate("claro_edit_mark",{id:originalMark.markId});originalMark.mark=newValue;this.$http.put(url,{value:newValue}).then(null,function(){originalMark.mark=originalValue;onFail()})}},{key:"importMarks",value:function importMarks(file,type,onFail){var _this3=this;var url=Routing.generate("claro_import_marks",{id:this._resultId,type:type});this.uploader.upload({url:url,data:{file:file}}).then(function(response){var _marks;return(_marks=_this3._marks).push.apply(_marks,(0,_toConsumableArray3.default)(response.data))},function(response){return onFail(response.data)},function(event){var progress=parseInt(100*event.loaded/event.total)})}},{key:"_deleteMark",value:function _deleteMark(mark){this._marks.splice(this._marks.indexOf(mark),1)}}],[{key:"_getGlobal",value:function _getGlobal(name){if(typeof window[name]==="undefined"){throw new Error("Expected "+name+" to be exposed in a window."+name+" variable")}return window[name]}}]);return ResultsService}();exports.default=ResultsService}});