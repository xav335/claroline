webpackJsonp([13],{0:function(module,exports,__webpack_require__){"use strict";var _promise=__webpack_require__(430);var _promise2=_interopRequireDefault(_promise);var _jsMeter=__webpack_require__(439);var _jsMeter2=_interopRequireDefault(_jsMeter);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var isFirefox=!!navigator.mediaDevices.getUserMedia;var isDebug=false;if(isDebug){console.log(isFirefox?"firefox":"chrome")}var recorder=void 0;var tempRecordedBlobs=void 0;var audioContext=new window.AudioContext;var realAudioInput=null;var meter=void 0;var aid=0;var aBlobs=[];var audios=[];var maxTry=void 0;var maxTime=void 0;var nbTry=0;var currentTime=0;var intervalID=void 0;var recordEndTimeOut=512;var constraints={audio:true};function handleDataAvailable(event){if(event.data&&event.data.size>0){tempRecordedBlobs.push(event.data)}}$(".modal").on("shown.bs.modal",function(){console.log("modal shown")});$("body").on("click",".play",function(){playAudio(this)});$("body").on("click",".stop",function(){stopAudio(this)});$("body").on("click",".delete",function(){deleteAudio(this)});$("body").on("click",'input[name="audio-selected"]',function(){audioSelected(this)});$(".modal").on("hide.bs.modal",function(){console.log("modal closed");resetData()});var promisifiedOldGUM=function promisifiedOldGUM(constraints,successCallback,errorCallback){var getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia;if(!getUserMedia){return _promise2.default.reject(new Error("getUserMedia is not implemented in this browser"))}return new _promise2.default(function(successCallback,errorCallback){getUserMedia.call(navigator,constraints,successCallback,errorCallback)})};if(navigator.mediaDevices===undefined){navigator.mediaDevices={}}if(navigator.mediaDevices.getUserMedia===undefined){navigator.mediaDevices.getUserMedia=promisifiedOldGUM}navigator.mediaDevices.getUserMedia(constraints).then(gumSuccess).catch(gumError);function gumSuccess(stream){if(isDebug){console.log("success");console.log("getUserMedia() got stream: ",stream)}window.stream=stream;createVolumeMeter();init()}function gumError(error){var msg="navigator.getUserMedia error.";if(isDebug){console.log(msg,error)}}function init(){$("#resource-name-input").on("change paste keyup",function(){if($(this).val()===""){$(this).attr("placeholder","provide a name for the resource");$("#submitButton").prop("disabled",true)}else if($("input:checked").length>0){$("#submitButton").prop("disabled",false)}$(this).val(function(i,val){return val.replace(" ","_")})});$("#audio-record-start").on("click",recordStream);$("#audio-record-stop").on("click",stopRecording);$("#btn-audio-download").on("click",download);$("#submitButton").on("click",uploadAudio);maxTry=parseInt($("#maxTry").val());maxTime=parseInt($("#maxTime").val());$("#audio-record-start").prop("disabled","");currentTime=0}function recordStream(){$("#audio-record-start").hide();$("#audio-record-stop").show();$(".max-try-reached").hide();$(".max-time-reached").hide();$(".stop-recording-message").hide();tempRecordedBlobs=[];try{recorder=new MediaRecorder(window.stream)}catch(e){var msg="Unable to create MediaRecorder with options Object.";if(isDebug){console.log(msg,e)}}recorder.ondataavailable=handleDataAvailable;recorder.start(10);if(maxTime>0){intervalID=window.setInterval(function(){currentTime+=1;var hms=secondsTohhmmss(currentTime);$(".current-time").text(hms);if(currentTime===maxTime){window.clearInterval(intervalID);stopRecording(true)}},1e3)}nbTry++;if(isDebug){console.log("MediaRecorder started",recorder)}}function stopRecording(maxTimeReached){if(nbTry<maxTry){$("#audio-record-start").prop("disabled",false)}else{$("#audio-record-start").prop("disabled",true);$(".max-try-reached").show()}$("#audio-record-stop").hide();$("#audio-record-start").show();if(maxTimeReached===true){$(".max-time-reached").show()}else{$(".stop-recording-message").show()}var recLength=currentTime;if(maxTime>0){currentTime=0;var hms=secondsTohhmmss(currentTime);$(".current-time").text(hms)}window.clearInterval(intervalID);window.setTimeout(function(){recorder.stop();if(isDebug){console.log(tempRecordedBlobs)}var options=isFirefox?"audio/ogg; codecs=opus":"audio/wav";var superBuffer=new Blob(tempRecordedBlobs,{type:options});var audioObject=new Audio;audioObject.src=window.URL?window.URL.createObjectURL(superBuffer):superBuffer;audios.push(audioObject);aBlobs.push(superBuffer);var template='\n                      <div class="recorded-row-content">\n                        <div class="btn-group">\n                          <button type="button" role="button" class="btn btn-default fa fa-play play"></button>\n                          <button type="button" role="button" class="btn btn-default fa fa-stop stop"></button>\n                          <button type="button" role="button" class="btn btn-danger fa fa-trash delete"></button>\n                        </div>\n                        <span class="recording-time"><small>('+secondsTohhmmss(recLength)+")</small></span>\n                      </div>\n                    ";$("#tr-preview-"+aid.toString()).find("td.actions").append(template);$("#tr-preview-"+aid.toString()).find("input").prop("disabled",false);aid++},recordEndTimeOut)}function audioSelected(elem){$("#submitButton").prop("disabled",false)}function resetData(){cancelAnalyserUpdates();if(window.stream){window.stream.getAudioTracks().forEach(function(track){track.stop()})}}function playAudio(elem){var index=$(elem).closest(".recorded-audio-row").attr("data-index");audios[index].play()}function stopAudio(elem){var index=$(elem).closest(".recorded-audio-row").attr("data-index");audios[index].pause();audios[index].currentTime=0}function deleteAudio(elem){var index=$(elem).closest(".recorded-audio-row").attr("data-index");audios.splice(index,1);aBlobs.splice(index,1);$("#tr-preview-"+index.toString()).find(".recorded-row-content").remove();$("#tr-preview-"+index.toString()).find("input").prop("disabled",true);var noAudioSelected=$("input:checked").length===0;if(audios.length===0||noAudioSelected){$("#submitButton").prop("disabled",true)}var rowIndexToPopulate=0;$(".recorded-audio-row").each(function(i){var $temp=$(this).find(".recorded-row-content").clone();$(this).find(".recorded-row-content").remove();$(this).find("input").prop("disabled",true);if($temp.length>0){$("#tr-preview-"+rowIndexToPopulate.toString()).find(".actions").append($temp);$("#tr-preview-"+rowIndexToPopulate.toString()).find("input").prop("disabled",false);rowIndexToPopulate++}});aid=audios.length;nbTry--;if(nbTry<maxTry){$("#audio-record-start").prop("disabled",false);$(".stop-recording-message").hide();$(".max-try-reached").hide();$(".max-time-reached").hide()}}function uploadAudio(){var index=-1;index=$("input:checked").closest(".recorded-audio-row").attr("data-index");if(index>-1){$("#submitButton").prop("disabled",true);var blob=aBlobs[index];var formData=new FormData;if(isFirefox){formData.append("nav","firefox")}else{formData.append("nav","chrome")}formData.append("convert",true);formData.append("file",blob);var fileName=$("#resource-name-input").val();formData.append("fileName",fileName);var route=$("#arForm").attr("action");xhr(route,formData,null,function(fileURL){})}}function xhr(url,data,progress,callback){var message=Translator.trans("creating_resource",{},"innova_audio_recorder");$("#form-content").hide();$(".progress-row").show();var request=new XMLHttpRequest;request.onreadystatechange=function(){if(request.readyState===4&&request.status===200){if(isDebug)console.log("xhr end with success");resetData();location.reload()}else if(request.status===500){if(isDebug){console.log("xhr error");console.log(request)}$(".progress-row").hide();$(".error-row").show();$("#submitButton").prop("disabled",true)}};request.upload.onprogress=function(e){if(e.lengthComputable){var percent=Math.round(100*e.loaded/e.total);var $div=$(".progress-bar");var $span=$div.find("span");$div.attr("aria-valuenow",percent);$div.css("width",percent+"%");$div.text(percent+"%");$span.text(percent+"%")}};request.open("POST",url,true);request.send(data)}function download(){var index=$("input:checked").closest(".recorded-audio-row").attr("data-index");var blob=aBlobs[index];var url=window.URL.createObjectURL(blob);var a=document.createElement("a");a.style.display="none";a.href=url;var fileName=$("#resource-name-input").val();a.download=fileName+".webm";document.body.appendChild(a);a.click();setTimeout(function(){document.body.removeChild(a);window.URL.revokeObjectURL(url)},100)}function secondsTohhmmss(value){var hours=Math.floor(value/3600);var minutes=Math.floor((value-hours*3600)/60);var seconds=value-hours*3600-minutes*60;seconds=Math.round(seconds*100)/100;var result="";if(hours>0){result+=hours.toString()+" h "}if(minutes>0){result+=minutes.toString()+" min "}result+=seconds.toString()+" s";return result}function createVolumeMeter(){realAudioInput=audioContext.createMediaStreamSource(window.stream);meter=new _jsMeter2.default;meter.setup(audioContext,realAudioInput)}function cancelAnalyserUpdates(){if(meter){window.cancelAnimationFrame(meter.rafID)}}},430:function(module,exports,__webpack_require__){module.exports={default:__webpack_require__(431),__esModule:true}},431:function(module,exports,__webpack_require__){__webpack_require__(84);__webpack_require__(37);__webpack_require__(66);__webpack_require__(432);module.exports=__webpack_require__(20).Promise},432:function(module,exports,__webpack_require__){"use strict";var LIBRARY=__webpack_require__(42),global=__webpack_require__(19),ctx=__webpack_require__(21),classof=__webpack_require__(268),$export=__webpack_require__(18),isObject=__webpack_require__(26),aFunction=__webpack_require__(22),anInstance=__webpack_require__(263),forOf=__webpack_require__(264),speciesConstructor=__webpack_require__(433),task=__webpack_require__(434).set,microtask=__webpack_require__(436)(),PROMISE="Promise",TypeError=global.TypeError,process=global.process,$Promise=global[PROMISE],process=global.process,isNode=classof(process)=="process",empty=function(){},Internal,GenericPromiseCapability,Wrapper;var USE_NATIVE=!!function(){try{var promise=$Promise.resolve(1),FakePromise=(promise.constructor={})[__webpack_require__(63)("species")]=function(exec){exec(empty,empty)};return(isNode||typeof PromiseRejectionEvent=="function")&&promise.then(empty)instanceof FakePromise}catch(e){}}();var sameConstructor=function(a,b){return a===b||a===$Promise&&b===Wrapper};var isThenable=function(it){var then;return isObject(it)&&typeof(then=it.then)=="function"?then:false};var newPromiseCapability=function(C){return sameConstructor($Promise,C)?new PromiseCapability(C):new GenericPromiseCapability(C)};var PromiseCapability=GenericPromiseCapability=function(C){var resolve,reject;this.promise=new C(function($$resolve,$$reject){if(resolve!==undefined||reject!==undefined)throw TypeError("Bad Promise constructor");resolve=$$resolve;reject=$$reject});this.resolve=aFunction(resolve);this.reject=aFunction(reject)};var perform=function(exec){try{exec()}catch(e){return{error:e}}};var notify=function(promise,isReject){if(promise._n)return;promise._n=true;var chain=promise._c;microtask(function(){var value=promise._v,ok=promise._s==1,i=0;var run=function(reaction){var handler=ok?reaction.ok:reaction.fail,resolve=reaction.resolve,reject=reaction.reject,domain=reaction.domain,result,then;try{if(handler){if(!ok){if(promise._h==2)onHandleUnhandled(promise);promise._h=1}if(handler===true)result=value;else{if(domain)domain.enter();result=handler(value);if(domain)domain.exit()}if(result===reaction.promise){reject(TypeError("Promise-chain cycle"))}else if(then=isThenable(result)){then.call(result,resolve,reject)}else resolve(result)}else reject(value)}catch(e){reject(e)}};while(chain.length>i)run(chain[i++]);promise._c=[];promise._n=false;if(isReject&&!promise._h)onUnhandled(promise)})};var onUnhandled=function(promise){task.call(global,function(){var value=promise._v,abrupt,handler,console;if(isUnhandled(promise)){abrupt=perform(function(){if(isNode){process.emit("unhandledRejection",value,promise)}else if(handler=global.onunhandledrejection){handler({promise:promise,reason:value})}else if((console=global.console)&&console.error){console.error("Unhandled promise rejection",value)}});promise._h=isNode||isUnhandled(promise)?2:1}promise._a=undefined;if(abrupt)throw abrupt.error})};var isUnhandled=function(promise){if(promise._h==1)return false;var chain=promise._a||promise._c,i=0,reaction;while(chain.length>i){reaction=chain[i++];if(reaction.fail||!isUnhandled(reaction.promise))return false}return true};var onHandleUnhandled=function(promise){task.call(global,function(){var handler;if(isNode){process.emit("rejectionHandled",promise)}else if(handler=global.onrejectionhandled){handler({promise:promise,reason:promise._v})}})};var $reject=function(value){var promise=this;if(promise._d)return;promise._d=true;promise=promise._w||promise;promise._v=value;promise._s=2;if(!promise._a)promise._a=promise._c.slice();notify(promise,true)};var $resolve=function(value){var promise=this,then;if(promise._d)return;promise._d=true;promise=promise._w||promise;try{if(promise===value)throw TypeError("Promise can't be resolved itself");if(then=isThenable(value)){microtask(function(){var wrapper={_w:promise,_d:false};try{then.call(value,ctx($resolve,wrapper,1),ctx($reject,wrapper,1))}catch(e){$reject.call(wrapper,e)}})}else{promise._v=value;promise._s=1;notify(promise,false)}}catch(e){$reject.call({_w:promise,_d:false},e)}};if(!USE_NATIVE){$Promise=function Promise(executor){anInstance(this,$Promise,PROMISE,"_h");aFunction(executor);Internal.call(this);try{executor(ctx($resolve,this,1),ctx($reject,this,1))}catch(err){$reject.call(this,err)}};Internal=function Promise(executor){this._c=[];this._a=undefined;this._s=0;this._d=false;this._v=undefined;this._h=0;this._n=false};Internal.prototype=__webpack_require__(262)($Promise.prototype,{then:function then(onFulfilled,onRejected){var reaction=newPromiseCapability(speciesConstructor(this,$Promise));reaction.ok=typeof onFulfilled=="function"?onFulfilled:true;reaction.fail=typeof onRejected=="function"&&onRejected;reaction.domain=isNode?process.domain:undefined;this._c.push(reaction);if(this._a)this._a.push(reaction);if(this._s)notify(this,false);return reaction.promise},catch:function(onRejected){return this.then(undefined,onRejected)}});PromiseCapability=function(){var promise=new Internal;this.promise=promise;this.resolve=ctx($resolve,promise,1);this.reject=ctx($reject,promise,1)}}$export($export.G+$export.W+$export.F*!USE_NATIVE,{Promise:$Promise});__webpack_require__(62)($Promise,PROMISE);__webpack_require__(437)(PROMISE);Wrapper=__webpack_require__(20)[PROMISE];$export($export.S+$export.F*!USE_NATIVE,PROMISE,{reject:function reject(r){var capability=newPromiseCapability(this),$$reject=capability.reject;$$reject(r);return capability.promise}});$export($export.S+$export.F*(LIBRARY||!USE_NATIVE),PROMISE,{resolve:function resolve(x){if(x instanceof $Promise&&sameConstructor(x.constructor,this))return x;var capability=newPromiseCapability(this),$$resolve=capability.resolve;$$resolve(x);return capability.promise}});$export($export.S+$export.F*!(USE_NATIVE&&__webpack_require__(438)(function(iter){$Promise.all(iter)["catch"](empty)})),PROMISE,{all:function all(iterable){var C=this,capability=newPromiseCapability(C),resolve=capability.resolve,reject=capability.reject;var abrupt=perform(function(){var values=[],index=0,remaining=1;forOf(iterable,false,function(promise){var $index=index++,alreadyCalled=false;values.push(undefined);remaining++;C.resolve(promise).then(function(value){if(alreadyCalled)return;alreadyCalled=true;values[$index]=value;--remaining||resolve(values)},reject)});--remaining||resolve(values)});if(abrupt)reject(abrupt.error);return capability.promise},race:function race(iterable){var C=this,capability=newPromiseCapability(C),reject=capability.reject;var abrupt=perform(function(){forOf(iterable,false,function(promise){C.resolve(promise).then(capability.resolve,reject)})});if(abrupt)reject(abrupt.error);return capability.promise}})},433:function(module,exports,__webpack_require__){var anObject=__webpack_require__(25),aFunction=__webpack_require__(22),SPECIES=__webpack_require__(63)("species");module.exports=function(O,D){var C=anObject(O).constructor,S;return C===undefined||(S=anObject(C)[SPECIES])==undefined?D:aFunction(S)}},434:function(module,exports,__webpack_require__){var ctx=__webpack_require__(21),invoke=__webpack_require__(435),html=__webpack_require__(61),cel=__webpack_require__(30),global=__webpack_require__(19),process=global.process,setTask=global.setImmediate,clearTask=global.clearImmediate,MessageChannel=global.MessageChannel,counter=0,queue={},ONREADYSTATECHANGE="onreadystatechange",defer,channel,port;var run=function(){var id=+this;if(queue.hasOwnProperty(id)){var fn=queue[id];delete queue[id];fn()}};var listener=function(event){run.call(event.data)};if(!setTask||!clearTask){setTask=function setImmediate(fn){var args=[],i=1;while(arguments.length>i)args.push(arguments[i++]);queue[++counter]=function(){invoke(typeof fn=="function"?fn:Function(fn),args)};defer(counter);return counter};clearTask=function clearImmediate(id){delete queue[id]};if(__webpack_require__(53)(process)=="process"){defer=function(id){process.nextTick(ctx(run,id,1))}}else if(MessageChannel){channel=new MessageChannel;port=channel.port2;channel.port1.onmessage=listener;defer=ctx(port.postMessage,port,1)}else if(global.addEventListener&&typeof postMessage=="function"&&!global.importScripts){defer=function(id){global.postMessage(id+"","*")};global.addEventListener("message",listener,false)}else if(ONREADYSTATECHANGE in cel("script")){defer=function(id){html.appendChild(cel("script"))[ONREADYSTATECHANGE]=function(){html.removeChild(this);run.call(id)}}}else{defer=function(id){setTimeout(ctx(run,id,1),0)}}}module.exports={set:setTask,clear:clearTask}},435:function(module,exports){module.exports=function(fn,args,that){var un=that===undefined;switch(args.length){case 0:return un?fn():fn.call(that);case 1:return un?fn(args[0]):fn.call(that,args[0]);case 2:return un?fn(args[0],args[1]):fn.call(that,args[0],args[1]);case 3:return un?fn(args[0],args[1],args[2]):fn.call(that,args[0],args[1],args[2]);case 4:return un?fn(args[0],args[1],args[2],args[3]):fn.call(that,args[0],args[1],args[2],args[3])}return fn.apply(that,args)}},436:function(module,exports,__webpack_require__){var global=__webpack_require__(19),macrotask=__webpack_require__(434).set,Observer=global.MutationObserver||global.WebKitMutationObserver,process=global.process,Promise=global.Promise,isNode=__webpack_require__(53)(process)=="process";module.exports=function(){var head,last,notify;var flush=function(){var parent,fn;if(isNode&&(parent=process.domain))parent.exit();while(head){fn=head.fn;head=head.next;try{fn()}catch(e){if(head)notify();else last=undefined;throw e}}last=undefined;if(parent)parent.enter()};if(isNode){notify=function(){process.nextTick(flush)}}else if(Observer){var toggle=true,node=document.createTextNode("");new Observer(flush).observe(node,{characterData:true});notify=function(){node.data=toggle=!toggle}}else if(Promise&&Promise.resolve){var promise=Promise.resolve();notify=function(){promise.then(flush)}}else{notify=function(){macrotask.call(global,flush)}}return function(fn){var task={fn:fn,next:undefined};if(last)last.next=task;if(!head){head=task;notify()}last=task}}},437:function(module,exports,__webpack_require__){"use strict";var global=__webpack_require__(19),core=__webpack_require__(20),dP=__webpack_require__(24),DESCRIPTORS=__webpack_require__(28),SPECIES=__webpack_require__(63)("species");module.exports=function(KEY){var C=typeof core[KEY]=="function"?core[KEY]:global[KEY];if(DESCRIPTORS&&C&&!C[SPECIES])dP.f(C,SPECIES,{configurable:true,get:function(){return this}})}},439:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _classCallCheck2=__webpack_require__(13);var _classCallCheck3=_interopRequireDefault(_classCallCheck2);var _createClass2=__webpack_require__(14);var _createClass3=_interopRequireDefault(_createClass2);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var Meter=function(){function Meter(options){(0,_classCallCheck3.default)(this,Meter);this.options={fill:typeof options!=="undefined"&&typeof options.fill!=="undefined"?options.fill:"#eeeeee",element:typeof options!=="undefined"&&typeof options.element!=="undefined"?options.element:"db-meter",bars:typeof options!=="undefined"&&typeof options.bars!=="undefined"?options.bars:8};this.rafID=null;this.canvas=document.getElementById(this.options.element);this.context=this.canvas.getContext("2d");this.dataArray;this.bar={x:0,y:0,w:this.canvas.width,h:this.canvas.height/this.options.bars};this.context.fillStyle=this.options.fill;this.context.fillRect(0,0,this.canvas.width,this.canvas.height)}(0,_createClass3.default)(Meter,[{key:"setup",value:function setup(actx,source){this.actx=actx;this.source=source;this.analyser=this.actx.createAnalyser();this.analyser.smoothingTimeConstant=.85;this.analyser.fftsize=1024;this.bufferLength=this.analyser.frequencyBinCount;this.dataArray=new Uint8Array(this.bufferLength);this.source.connect(this.analyser);this.draw()}},{key:"draw",value:function draw(){if(this.dataArray){this.analyser.getByteTimeDomainData(this.dataArray);var max=Math.max.apply(null,this.dataArray);var min=Math.min.apply(null,this.dataArray);var amp=max-min;amp/=240;var db=20*(Math.log(amp)/Math.log(10));this.context.fillStyle=this.options.fill;this.context.fillRect(0,0,this.canvas.width,this.canvas.height);var dboffset=Math.floor((db+40)/(50/this.options.bars));for(var i=0;i<this.options.bars;i++){if(i>=this.options.bars*.8){this.context.fillStyle="#ff0000"}else if(i<this.options.bars*.8&&i>=this.options.bars*.69){this.context.fillStyle="#ffff00"}else if(i<this.options.bars*.69){this.context.fillStyle="#10ff00"}if(i<=dboffset+1){this.context.fillRect(1,this.canvas.height-this.bar.h*i,this.canvas.width-2,this.bar.h-2)}}}window.cancelAnimationFrame(this.rafID);setTimeout(function(){this.rafID=window.requestAnimationFrame(this.draw.bind(this))}.bind(this),80)}}]);return Meter}();exports.default=Meter}});