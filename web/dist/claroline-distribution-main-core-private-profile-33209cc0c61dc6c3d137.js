webpackJsonp([8],{0:function(module,exports,__webpack_require__){"use strict";var _index=__webpack_require__(1);var _index2=_interopRequireDefault(_index);__webpack_require__(5);__webpack_require__(6);__webpack_require__(248);__webpack_require__(90);__webpack_require__(237);var _interceptorsDefault=__webpack_require__(89);var _interceptorsDefault2=_interopRequireDefault(_interceptorsDefault);var _ProfileDirective=__webpack_require__(279);var _ProfileDirective2=_interopRequireDefault(_ProfileDirective);__webpack_require__(149);__webpack_require__(9);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}_index2.default.module("UserProfile",["ui.bootstrap","ui.fos-js-router","ui.translation","ClarolineAPI","ui.asset","ui.html-truster","FormBuilder","ngTable"]).directive("userProfile",function(){return new _ProfileDirective2.default}).config(_interceptorsDefault2.default)},134:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _classCallCheck2=__webpack_require__(13);var _classCallCheck3=_interopRequireDefault(_classCallCheck2);var _createClass2=__webpack_require__(14);var _createClass3=_interopRequireDefault(_createClass2);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var NotBlank=function(){function NotBlank(){(0,_classCallCheck3.default)(this,NotBlank)}(0,_createClass3.default)(NotBlank,[{key:"validate",value:function validate(el){return!(el===undefined||el===""||el===null)}},{key:"getErrorMessage",value:function getErrorMessage(el){return Translator.trans("value_not_blank",{},"validators")}}]);return NotBlank}();exports.default=NotBlank},279:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _classCallCheck2=__webpack_require__(13);var _classCallCheck3=_interopRequireDefault(_classCallCheck2);var _ProfileController=__webpack_require__(280);var _ProfileController2=_interopRequireDefault(_ProfileController);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var ProfileDirective=function ProfileDirective(){(0,_classCallCheck3.default)(this,ProfileDirective);this.scope={};this.restrict="E";this.template=__webpack_require__(281);this.replace=false;this.controller=_ProfileController2.default;this.controllerAs="pc"};exports.default=ProfileDirective},280:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _classCallCheck2=__webpack_require__(13);var _classCallCheck3=_interopRequireDefault(_classCallCheck2);var _createClass2=__webpack_require__(14);var _createClass3=_interopRequireDefault(_createClass2);var _NotBlank=__webpack_require__(134);var _NotBlank2=_interopRequireDefault(_NotBlank);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var ProfileController=function(){function ProfileController($http,$scope,FormBuilderService,ClarolineAPIService,NgTableParams){var _this=this;(0,_classCallCheck3.default)(this,ProfileController);this.$http=$http;this.$scope=$scope;this.FormBuilderService=FormBuilderService;this.ClarolineAPIService=ClarolineAPIService;this.user=[];this.arLinks=[];this.facets=[];this.forms=[];this.userId=window["userId"];this.canEdit=window["canEdit"];this.disabled=true;this.profileModeLabel=Translator.trans("edit_mode",{},"platform");this.fieldForms={};$http.get(Routing.generate("api_get_public_user",{user:this.userId})).then(function(d){_this.user=d.data;_this.picturePath="uploads/pictures/"+d.data.picture});$http.get(Routing.generate("api_get_profile_links",{user:this.userId})).then(function(d){return _this.arLinks=d.data});$http.get(Routing.generate("api_get_profile_facets",{user:this.userId})).then(function(d){_this.facets=d.data;_this.fieldForms=_this.getFieldsDefinition(_this.facets)});this.displayCourses=false;this.displayCourseWorkspace=false;this.coursesLoaded=false;this.sessions=[];this.sessionsTableParams=new NgTableParams({count:20},{counts:[10,20,50,100],dataset:this.sessions});$http.get(Routing.generate("api_get_courses_profile_tab_option")).then(function(d){_this.displayCourses=d["data"]["displayCourses"];_this.displayCourseWorkspace=d["data"]["displayWorkspace"]});this.fieldTypes=["text","number","date","radio","select","checkboxes","country","email"]}(0,_createClass3.default)(ProfileController,[{key:"onSubmit",value:function onSubmit(facet){var _this2=this;var fields=[];facet.panels.forEach(function(panel){panel.fields.forEach(function(field){fields.push(field)})});this.FormBuilderService.submit(Routing.generate("api_put_profile_fields",{user:this.userId}),{fields:fields},"PUT").then(function(){},function(){return _this2.ClarolineAPIService.errorModal()})}},{key:"switchProfileMode",value:function switchProfileMode(){if(this.disabled){this.disabled=false;this.profileModeLabel=Translator.trans("display_mode",{},"platform")}else{this.disabled=true;this.profileModeLabel=Translator.trans("edit_mode",{},"platform")}this.fieldForms=this.getFieldsDefinition(this.facets)}},{key:"getFieldsDefinition",value:function getFieldsDefinition(facets){var _this3=this;var fieldForms={};facets.forEach(function(facet){facet.panels.forEach(function(panel){panel.fields.forEach(function(field){fieldForms[field.id]=_this3.getFieldDefinition(field)})})});return fieldForms}},{key:"getFieldDefinition",value:function getFieldDefinition(field){var validators=[];if(field.is_required){validators.push(new _NotBlank2.default)}return[field.name,this.fieldTypes[field.type-1],{values:field.field_facet_choices,disabled:!(!this.disabled&&field.is_editable),validators:validators,show_errors:!this.disabled,choice_value:"value"}]}},{key:"loadCoursesProfile",value:function loadCoursesProfile(){var _this4=this;if(this.displayCourses&&!this.coursesLoaded){this.coursesLoaded=true;var url=Routing.generate("api_get_closed_sessions_by_leaner",{user:this.userId});this.$http.get(url).then(function(d){if(d["status"]===200){_this4.sessions.splice(0,_this4.sessions.length);d["data"].forEach(function(s){s["courseId"]=s["course"]["id"];s["courseTitle"]=s["course"]["title"];s["courseCode"]=s["course"]["code"];s["courseDescription"]=s["course"]["description"];_this4.sessions.push(s)})}})}}}]);return ProfileController}();exports.default=ProfileController},281:function(module,exports){module.exports='\n<script type="text/ng-template" id="facet_renderer.html">\n    <form class="form-horizontal">\n        <div class="panel-body">\n            <div class="panel-group" id="panel-facet-{{ facet.id }}" role="tablist">\n                <div class="panel panel-default" ng-repeat="(key, panel) in facet.panels">\n                    <div class="panel-heading" role="tab">\n                        <h4 class="panel-title">\n                            <a data-toggle="collapse" href="#panel-{{ panel.id }}" aria-expanded="true"  aria-controls="panel-facet-{{ panel.id }}">\n                                {{ panel.name }}\n                            </a>\n                        </h4>\n                    </div>\n                    <div id="panel-{{ panel.id }}" class="panel-collapse collapse in" role="tabpanel" aria-labelledby="panel-{{ panel.id }}">\n                        <div class="panel-body">\n                            <div ng-repeat="(key, field) in panel.fields">\n                               <form-field field="pc.fieldForms[field.id]" ng-model="field.user_field_value"></form-field>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n            </div>\n            <input ng-if="!pc.disabled" type="submit" ng-click="pc.onSubmit(facet)" class="btn btn-primary" aria-hidden="true" value="{{ \'edit\'|trans:{}:\'platform\' }}"></input>\n        </div>\n    </form>\n</script>\n\n<div class="panel-body">\n  <button ng-if="pc.canEdit" ng-click="pc.switchProfileMode()" class="btn btn-primary" style="margin-bottom: 10px;"> {{ pc.profileModeLabel }} </button>\n  <ul class="nav nav-tabs">\n      <li class="active"><a href="#general-profile" data-toggle="tab">{{ \'general\'|trans:{}:\'platform\' }}</a> </li>\n      <li ng-if="!facet.is_main" ng-repeat="(key, facet) in pc.facets"> <a href="#facet-{{ facet.id}}" data-toggle="tab"> {{ facet.name }}</a> </li>\n      <li ng-if="pc.displayCourses" ng-click="pc.loadCoursesProfile()">\n          <a href="#courses-profile" data-toggle="tab">{{ \'courses\'|trans:{}:\'cursus\' }}</a>\n      </li>\n  </ul>\n  <div id="facet-pane" class="tab-content">\n      <div class="tab-pane active" id="general-profile">\n          <div class="panel-body">\n              <div class="row">\n                  <aside class="col-md-2 profile_aside" role="complementary">\n                      <div class="avatar">\n                          <img ng-if="pc.user.picture"\n                               ng-src="{{ pc.picturePath | asset }}"\n                               class="profile_picture img-circle"\n                               alt="{{ pc.user.lastName + \' \' + pc.user.firstName }}"\n                               width="150px"\n                               height="150px"\n                          >\n                          <h1 ng-if="!pc.user.picture" class="profile_picture_placeholder"><i class="fa fa-user"></i></h1>\n                      </div>\n                      <div class="informations">\n                          <p class="text-center text-muted">\n                              {{ \'registered\'|trans:{}:\'platform\' }} {{ pc.user.creationDate }}\n                          </p>\n                      </div>\n                  </aside>\n                  <div class="col-md-6 profile_informations">\n                      <h2>{{ pc.user.lastName }}  {{ pc.user.firstName }} </h2>\n                      <p ng-if="pc.user.allowSendMail">\n                          <a class="fa fa-envelope" href="mailto:{{ pc.user.mail }}" title="{{ pc.user.mail }}">{{ pc.user.mail }}</a>\n                      </p>\n                      <p ng-if="pc.user.allowSendMessage">\n                          <a class="fa fa-pencil" href="{{ \'claro_message_form_for_user\'|path:{user: pc.user.id} }}"> {{ \'send_message\'|trans:{}:\'platform\' }}</a>\n                      </p>\n                      <p ng-if="pc.user.phone"><span class="fa fa-phone"></span> {{ pc.user.phone }}</p>\n                      <p ng-repeat="(key, link) in pc.arLinks"><a href="{{ link.url }}">\n                          {{ link.name|trans:{}: \'resource\' }}\n                      </a></p>\n                      <div ng-if="pc.user.description" class="description_block">\n                          <p class="lead">Description de {{ pc.user.lastName + \' \' + pc.user.firstName }}</p>\n                          <div class="description"> {{ pc.user.description }} </div>\n                      </div>\n                  </div>\n              </div>\n              <div ng-if="facet.is_main" ng-repeat="(key, facet) in pc.facets">\n                  <form class="facet-main" ng-include="\'facet_renderer.html\'"></form>\n              </div>\n          </div>\n      </div>\n      <div class="tab-pane" id="facet-{{ facet.id }}"  ng-if="!facet.is_main" ng-repeat="(key, facet) in pc.facets">\n          <div ng-include="\'facet_renderer.html\'"></div>\n      </div>\n      <div class="tab-pane" id="courses-profile" ng-if="pc.displayCourses">\n          <br>\n          <div class="table-responsive" ng-if="pc.sessions.length > 0">\n              <table class="table" ng-table="pc.sessionsTableParams" show-filter="true">\n                  <tr ng-repeat="session in $data">\n                      <td class="text-center" data-title="\'course\'|trans:{}:\'cursus\'" filter="{courseTitle: \'text\'}" sortable="\'courseTitle\'">\n                          {{ session[\'courseTitle\'] }}\n                      </td>\n                      <td class="text-center" data-title="\'course_code\'|trans:{}:\'cursus\'" filter="{courseCode: \'text\'}" sortable="\'courseCode\'">\n                          {{ session[\'courseCode\'] }}\n                      </td>\n                      <td class="text-center" data-title="\'session\'|trans:{}:\'cursus\'" filter="{name: \'text\'}" sortable="\'name\'">\n                          {{ session[\'name\'] }}\n                      </td>\n                      <td class="text-center" data-title="\'start_date\'|trans:{}:\'platform\'" sortable="\'startDate\'">\n                          {{ session[\'startDate\']|date:\'dd/MM/yyyy\' }}\n                      </td>\n                      <td class="text-center" data-title="\'end_date\'|trans:{}:\'platform\'" sortable="\'endDate\'">\n                          {{ session[\'endDate\']|date:\'dd/MM/yyyy\' }}\n                      </td>\n                      <td class="text-center" ng-if="pc.displayCourseWorkspace">\n                          <a ng-if="session[\'workspace\']" href="{{ \'claro_workspace_open\'|path:{\'workspaceId\': session[\'workspace\'][\'id\']} }}">\n                              <i class="fa fa-book"></i>\n                          </a>\n                      </td>\n                  </tr>\n              </table>\n          </div>\n      </div>\n  </div>\n</div>\n'}});