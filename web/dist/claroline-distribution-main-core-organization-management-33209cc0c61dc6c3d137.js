webpackJsonp([5],{0:function(module,exports,__webpack_require__){"use strict";__webpack_require__(10);var _dataTableHelpers=__webpack_require__(222);var _dataTableHelpers2=_interopRequireDefault(_dataTableHelpers);var _angularBootstrap=__webpack_require__(5);var _angularBootstrap2=_interopRequireDefault(_angularBootstrap);var _angularTranslation=__webpack_require__(6);var _angularTranslation2=_interopRequireDefault(_angularTranslation);var _angularUiRouter=__webpack_require__(4);var _angularUiRouter2=_interopRequireDefault(_angularUiRouter);var _angularBreadcrumb=__webpack_require__(223);var _angularBreadcrumb2=_interopRequireDefault(_angularBreadcrumb);var _angularUiTree=__webpack_require__(224);var _angularUiTree2=_interopRequireDefault(_angularUiTree);var _routing=__webpack_require__(225);var _routing2=_interopRequireDefault(_routing);var _module=__webpack_require__(9);var _module2=_interopRequireDefault(_module);var _module3=__webpack_require__(229);var _module4=_interopRequireDefault(_module3);var _EditOrganizationModalController=__webpack_require__(234);var _EditOrganizationModalController2=_interopRequireDefault(_EditOrganizationModalController);var _OrganizationController=__webpack_require__(235);var _OrganizationController2=_interopRequireDefault(_OrganizationController);var _OrganizationAPIService=__webpack_require__(236);var _OrganizationAPIService2=_interopRequireDefault(_OrganizationAPIService);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var OrganizationManager=angular.module("OrganizationManager",["ui.router","ui.tree","ui.bootstrap.tpls","LocationManager","ui.translation","ClarolineAPI","ncy-angular-breadcrumb"]).controller("EditOrganizationModalController",_EditOrganizationModalController2.default).controller("OrganizationController",["$http","OrganizationAPIService","$uibModal","ClarolineAPIService",_OrganizationController2.default]).service("OrganizationAPIService",_OrganizationAPIService2.default).config(_routing2.default)},222:function(module,exports,__webpack_require__){module.exports=__webpack_require__(3)(43)},223:function(module,exports,__webpack_require__){module.exports=__webpack_require__(3)(40)},225:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default=function($stateProvider,$urlRouterProvider){var translate=function translate(key){return window.Translator.trans(key,{},"platform")};$stateProvider.state("organizations",{abstract:true,url:"/organizations",template:__webpack_require__(226)}).state("organizations.list",{url:"",ncyBreadcrumb:{label:translate("organizations")},views:{organizations:{template:__webpack_require__(227),controller:"OrganizationController",controllerAs:"oc"}}}).state("organizations.locations",{url:"/locations",ncyBreadcrumb:{label:translate("locations"),parent:"organizations.list"},views:{locations:{template:__webpack_require__(228),controller:"LocationController",controllerAs:"lc"}}});$urlRouterProvider.otherwise("/organizations")}},226:function(module,exports){module.exports='<div ui-view="organizations"></div>\n<div ui-view="locations"></div>'},227:function(module,exports){module.exports='<script type="text/ng-template" id="nodes_renderer.html">\n    <div ui-tree-handle class="tree-node tree-node-content">\n        <div class="row">\n            <a class="btn btn-success btn-xs" ng-if="organization.children && organization.children.length > 0" data-nodrag ng-click="toggle(this)"><span\n                    ng-class="{\n                  \'fa fa-chevron-right\': collapsed,\n                  \'fa fa-chevron-down\': !collapsed\n                }"></span>\n            </a>\n            <div class="col-xs-6">{{ organization.name }}</div>\n            <button class="pull-right btn btn-danger btn-xs" ng-disabled="organization.default" data-nodrag ng-click="oc.deleteOrganization(organization)"><span\n                class="fa fa-trash-o"></span>\n            </button>\n            <button class="pull-right btn btn-success btn-xs" data-nodrag ng-click="oc.parametersOrganization(organization)"><span\n                class="fa fa-cogs"></span>\n            </button>\n            <button class="pull-right btn btn-primary btn-xs" data-nodrag ng-click="oc.addDepartment(organization)" style="margin-right: 8px;"><span\n                class="fa fa-plus"></span>\n            </button>\n        </div>\n    </div>\n    <ol ui-tree-nodes="" ng-model="organization.children" ng-class="{hidden: collapsed}">\n        <li ng-repeat="organization in organization.children" ui-tree-node ng-include="\'nodes_renderer.html\'">\n        </li>\n    </ol>\n</script>\n\n<div>\n    <button class="btn btn-primary" ng-click="oc.addRootOrganization()"> {{ \'add\'|trans:{}:\'platform\' }} </button>\n    <a class="btn btn-primary" ui-sref="organizations.locations"> {{ \'locations\'|trans:{}:\'platform\' }} </a>\n    <div ui-tree id="tree-root">\n        <ol ui-tree-nodes ng-model="oc.organizations">\n            <li ng-repeat="organization in oc.organizations" ui-tree-node ng-include="\'nodes_renderer.html\'"></li>\n        </ol>\n    </div>\n</div>\n'},228:function(module,exports){module.exports='<div>\n    <div class="btn-group">\n        <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">\n            <i class="fa fa-cog"></i> <span class="caret"></span>\n        </button>\n        <ul class="dropdown-menu">\n            <li><a class="pointer" id="addLocation" ng-click="lc.createForm()"> {{ \'new\'|trans:{}:\'platform\' }} </a></li>\n        </ul>\n    </div>\n    <div class="panel panel-body">\n        <dtable options="lc.dataTableOptions" rows="lc.locations" class="material">\n        </dtable>\n    </div>\n</div>\n'},229:function(module,exports,__webpack_require__){"use strict";__webpack_require__(10);var _angularBootstrap=__webpack_require__(5);var _angularBootstrap2=_interopRequireDefault(_angularBootstrap);var _LocationAPIService=__webpack_require__(230);var _LocationAPIService2=_interopRequireDefault(_LocationAPIService);var _LocationController=__webpack_require__(231);var _LocationController2=_interopRequireDefault(_LocationController);var _EditLocationModalController=__webpack_require__(233);var _EditLocationModalController2=_interopRequireDefault(_EditLocationModalController);var _CreateLocationModalController=__webpack_require__(232);var _CreateLocationModalController2=_interopRequireDefault(_CreateLocationModalController);var _module=__webpack_require__(9);var _module2=_interopRequireDefault(_module);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var LocationManager=angular.module("LocationManager",["ClarolineAPI","ui.bootstrap.tpls","ui.translation","data-table","ui.router","ncy-angular-breadcrumb"]).service("LocationAPIService",_LocationAPIService2.default).controller("EditLocationModalController",_EditLocationModalController2.default).controller("CreateLocationModalController",_CreateLocationModalController2.default).controller("LocationController",["$http","LocationAPIService","$uibModal","ClarolineAPIService",_LocationController2.default])},230:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _classCallCheck2=__webpack_require__(13);var _classCallCheck3=_interopRequireDefault(_classCallCheck2);var _createClass2=__webpack_require__(14);var _createClass3=_interopRequireDefault(_createClass2);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var LocationAPIService=function(){function LocationAPIService($http,ClarolineAPIService){(0,_classCallCheck3.default)(this,LocationAPIService);this.$http=$http;this.ClarolineAPIService=ClarolineAPIService}(0,_createClass3.default)(LocationAPIService,[{key:"findAll",value:function findAll(){return this.$http.get(Routing.generate("api_get_locations"))}},{key:"create",value:function create(newLocation){var data=this.ClarolineAPIService.formSerialize("location_form",newLocation);return this.$http.post(Routing.generate("api_post_location",{_format:"html"}),data,{headers:{"Content-Type":"application/x-www-form-urlencoded"}})}},{key:"delete",value:function _delete(locationId){return this.$http.delete(Routing.generate("api_delete_location",{location:locationId}))}},{key:"update",value:function update(locationId,updatedLocation){var data=this.ClarolineAPIService.formSerialize("location_form",updatedLocation);return this.$http.put(Routing.generate("api_put_location",{location:locationId,_format:"html"}),data,{headers:{"Content-Type":"application/x-www-form-urlencoded"}})}}]);return LocationAPIService}();exports.default=LocationAPIService},231:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _classCallCheck2=__webpack_require__(13);var _classCallCheck3=_interopRequireDefault(_classCallCheck2);var _createClass2=__webpack_require__(14);var _createClass3=_interopRequireDefault(_createClass2);var _CreateLocationModalController=__webpack_require__(232);var _CreateLocationModalController2=_interopRequireDefault(_CreateLocationModalController);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var LocationController=function(){function LocationController($http,LocationAPIService,$uibModal,ClarolineAPIService){var _this=this;(0,_classCallCheck3.default)(this,LocationController);this.$http=$http;this.LocationAPIService=LocationAPIService;this.$uibModal=$uibModal;this.locations=undefined;this.ClarolineAPIService=ClarolineAPIService;var columns=[{name:this.translate("name"),prop:"name",canAutoResize:false},{name:this.translate("address"),cellRenderer:function cellRenderer(){return"<div>{{ $row.street_number}}, {{ $row.street }}, {{ $row.pc }}, {{ $row.town }}, {{ $row.country }}</div>"}},{name:this.translate("actions"),cellRenderer:function cellRenderer(){return'<button class="btn-primary btn-xs" ng-click="lc.editLocation($row)" style="margin-right: 8px;"><i class="fa fa-pencil-square-o"></i></button><button class="btn-danger btn-xs" ng-click="lc.removeLocation($row)"><i class="fa fa-trash"></i></button>'}},{name:this.translate("coordinates"),cellRenderer:function(scope){var gmaplink="";return"<div>"+this.translate("latitude")+": {{ $row.latitude }} | "+this.translate("longitude")+": {{ $row.longitude }} |  "+gmaplink+" </div>"}.bind(this)}];this.dataTableOptions={scrollbarV:false,columnMode:"force",headerHeight:50,footerHeight:50,columns:columns};this.LocationAPIService.findAll().then(function(d){return _this.locations=d.data})}(0,_createClass3.default)(LocationController,[{key:"translate",value:function translate(key){return window.Translator.trans(key,{},"platform")}},{key:"removeLocation",value:function removeLocation(location){this.LocationAPIService.delete(location.id).then(function(d){this.removeLocationCallback(location)})}},{key:"removeLocationCallback",value:function removeLocationCallback(location){var index=this.locations.indexOf(location);if(index>-1)this.locations.splice(index,1)}},{key:"createForm",value:function createForm(){var _this2=this;var modal=this.$uibModal.open({templateUrl:Routing.generate("api_get_location_create_form",{_format:"html"}),controller:"CreateLocationModalController",controllerAs:"clfm",resolve:{locations:function locations(){return _this2.locations}}});modal.result.then(function(result){if(!result)return;_this2.locations.push(result)})}},{key:"editLocation",value:function editLocation(_location){var _this3=this;var modal=this.$uibModal.open({templateUrl:Routing.generate("api_get_location_edit_form",{_format:"html",location:_location.id})+"?bust="+Math.random().toString(36).slice(2),controller:"EditLocationModalController",controllerAs:"elfm",resolve:{locations:function locations(){return _this3.locations},location:function location(){return _location}}});modal.result.then(function(result){if(!result)return;_this3.ClarolineAPIService.replaceById(result,_this3.locations)})}}]);return LocationController}();exports.default=LocationController},232:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _classCallCheck2=__webpack_require__(13);var _classCallCheck3=_interopRequireDefault(_classCallCheck2);var _createClass2=__webpack_require__(14);var _createClass3=_interopRequireDefault(_createClass2);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var CreateLocationModalController=function(){function CreateLocationModalController(LocationAPIService,locations,$uibModal,$uibModalInstance){(0,_classCallCheck3.default)(this,CreateLocationModalController);this.LocationAPIService=LocationAPIService;this.locations=locations;this.$uibModal=$uibModal;this.$uibModalInstance=$uibModalInstance;this.location={}}(0,_createClass3.default)(CreateLocationModalController,[{key:"submit",value:function submit(){var _this=this;this.LocationAPIService.create(this.location).then(function(d){_this.$uibModalInstance.close(d.data)},function(d){if(d.status===400){_this.$uibModalInstance.close();_this.$uibModal.open({template:d.data,controller:"CreateLocationModalController",controllerAs:"clfm",bindToController:true,resolve:{locations:function locations(){return location}}})}})}}]);return CreateLocationModalController}();exports.default=CreateLocationModalController},233:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _classCallCheck2=__webpack_require__(13);var _classCallCheck3=_interopRequireDefault(_classCallCheck2);var _createClass2=__webpack_require__(14);var _createClass3=_interopRequireDefault(_createClass2);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var EditLocationModalController=function(){function EditLocationModalController(LocationAPIService,locations,location,$uibModalInstance,$uibModal,ClarolineAPIService){(0,_classCallCheck3.default)(this,EditLocationModalController);this.LocationAPIService=LocationAPIService;this.locations=locations;this.locationId=location.id;this.$uibModalInstance=$uibModalInstance;this.$uibModal=$uibModal;this.ClarolineAPIService=ClarolineAPIService}(0,_createClass3.default)(EditLocationModalController,[{key:"submit",value:function submit(){var _this=this;this.LocationAPIService.update(this.locationId,this.location).then(function(d){_this.$uibModalInstance.close(d.data)},function(d){if(d.status===400){_this.$uibModalInstance.close();_this.$uibModal.open({template:d.data,controller:"EditLocationModalController",controllerAs:"elfm",resolve:{locations:function(_locations){function locations(){return _locations.apply(this,arguments)}locations.toString=function(){return _locations.toString()};return locations}(function(){return locations}),location:function(_location){function location(){return _location.apply(this,arguments)}location.toString=function(){return _location.toString()};return location}(function(){return location})}})}})}}]);return EditLocationModalController}();exports.default=EditLocationModalController},234:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _classCallCheck2=__webpack_require__(13);var _classCallCheck3=_interopRequireDefault(_classCallCheck2);var _createClass2=__webpack_require__(14);var _createClass3=_interopRequireDefault(_createClass2);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var EditOrganizationModalController=function(){function EditOrganizationModalController(OrganizationAPIService,organizations,organization,$uibModalInstance,$uibModal,ClarolineAPIService){(0,_classCallCheck3.default)(this,EditOrganizationModalController);this.OrganizationAPIService=OrganizationAPIService;this.organizations=organizations;this.$uibModalInstance=$uibModalInstance;this.$uibModal=$uibModal;this.ClarolineAPIService=ClarolineAPIService;this.organizationId=organization.id;this.organization={}}(0,_createClass3.default)(EditOrganizationModalController,[{key:"submit",value:function submit(){var _this=this;this.OrganizationAPIService.update(this.organizationId,this.organization).then(function(d){_this.$uibModalInstance.close(d.data)},function(d){if(d.status===400){_this.$uibModalInstance.close();$uibModal.open({template:d.data,controller:"EditOrganizationModalController",controllerAs:"eofm",resolve:{organizations:function(_organizations){function organizations(){return _organizations.apply(this,arguments)}organizations.toString=function(){return _organizations.toString()};return organizations}(function(){return organizations}),organization:function(_organization){function organization(){return _organization.apply(this,arguments)}organization.toString=function(){return _organization.toString()};return organization}(function(){return organization})}})}})}}]);return EditOrganizationModalController}();exports.default=EditOrganizationModalController},235:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _classCallCheck2=__webpack_require__(13);var _classCallCheck3=_interopRequireDefault(_classCallCheck2);var _createClass2=__webpack_require__(14);var _createClass3=_interopRequireDefault(_createClass2);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var OrganizationController=function(){function OrganizationController($http,OrganizationAPIService,$uibModal,ClarolineAPIService){var _this=this;(0,_classCallCheck3.default)(this,OrganizationController);this.$http=$http;this.OrganizationAPIService=OrganizationAPIService;this.$uibModal=$uibModal;this.organizations=[];this.treeOptions={};this.ClarolineAPIService=ClarolineAPIService;OrganizationAPIService.findAll().then(function(d){return _this.organizations=d.data})}(0,_createClass3.default)(OrganizationController,[{key:"deleteOrganization",value:function deleteOrganization(organization){var _this2=this;this.OrganizationAPIService.delete(organization.id).then(function(d){return _this2.removeOrganization(_this2.organizations,organization.id)})}},{key:"addRootOrganization",value:function addRootOrganization(){var _this3=this;this.OrganizationAPIService.create("Organization"+Math.random(),"").then(function(d){return _this3.organizations.push(d.data)})}},{key:"addDepartment",value:function addDepartment(organization){this.OrganizationAPIService.create("Organization"+Math.random(),organization.id).then(function(d){if(organization.children===undefined)organization.children=[];organization.children.push(d.data)})}},{key:"parametersOrganization",value:function parametersOrganization(_organization){var _this4=this;var modal=this.$uibModal.open({templateUrl:Routing.generate("api_get_organization_edit_form",{organization:_organization.id,_format:"html"})+"?bust="+Math.random().toString(36).slice(2),controller:"EditOrganizationModalController",controllerAs:"eofm",resolve:{organizations:function organizations(){return _this4.organizations},organization:function organization(){return _organization}}});modal.result.then(function(result){if(!result)return;for(var i=0;i<_this4.organizations.length;i++){if(_this4.organizations[i].id===result.id){_this4.organizations[i]=result;return}else{_this4.recursiveParseOrganization(_this4.organizations[i],result)}}_this4.organizations=_this4.ClarolineAPIService.replaceById(result,_this4.organizations)})}},{key:"removeOrganization",value:function removeOrganization(organizations,organizationId){for(var i=0;i<organizations.length;i++){if(organizations[i].children)this.removeOrganization(organizations[i].children,organizationId);if(organizations[i].id===organizationId){organizations.splice(i,1)}}}},{key:"recursiveParseOrganization",value:function recursiveParseOrganization(organization,result){for(var i=0;i<organization.children.length;i++){if(organization.children[i].id===result.id){organization.children[i]=result;return}else{this.recursiveParseOrganization(organization.children[i],result)}}}}]);return OrganizationController}();exports.default=OrganizationController},236:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _classCallCheck2=__webpack_require__(13);var _classCallCheck3=_interopRequireDefault(_classCallCheck2);var _createClass2=__webpack_require__(14);var _createClass3=_interopRequireDefault(_createClass2);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var OrganizationAPIService=function(){function OrganizationAPIService($http,ClarolineAPIService){(0,_classCallCheck3.default)(this,OrganizationAPIService);this.$http=$http;this.ClarolineAPIService=ClarolineAPIService}(0,_createClass3.default)(OrganizationAPIService,[{key:"findAll",value:function findAll(){return this.$http.get(Routing.generate("api_get_organizations"))}},{key:"create",value:function create(name,parent){var data=this.ClarolineAPIService.formSerialize("organization_form",{name:name,parent:parent});return this.$http.post(Routing.generate("api_post_organization"),data,{headers:{"Content-Type":"application/x-www-form-urlencoded"}})}},{key:"delete",value:function _delete(organizationId){return this.$http.delete(Routing.generate("api_delete_organization",{organization:organizationId}))}},{key:"update",value:function update(organizationId,organization){var data=this.ClarolineAPIService.formSerialize("organization_form",organization);return this.$http.put(Routing.generate("api_put_organization",{organization:organizationId,_format:"html"}),data,{headers:{"Content-Type":"application/x-www-form-urlencoded"}})}}]);return OrganizationAPIService}();exports.default=OrganizationAPIService}});