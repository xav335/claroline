(function(){'use strict';window.Claroline=window.Claroline||{};var common=window.Claroline.Common={};var routing=window.Routing;common.createElement=function(tag,className)
{return $(document.createElement(tag)).addClass(className);};common.uploadfile=function(form,element,parent,callBack){var workspace=$(form).data('workspace');$(form).upload(routing.generate('claro_file_upload_with_tinymce',{'parent':parent}),function(done){if(done.getResponseHeader('Content-Type')==='application/json'){var data=$.parseJSON(done.responseText)
var resource=data[0];var nodes={};var mimeType='mime_type';nodes[resource.id]=new Array(resource.name,resource.type,resource[mimeType]);$(element).modal('hide');callBack(nodes);$.ajax(routing.generate('claro_resource_open_perms',{'node':resource.id}));}else{$('.progress',element).addClass('hide');$('.alert',element).removeClass('hide');$('.progress-bar',element).attr('aria-valuenow',0).css('width','0%').find('sr-only').text('0%');}},function(progress){var percent=Math.round((progress.loaded*100)/progress.totalSize);$('.progress',element).removeClass('hide');$('.alert',element).addClass('hide');$('.progress-bar',element).attr('aria-valuenow',percent).css('width',percent+'%').find('sr-only').text(percent+'%');});};common.hasNamespace=function(element,namespace)
{if(element.hasOwnProperty('namespace')&&element.namespace===namespace){return true;}};common.toggle=function(element,condition,className)
{className=className!==undefined?className:'hide';if(condition){element.removeClass(className);}else{element.addClass(className);}};$.fn.upload=function(remote,successFn,progressFn){return this.each(function(){var formData=new FormData($(this).parents('form').get(0));$.ajax({url:remote,type:'POST',xhr:function(){var myXhr=$.ajaxSettings.xhr();if(myXhr.upload&&progressFn){myXhr.upload.addEventListener('progress',progressFn,false);}
return myXhr;},data:formData,cache:false,contentType:false,processData:false,complete:function(res){if(successFn){successFn(res);}}});});};}());
(function(){'use strict';window.Claroline=window.Claroline||{};var translator=window.Translator;var routing=window.Routing;var common=window.Claroline.Common;var modal=window.Claroline.Modal={modalStack:[]};modal.push=function(element)
{var index=modal.modalStack.length-1;if(index>=0){var previousModal=modal.modalStack[index];if(!previousModal.hasClass('fullscreen')){previousModal.addClass('parent-hide');}}
modal.modalStack.push($(element));$('.modal-backdrop:not(.parent-hide)').addClass('parent-hide');};modal.pop=function()
{modal.modalStack.pop();var index=modal.modalStack.length-1;if(index>=0){modal.modalStack[index].removeClass('parent-hide');$('.modal-backdrop.parent-hide').removeClass('parent-hide');}};modal.hide=function()
{$('.modal').modal('hide');};modal.create=function(content,classes,styles)
{var classes=classes||'';var styles=styles||{};return common.createElement('div','modal fade '+classes).css(styles).html(content).appendTo('body').modal('show').on('hidden.bs.modal',function(){$(this).remove();});};modal.error=function()
{modal.hide();modal.simpleContainer(translator.trans('error_occured',{},'platform'),translator.trans('try_again_message',{},'home'));};modal.defaultFooter=function()
{return common.createElement('button','btn btn-primary').html(translator.trans('ok',{},'platform')).attr('data-dismiss','modal');};modal.simpleContainer=function(title,body,footer)
{footer=typeof(footer)!=='undefined'?footer:modal.defaultFooter();var modalHtml=common.createElement('div','modal-content').append(common.createElement('div','modal-header').append(common.createElement('button','close').html('&times;').attr('data-dismiss','modal')).append(common.createElement('h4','modal-title').html(title))).append(common.createElement('div','modal-body').html(body)).append(common.createElement('div','modal-footer').html(footer));var content=common.createElement('div','modal-dialog').html(modalHtml);return modal.create(content);};modal.confirmContainer=function(title,content,longModal)
{var btnSuccess=common.createElement('button','btn btn-primary btn-modal-confirm').html(translator.trans('ok',{},'platform'));if(!longModal)btnSuccess.attr('data-dismiss','modal');var footer=common.createElement('div').append(common.createElement('button','btn btn-default btn-modal-cancel').html(translator.trans('cancel',{},'platform')).attr('data-dismiss','modal')).append(btnSuccess);return modal.simpleContainer(title,content,footer);};modal.fromUrl=function(url,action)
{$.ajax(url).done(function(data){var element=modal.create(data);if(typeof(action)==='function'){action(element);}}).error(function(){modal.error();});};modal.fromRoute=function(route,variables,action)
{modal.fromUrl(routing.generate(route,variables),action);};modal.displayForm=function(url,successHandler,formRenderHandler,formId){$.ajax(url).success(function(data){var modalElement=modal.create(data);modalElement.on('click','button[type="submit"]',function(event){event.preventDefault();modal.submitForm(modalElement,successHandler,formId,formRenderHandler);});modalElement.on('keypress',function(event){if(event.keyCode===13&&event.target.nodeName!=='TEXTAREA'){event.preventDefault();modal.submitForm(modalElement,successHandler,formId,formRenderHandler);}});formRenderHandler(data);}).error(function(){modal.error();});};modal.confirmRequest=function(url,successHandler,successParameter,content,title,waitingHandler,waitingParameters,errorHandler,errorParameters,longModal){var myModal=modal.confirmContainer(title,content,longModal);myModal.on('click','.btn-primary',function(event){if(waitingHandler)waitingHandler(waitingParameters);$.ajax(url).success(function(data,status,jqXHR){successHandler(event,successParameter,data,jqXHR);}).error(function(data,status,jqXHR){if(errorHandler){errorHandler(errorParameters,data,jqXHR);}else{modal.error();}});});return myModal;};modal.submitForm=function(modalElement,callBack,formId,formRenderHandler)
{formRenderHandler=formRenderHandler||function(){};if(formId){var form=$(modalElement).find('form');var url=form.attr('action');var formData=new FormData(document.getElementById(formId));$.ajax({url:url,data:formData,type:'POST',processData:false,contentType:false,success:function(data,textStatus,jqXHR){if(jqXHR.getResponseHeader('Content-Type')==='application/json'){callBack(data,textStatus,jqXHR);$('.modal').modal('hide');}else{$('.modal-dialog',modalElement).replaceWith(data);formRenderHandler(data);}}});}else{var form=$('form',modalElement);var url=form.attr('action');var formData=form.serializeArray();$.post(url,formData).success(function(data,textStatus,jqXHR){if(jqXHR.getResponseHeader('Content-Type')==='application/json'){callBack(data,textStatus,jqXHR);modalElement.modal('hide');}else{$('.modal-dialog',modalElement).replaceWith(data);formRenderHandler(data);}}).error(function(){modal.error();});}};modal.isLastModal=function(element)
{var index=modal.modalStack.length-1;if(index>=0&&typeof(modal.modalStack[index])!==undefined&&modal.modalStack[index].get(0)===element){return true;}};$('body').on('show.bs.modal','.modal',function(event){if(common.hasNamespace(event,'bs.modal')&&!modal.isLastModal(this)){modal.push(this);$(this).on('hide.bs.modal',function(event){if(common.hasNamespace(event,'bs.modal')){modal.pop();}});}});}());
(function(){'use strict';window.Claroline=window.Claroline||{};var simpleRights=window.Claroline.SimpleRights={};simpleRights.getValue=function(element)
{return $(element).prop('checked')?true:false;};simpleRights.get=function(id,element)
{return $(element).parents('#rights-form-resource-tab-content').first().find('#'+id).first();};simpleRights.getTable=function(element)
{return simpleRights.get('simple',element);};simpleRights.getGeneral=function(element)
{return simpleRights.get('general',element);};simpleRights.checkEveryone=function(element)
{if(!simpleRights.getValue(element)){$('input#everyone',simpleRights.getTable(element)).prop('checked',false);}
if(simpleRights.getValue($('input#workspace',simpleRights.getTable(element)))&&simpleRights.getValue($('input#platform',simpleRights.getTable(element)))){$('input#everyone',simpleRights.getTable(element)).prop('checked',true);}};simpleRights.checkRole=function(role,element)
{var mask=simpleRights.getMask(element);var general=$('tr.'+role,simpleRights.getGeneral(element));if(simpleRights.getValue(element)){general.each(function(){for(var key in mask){if(mask.hasOwnProperty(key)){$($(this).find('input').get(parseInt(key)+1)).prop('checked',mask[key]);}}});}else{general.each(function(){$(this).find('input').prop('checked',false);});}};simpleRights.checkGeneral=function(selector,role,element){var mask=simpleRights.getMask(element);$('tr.'+selector,simpleRights.getGeneral(element)).each(function(){var value=true;for(var key in mask){if(mask.hasOwnProperty(key)&&mask[key]&&mask[key]!==simpleRights.getValue($(this).find('input').get(parseInt(key)+1))){value=false;}}
$('input#'+role,simpleRights.getTable(element)).prop('checked',value);});};simpleRights.checkAll=function(element)
{simpleRights.checkGeneral('role.anonymous','anonymous',element);simpleRights.checkGeneral('role:not(.anonymous,.user)','workspace',element);simpleRights.checkGeneral('role.user','platform',element);simpleRights.checkEveryone(element);var value=$('#advanced-recursive-option').prop('checked');$('#recursive-option').prop('checked',value);};simpleRights.getMask=function(element){var json=$(simpleRights.get('mask',element)).html();if(json!==undefined&&json!==''){return $.parseJSON(json);}else{return[true,false,true,false,false];}};simpleRights.everyone=function(element){$('input',simpleRights.getTable(element)).prop('checked',simpleRights.getValue(element));simpleRights.anonymous(element);simpleRights.workspace(element);simpleRights.platform(element);};simpleRights.anonymous=function(element){simpleRights.checkEveryone(element);simpleRights.checkRole('role.anonymous',element);};simpleRights.workspace=function(element){simpleRights.checkEveryone(element);simpleRights.checkRole('role:not(.anonymous,.user)',element);};simpleRights.platform=function(element){simpleRights.checkEveryone(element);simpleRights.checkRole('role.user',element);};simpleRights.recursive=function(element){var value=$(element).prop('checked');$('#advanced-recursive-option').prop('checked',value);};}());
(function(){'use strict';window.Claroline=window.Claroline||{};window.Claroline.ResourceManager=window.Claroline.ResourceManager||{};window.Claroline.ResourceManager.Views=window.Claroline.ResourceManager.Views||{};var views=Claroline.ResourceManager.Views;views.Actions=Backbone.View.extend({className:'navbar navbar-default navbar-static-top',events:{'click ul.create li a':'create','click a.delete':'delete','click a.download':'download','click a.copy':'copy','click a.cut':'cut','click a.paste':'paste','click a.publish':'publish','click a.unpublish':'unpublish','click button.config-search-panel':'toggleFilters','click button.filter':'filter','keypress input.name':'filter','click ul.zoom li a':'zoom','click a.open-picker':'openPicker','click a.add':'add','click .select-all-nodes':'selectAll','click .list-view':'listMode','click a.import':'import','click a.export':'export'},initialize:function(parameters,dispatcher){this.parameters=parameters;this.dispatcher=dispatcher;this.filters=null;this.isReadyToPaste=false;this.isCutMode=false;this.displayMode=parameters.displayMode;this.isWorkspace=parameters.isWorkspace;this.workspaceId=parameters.workspaceId;this.isSearchMode=false;this.lastSearchedName=null;this.zoomValue=parameters.zoom;this.currentDirectoryId=parameters.directoryId;this.targetDirectoryId=this.currentDirectoryId;this.checkedNodes={nodes:{},directoryId:this.currentDirectoryId,isSearchMode:this.isSearchMode};this.cutCpyNodes=[];this.setPasteBinState(false,false);this.dispatcher.on('open-directory',this.setTargetDirectory,this);this.dispatcher.on('directory-data-'+this.parameters.viewName,this.render,this);this.dispatcher.on('node-check-status-'+this.parameters.viewName,this.handleSelection,this);this.dispatcher.on('deleted-nodes-'+this.parameters.viewName,this.setInitialState,this);},create:function(event){var type=event.currentTarget.getAttribute('id');if(type==='resource_shortcut'){this.dispatcher.trigger('open-picker-shortcutPicker');}else{this.dispatcher.trigger('create-form',{action:'create-form',nodeId:this.currentDirectoryId,resourceType:event.currentTarget.getAttribute('id'),view:this.parameters.viewName});}},'delete':function(event){if(!this.$(event.currentTarget).hasClass('disabled')){var body=Twig.render(ResourceDeleteConfirmMessage,{'nodes':this.checkedNodes.nodes});this.dispatcher.trigger('confirm',{header:Translator.trans('delete',{},'platform'),body:body,callback:_.bind(function(){this.dispatcher.trigger('delete',{ids:_.keys(this.checkedNodes.nodes),view:this.parameters.viewName});},this)});}},'download':function(event){if(!this.$(event.currentTarget).hasClass('disabled')){this.dispatcher.trigger('download',{ids:_.keys(this.checkedNodes.nodes)});}},'copy':function(event){if(!this.$(event.currentTarget).hasClass('disabled')){this.setPasteBinState(true,false);}},'cut':function(event){if(!this.$(event.currentTarget).hasClass('disabled')){this.setPasteBinState(true,true);}},'paste':function(event){if(!this.$(event.currentTarget).hasClass('disabled')){var event=this.isCutMode?'move-nodes':'copy-nodes';this.dispatcher.trigger(event,{ids:_.keys(this.cutCpyNodes),directoryId:this.currentDirectoryId,sourceDirectoryId:this.checkedNodes.directoryId,view:this.parameters.viewName});if(this.isCutMode){this.setInitialState();}}},publish:makePublicationHandler('publish',ResourcePublishConfirmMessage),unpublish:makePublicationHandler('unpublish',ResourceUnpublishConfirmMessage),toggleFilters:function(){this.initFilters();this.filters.toggle();},filter:function(event){if(event.type==='keypress'&&event.keyCode!==13){return;}
event.preventDefault();this.initFilters();var parameters=this.filters.getParameters();var name=this.$('.name').val().trim();if(name){parameters.name=name;this.lastSearchedName=name;}
this.dispatcher.trigger('filter',{nodeId:this.currentDirectoryId,parameters:parameters,view:this.parameters.viewName});},zoom:function(event){this.zoomValue=event.currentTarget.getAttribute('id');this.dispatcher.trigger('change-zoom',{value:this.zoomValue});this.$('.dropdown-menu.zoom li').removeClass('active');this.$(event.currentTarget).parent().addClass('active');},openPicker:function(){this.dispatcher.trigger('open-picker-defaultPicker');},add:function(event){if(this.$(event.currentTarget).hasClass('disabled')){return;}
if(this.parameters.viewName==='defaultPicker'){this.dispatcher.trigger('copy-nodes',{ids:_.keys(this.checkedNodes.nodes),directoryId:this.targetDirectoryId,view:'main'});}else if(this.parameters.viewName==='shortcutPicker'){this.dispatcher.trigger('create-shortcuts',{ids:_.keys(this.checkedNodes.nodes),directoryId:this.targetDirectoryId,view:'main'});}else{this.parameters.pickerCallback(this.checkedNodes.nodes,this.currentDirectoryId);this.checkedNodes.nodes={};}
this.dispatcher.trigger('close-picker-'+this.parameters.viewName);},'initFilters':function(){if(!this.filters){this.filters=new views.Filters(this.parameters);this.filters.render(this.resourceTypes);this.$el.after(this.filters.el);}},setTargetDirectory:function(event){this.checkedNodes.nodes=[];if(event.view==='main'&&this.parameters.isPickerMode){this.targetDirectoryId=event.nodeId;}},handleSelection:function(event){if(this.isReadyToPaste){this.setPasteBinState(false,false);}
if(this.checkedNodes.directoryId!==this.currentDirectoryId||(this.checkedNodes.isSearchMode&&!this.isSearchMode)||(this.parameters.isPickerMode&&!this.parameters.isPickerMultiSelectAllowed&&event.isChecked)){this.checkedNodes.directoryId=this.currentDirectoryId;this.checkedNodes.nodes={};this.setPasteBinState(false,false);}
if(this.checkedNodes.nodes.hasOwnProperty(event.node.id)&&!event.isChecked){delete this.checkedNodes.nodes[event.node.id];var length=0;for(var i in this.checkedNodes.nodes){length++;}
if(length===0){this.setInitialState();}}else{this.checkedNodes.nodes[event.node.id]=[event.node.name,event.node.type,event.node.mimeType,event.node.path,event.node.id,event.node.mask];}
this.checkedNodes.directoryId=this.currentDirectoryId;this.checkedNodes.isSearchMode=this.isSearchMode;this.setActionsEnabledState(event.isPickerMode);},setPasteBinState:function(isReadyToPaste,isCutMode){this.isReadyToPaste=isReadyToPaste;this.isCutMode=isCutMode;this.cutCpyNodes=this.checkedNodes.nodes;this.setButtonEnabledState(this.$('a.paste'),isReadyToPaste&&(!this.isCutMode||this.checkedNodes.directoryId!==this.currentDirectoryId));},setInitialState:function(){this.checkedNodes.nodes={};this.cutCpyNodes=[];this.isReadyToPaste=false;this.isCutMode=false;this.setButtonEnabledState(this.$('a.cut'),false);this.setButtonEnabledState(this.$('a.copy'),false);this.setButtonEnabledState(this.$('a.paste'),false);this.setButtonEnabledState(this.$('a.delete'),false);this.setButtonEnabledState(this.$('a.download'),false);this.setButtonEnabledState(this.$('a.export'),false);},setButtonEnabledState:function(jqButton,isEnabled){return isEnabled?jqButton.removeClass('disabled'):jqButton.addClass('disabled');},setActionsEnabledState:function(isPickerMode){var isSelectionNotEmpty=_.size(this.checkedNodes.nodes)>0;if(isPickerMode&&(this.currentDirectoryId!=='0'||this.isSearchMode)){this.setButtonEnabledState(this.$('a.add'),isSelectionNotEmpty);}else{this.setButtonEnabledState(this.$('a.download'),isSelectionNotEmpty);this.setButtonEnabledState(this.$('a.export'),isSelectionNotEmpty);if(this.currentDirectoryId!=='0'||this.isSearchMode){this.setButtonEnabledState(this.$('a.cut'),isSelectionNotEmpty);this.setButtonEnabledState(this.$('a.copy'),isSelectionNotEmpty);this.setButtonEnabledState(this.$('a.delete'),isSelectionNotEmpty);this.setButtonEnabledState(this.$('a.publish'),isSelectionNotEmpty);this.setButtonEnabledState(this.$('a.unpublish'),isSelectionNotEmpty);}
var that=this;$.each(this.checkedNodes.nodes,function(i,node){if(node){if(that.isActionAvailable(node,'edit-properties')===0)that.setButtonEnabledState(that.$('a.publish'),false);if(that.isActionAvailable(node,'edit-properties')===0)that.setButtonEnabledState(that.$('a.unpublish'),false);if(that.isActionAvailable(node,'delete')===0)that.setButtonEnabledState(that.$('a.delete'),false);if(that.isActionAvailable(node,'copy')===0)that.setButtonEnabledState(that.$('a.copy'),false);if(that.isActionAvailable(node,'copy')===0)that.setButtonEnabledState(that.$('a.cut'),false);if(that.isActionAvailable(node,'download')===0)that.setButtonEnabledState(that.$('a.download'),false);if(that.isActionAvailable(node,'download')===0)that.setButtonEnabledState(that.$('a.export'),false);}});}},isActionAvailable:function(node,action){var type=this.parameters.resourceTypes[node[1]];var act=type.actions[action];return act?node[5]&act.mask:false;},render:function(event){if(event.isSearchMode&&!this.isSearchMode){this.checkedNodes.nodes={};this.checkedNodes.isSearchMode=true;}else if(!event.isSearchMode&&this.isSearchMode){this.lastSearchedName=null;this.filters&&this.filters.close();}
this.currentDirectoryId=event.id;this.isSearchMode=event.isSearchMode;var creatableTypes=event.creatableTypes||[];var isCreationAllowed=this.currentDirectoryId!=='0'&&!this.parameters.isPickerMode&&!this.isSearchMode;var isCreateAllowed=isCreationAllowed&&_.size(creatableTypes)>0;var isPasteAllowed=isCreationAllowed&&this.isReadyToPaste&&(!this.isCutMode||this.checkedNodes.directoryId!==event.id);var listViewActivated=this.displayMode==='list';$(this.el).html(Twig.render(ResourceManagerActions,{resourceTypes:this.parameters.resourceTypes,searchedName:this.lastSearchedName,isPickerMode:this.parameters.isPickerMode,isSearchMode:this.isSearchMode,isAddAllowed:isCreateAllowed,isPasteAllowed:isPasteAllowed,isCreateAllowed:isCreateAllowed,creatableTypes:creatableTypes,zoom:this.zoomValue,viewName:this.parameters.viewName,isMultiSelectAllowed:this.parameters.isPickerMultiSelectAllowed,listViewActivated:listViewActivated}));},selectAll:function(event){var chk=$(event.target);var isChecked=chk.is(':checked');this.checkedNodes.nodes={};this.setPasteBinState(false,false);this.setActionsEnabledState(event.isPickerMode);var that=this;if(isChecked){$('.node-chk-'+this.parameters.viewName).prop('checked',true);$.each($('.node-chk-'+this.parameters.viewName),(function(index,el){if($(el).attr('data-allow-select')==='true'){this.dispatcher.trigger('node-check-status-'+this.parameters.viewName,{node:{id:$(el).attr('value'),name:$(el).attr('data-node-name'),type:$(el).attr('data-type'),mimeType:$(el).attr('data-mime-type'),path:$(el).attr('data-path'),mask:$(el).attr('data-mask')},isChecked:true,isPickerMode:this.parameters.isPickerMode});}}).bind(this));}else{$('.node-chk-'+this.parameters.viewName).prop('checked',false);}},listMode:function(event){var chk=$(event.target);var mode=chk.is(':checked')?'list':'default';this.displayMode=mode;this.dispatcher.trigger('list-mode',{'viewName':this.parameters.viewName,'mode':mode});this.registerDisplayMode();},import:function(){this.dispatcher.trigger('import',{action:'import',nodeId:this.currentDirectoryId,view:this.parameters.viewName});},export:function(event){if(!this.$(event.currentTarget).hasClass('disabled')){this.dispatcher.trigger('export',{ids:_.keys(this.checkedNodes.nodes)});}},registerDisplayMode:function(){var index=this.isWorkspace?this.workspaceId:'desktop';$.ajax({url:Routing.generate('claro_resource_manager_display_mode_register',{index:index,displayMode:this.displayMode}),type:'POST'});}});function makePublicationHandler(status,view){return function(event){if(!this.$(event.currentTarget).hasClass('disabled')){var body=Twig.render(view,{'nodes':this.checkedNodes.nodes});this.dispatcher.trigger('confirm',{header:Translator.trans(status,{},'platform'),body:body,callback:_.bind(function(){this.dispatcher.trigger(status,{ids:_.keys(this.checkedNodes.nodes),view:this.parameters.viewName});},this)});}}}})();
(function(){'use strict';window.Claroline=window.Claroline||{};window.Claroline.ResourceManager=window.Claroline.ResourceManager||{};window.Claroline.ResourceManager.Views=window.Claroline.ResourceManager.Views||{};Claroline.ResourceManager.Views.Breadcrumbs=Backbone.View.extend({tagName:'ul',className:'breadcrumb',events:{'click a.node':'open'},initialize:function(parameters,dispatcher){this.parameters=parameters;this.dispatcher=dispatcher;this.rootBreadcrumbs=[];this.dispatcher.on('directory-data-'+this.parameters.viewName,this.render,this);if(this.parameters.breadcrumbElement){this.reuseElement();}},reuseElement:function(){this.setElement(this.parameters.breadcrumbElement);this.rootBreadcrumbs=this.$('li').toArray();this.rootBreadcrumbs.pop();this.rootBreadcrumbs=_.map(this.rootBreadcrumbs,function(element){return element.outerHTML;});},open:function(event){event.preventDefault()
this.dispatcher.trigger('open-directory',{nodeId:event.currentTarget.getAttribute('data-node-id'),view:this.parameters.viewName,fromPicker:this.parameters.isPickerMode});},render:function(event){if(this.parameters.isWorkspace&&!this.parameters.isPickerMode){var root=event.path.shift();}
this.$el.html(Twig.render(ResourceManagerBreadcrumbs,{'rootBreadcrumbs':this.rootBreadcrumbs,'rootNodeId':root?root.id:'0','nodes':event.path}));}});})();
(function(){'use strict';window.Claroline=window.Claroline||{};window.Claroline.ResourceManager=window.Claroline.ResourceManager||{};window.Claroline.ResourceManager.Views=window.Claroline.ResourceManager.Views||{};Claroline.ResourceManager.Views.Confirm=Backbone.View.extend({events:{'click #confirm-ok':'confirm'},initialize:function(dispatcher){this.dispatcher=dispatcher;this.callback=null;this.dispatcher.on('confirm',this.render,this);this.dispatcher.on('close-confirm',this.close,this);},confirm:function(){if(this.callback){this.callback();}},close:function(){this.$('.modal').modal('hide');},render:function(event){this.callback=event.callback;this.$el.html(Twig.render(ModalWindow,{header:event.header,body:event.body,confirmFooter:true,modalId:'confirm-modal'}));this.$('.modal').modal('show');}});})();
(function(){'use strict';window.Claroline=window.Claroline||{};window.Claroline.ResourceManager=window.Claroline.ResourceManager||{};window.Claroline.ResourceManager.Views=window.Claroline.ResourceManager.Views||{};Claroline.ResourceManager.Views.Filters=Backbone.View.extend({className:'filters container-fluid',events:{'click button.close-panel':'toggle','click input.datepicker':'openDatePicker','changeDate input.datepicker':'closeDatePicker','keydown input.datepicker':'closeDatePicker'},initialize:function(parameters){this.parameters=parameters;this.isVisible=false;this.$el.css('display','none');},toggle:function(){this.isVisible=!this.isVisible;this.$el.css('display',this.isVisible?'block':'none');},close:function(){if(this.isVisible){this.$el.css('display','none');}},openDatePicker:function(event){this.$(event.currentTarget).datepicker('show');},closeDatePicker:function(event){event.preventDefault();this.$(event.currentTarget).datepicker('hide');},getParameters:function(){var parameters={};var dateFrom=this.$('input.date-from').first().val();var dateTo=this.$('input.date-to').first().val();var types=this.$('select.node-types').val();if(dateFrom){parameters.dateFrom=dateFrom+' 00:00:00';}
if(dateTo){parameters.dateTo=dateTo+' 23:59:59';}
if(types){parameters.types=types;}
return parameters;},render:function(){this.$el.html(Twig.render(ResourceManagerFilters,{language:this.parameters.language,resourceTypes:this.parameters.resourceTypes}));}});})();
(function(){'use strict';window.Claroline=window.Claroline||{};window.Claroline.ResourceManager=window.Claroline.ResourceManager||{};window.Claroline.ResourceManager.Views=window.Claroline.ResourceManager.Views||{};Claroline.ResourceManager.Views.Form=Backbone.View.extend({events:{'submit form':'submit'},knownActions:{'create-form':{route:'claro_resource_creation_form',onSuccess:'created-nodes'},'rename':{route:'claro_resource_rename_form',onSuccess:'renamed-node'},'edit-properties':{route:'claro_resource_form_properties',onSuccess:'edited-node'},'custom-action-form':{route:'claro_resource_action',onSuccess:'custom-action-done'},'import':{route:'claro_resource_import_form',onSuccess:'reload-page'}},initialize:function(dispatcher){this.dispatcher=dispatcher;this.targetNodeId=null;this.eventOnSuccess=null;_.each(_.keys(this.knownActions),function(eventName){this.dispatcher.on(eventName,this.render,this);},this);this.dispatcher.on('error-form',this.render,this);this.dispatcher.on('submit-success',function(){this.$el.modal('hide');},this);},submit:function(event){event.preventDefault();var form=this.$('form');this.dispatcher.trigger('submit-form',{formAction:form.attr('action'),formData:new FormData(form[0]),targetNodeId:this.targetNodeId,eventOnSuccess:this.eventOnSuccess});},replaceId:function(id){if(this.$('form')&&this.$('form').attr('action')){var action=this.$('form').attr('action').replace('_nodeId',id);this.$('form').attr('action',action);}},render:function(event){this.targetNodeId=event.nodeId||this.targetNodeId;if(event.isCustomAction){this.eventOnSuccess='custom-action-done';}else{this.eventOnSuccess=event.eventOnSuccess||this.knownActions[event.action].onSuccess+'-'+event.view;}
if(!event.errorForm){var route=event.isCustomAction?'claro_resource_action':this.knownActions[event.action].route;if(event.action==='create-form'){var parameters={resourceType:event.resourceType};}else if(event.isCustomAction){var parameters={action:event.action,node:event.nodeId};}else{var parameters={node:event.nodeId};}
Claroline.Modal.fromRoute(route,parameters,_.bind(function(element){this.setElement(element);this.replaceId(event.nodeId);},this));}else{this.$el.html(event.errorForm);this.replaceId(this.targetNodeId);}}});})();
(function(){'use strict';window.Claroline=window.Claroline||{};window.Claroline.ResourceManager=window.Claroline.ResourceManager||{};window.Claroline.ResourceManager.Views=window.Claroline.ResourceManager.Views||{};var simpleRights=window.Claroline.SimpleRights;Claroline.ResourceManager.Views.Rights=Backbone.View.extend({events:{'change #simple input':'checkSimple','change #general input':'checkAdvanced','click #submit-default-rights-form-button':'submitSimpleAndAdvanced','click .res-creation-options':'openCreationOptions','click #form-node-creation-rights button[type=submit]':'submitCreationOptions','click .workspace-role-item':'displayWorkspaceRolePermissions','click #submit-right-form-button':'submitWorkspaceRolePermissions','click #search-user-with-rights-btn':'searchUsersWithRights','click #search-user-without-rights-btn':'searchUsersWithoutRights','click .pagination > ul > li > a':'pagination','click th > a':'reorder','click #add-new-user-rights-btn':'addUserClick','click #search-workspaces-btn':'searchWorkspaces'},initialize:function(dispatcher){this.dispatcher=dispatcher;this.mainElement=null;this.defaultRoute='claro_resource_right_form';this.dispatcher.on('edit-rights',this.render,this);this.dispatcher.on('edited-rights',function(){this.$el.modal('hide');},this);this.dispatcher.on('edited-workspace-rights',function(){this.$('#form-rights-tag-wrapper').empty();},this);this.dispatcher.on('workspace-role-rights',function(form){this.$('#form-rights-tag-wrapper').empty();this.$('#form-rights-tag-wrapper').append(form);},this);},checkSimple:function(event){var element=event.target;switch(this.$(element).attr('id')){case'everyone':simpleRights.everyone(element);break;case'anonymous':simpleRights.anonymous(element);break;case'workspace':simpleRights.workspace(element);break;case'platform':simpleRights.platform(element);break;case'recursive-option':simpleRights.recursive(element)
break;}},checkAdvanced:function(event){simpleRights.checkAll(event.target);},submitSimpleAndAdvanced:function(event){event.preventDefault();this.dispatchSubmit(this.$('form')[0],'edited-rights');},openCreationOptions:function(event){event.preventDefault();this.render({isCreationOptions:true,nodeId:event.currentTarget.getAttribute('data-node-id'),url:event.currentTarget.getAttribute('href')});},submitCreationOptions:function(event){event.preventDefault();this.dispatchSubmit(this.$('form')[0],'edited-creation-rights');},displayWorkspaceRolePermissions:function(event){event.preventDefault();this.dispatcher.trigger('get-url',{url:event.currentTarget.getAttribute('href'),onSuccess:'workspace-role-rights'});},submitWorkspaceRolePermissions:function(event){event.preventDefault();this.dispatchSubmit(this.$('form')[1],'edited-workspace-rights');},dispatchSubmit:function(form,eventOnSuccess){this.dispatcher.trigger('submit-form',{formAction:form.getAttribute('action'),formData:new FormData(form),eventOnSuccess:eventOnSuccess});},render:function(event){if(!event.isCreationOptions){Claroline.Modal.fromRoute(this.defaultRoute,{node:event.nodeId},_.bind(function(element){this.setElement(element);this.mainElement=element;var action=this.$('form').attr('action').replace('_nodeId',event.nodeId);this.$('form').attr('action',action);simpleRights.checkAll(this.$('#general input').first());},this));}else{Claroline.Modal.fromUrl(event.url,_.bind(function(element){this.setElement(element);this.$el.on('hidden.bs.modal',_.bind(function(){this.setElement(this.mainElement);},this));},this));}},searchUsersWithRights:function(){var search=$('#search-user-with-rights-input').val();var nodeId=$('#users-with-rights-datas').attr('data-node-id');$.ajax({url:Routing.generate('claro_resources_rights_users_with_rights_form',{'node':nodeId,'search':search}),type:'GET',success:function(datas){$('#users-with-rights-tab').empty();$('#users-with-rights-tab').append(datas);}});},searchWorkspaces:function(){var search=$('#search-workspaces-input').val();var nodeId=$('#workspaces-datas').data('node-id');var max=$('#workspaces-datas').data('max');$.ajax({url:Routing.generate('claro_all_workspaces_list_pager_for_resource_rights',{'resource':nodeId,'wsSearch':search,'page':1,'wsMax':max}),type:'GET',success:function(datas){$('#all-workspaces-panel').empty();$('#all-workspaces-panel').append(datas);}});},pagination:function(event){event.preventDefault();event.stopPropagation();var element=event.currentTarget;var url=$(element).attr('href');var urlTab=url.split('/');var type=this.getUsersListType(urlTab);if(url!=='#'){$.ajax({url:url,type:'GET',success:function(datas){if(type==='with'){$('#users-with-rights-tab').empty();$('#users-with-rights-tab').append(datas);}else if(type==='without'){$('#users-without-rights-tab').empty();$('#users-without-rights-tab').append(datas);}else{$('#all-workspaces-panel').empty();$('#all-workspaces-panel').append(datas);}}});}},reorder:function(event){event.preventDefault();event.stopPropagation();var element=event.currentTarget;var url=$(element).attr('href');var urlTab=url.split('/');var type=this.getUsersListType(urlTab);if(url!=='#'){$.ajax({url:url,type:'GET',success:function(datas){if(type==='with'){$('#users-with-rights-tab').empty();$('#users-with-rights-tab').append(datas);}else if(type==='without'){$('#users-without-rights-tab').empty();$('#users-without-rights-tab').append(datas);}}});}},getUsersListType:function(tab){var type;for(var i=0;i<tab.length;i++){if(tab[i]==='users'){if(typeof(tab[i+1])!=='undefined'){type=tab[i+1];}
break;}}
return type;},addUserClick:function(event){var rights=$('#rights-list').attr('data-rights');var isDir=$('#rights-list').attr('data-is-dir');var nodeId=$('#rights-list').attr('data-node-id');rights=rights.split(',');var trimmed=[];for(var i=0;i<rights.length;i++){trimmed.push(rights[i].trim());}
var picker=new UserPicker();var settings={'multiple':true,'picker_name':'user_res_picker','return_datas':true};picker.configure(settings,function(users){$.each(users,function(index,val){console.debug(val);var twigParams={'user':val,'isDir':true,'rights':trimmed,'nodeId':nodeId};var el=Twig.render(ResourceRightsRow,twigParams);$('.rights-single-user').append(el);});});picker.open();}});})();
(function(){'use strict';window.Claroline=window.Claroline||{};window.Claroline.ResourceManager=window.Claroline.ResourceManager||{};window.Claroline.ResourceManager.Views=window.Claroline.ResourceManager.Views||{};var views=window.Claroline.ResourceManager.Views;Claroline.ResourceManager.Views.Nodes=Backbone.View.extend({className:'nodes',tagName:'ul',attributes:{'id':'sortable'},events:{'click .node .clickable-node':'openNode','click .results table a.result-path':'openNode','click .node input[type=checkbox]':'checkNode','click .results table input[type=checkbox]':'checkNode'},outerEvents:{'directory-data':'render','created-nodes':'addNodes','deleted-nodes':'removeNodes','renamed-node':'renameNode','edited-node':'editNode','reload-page':'reloadPage','published-change-nodes':'changePublishedNodes'},initialize:function(parameters,dispatcher){this.parameters=parameters;this.dispatcher=dispatcher;this.directoryId='0';this.nodes=[];this.listMode=parameters.displayMode;this.zoomValue=this.parameters.zoom;this.dispatcher.on('change-zoom',this.zoom,this);_.each(this.outerEvents,function(method,event){this.dispatcher.on(event+'-'+this.parameters.viewName,this[method],this);},this);this.dispatcher.on('list-mode-'+parameters.viewName,this.setListMode,this)},addNodes:function(event){_.each(event,function(node){var isWhiteListed=this.parameters.resourceTypes[node.type]!==undefined;if(isWhiteListed||node.type==='directory'){this.nodes[node.id]=node;this.renderNode(node);}},this);},renameNode:function(event){var displayableName=Claroline.Utilities.formatText(event.name,20,2);this.$('#'+event.id+' .node-name').html(displayableName+' ').append($(document.createElement('i')).addClass('fa fa-caret-down'));this.$('#'+event.id+' .dropdown[rel=tooltip]').attr('title',event.name);},publishNode:function(event){var nodeId=event.id;var published=event.published;if(published){$('#node-element-'+nodeId).removeClass('unpublished');}else{$('#node-element-'+nodeId).addClass('unpublished');}},changePublishedNodes:function(event){event.ids.forEach(function(nodeId){if(event.published){$('#node-element-'+nodeId).removeClass('unpublished');}else{$('#node-element-'+nodeId).addClass('unpublished');}})},editNode:function(event){this.renameNode(event);this.publishNode(event);this.$('#node-element-'+event.id).attr('style','background-image:url("'+this.parameters.webPath+'/'+event.large_icon+'");');},removeNodes:function(event){var ids=event.ids||[event.nodeId];for(var i=0;i<ids.length;++i){this.$('#'+ids[i]).remove();delete this.nodes[ids[i]];}},zoom:function(event){this.zoomValue=event.value;_.each(this.$('.node-thumbnail'),function(node){node.className=node.className.replace(/\bzoom\d+/g,event.value);});},openNode:function(event){event.preventDefault();var type=event.currentTarget.getAttribute('data-type');var eventName='open-'+(type==='directory'?'directory':'node');if(!this.parameters.isPickerMode||type==='directory'){this.nodes=[];this.dispatcher.trigger(eventName,{nodeId:event.currentTarget.getAttribute('data-id'),resourceType:type,view:this.parameters.viewName,fromPicker:this.parameters.isPickerMode});}},checkNode:function(event){if(this.parameters.isPickerMode&&!this.parameters.isPickerMultiSelectAllowed&&event.currentTarget.checked){_.each(this.$('input[type=checkbox]'),function(checkbox){if(checkbox!==event.currentTarget){checkbox.checked=false;}});}
this.dispatcher.trigger('node-check-status-'+this.parameters.viewName,{node:{id:event.currentTarget.getAttribute('value'),name:event.currentTarget.getAttribute('data-node-name'),type:event.currentTarget.getAttribute('data-type'),mimeType:event.currentTarget.getAttribute('data-mime-type'),path:event.currentTarget.getAttribute('data-path'),mask:event.currentTarget.getAttribute('data-mask')},isChecked:event.currentTarget.checked,isPickerMode:this.parameters.isPickerMode});},orderNodes:function(event,ui){var ids=this.$el.sortable('toArray');var movedNodeId=ui.item.attr('id');var index=ids.indexOf(movedNodeId)+1;this.dispatcher.trigger('order-nodes',{'nodeId':movedNodeId,'index':index});},prepareResults:function(nodes){var displayableNodes=_.reject(nodes,function(node){return this.parameters.resourceTypes[node.type]===undefined;},this);return _.map(displayableNodes,function(node){node.pathParts=node.path.split('`');node.pathParts.pop();node.pathParts.pop();node.pathParts=_.map(node.pathParts,function(part){var matches=part.match(/(.+)\-([0-9]+)$/);return{name:matches[1],id:matches[2]}});return node;});},render:function(event){this.directoryId=event.id;if(!event.isSearchMode){this.$el.empty();this.addNodes(event.nodes);this.$el.sortable({update:_.bind(this.orderNodes,this)});(!event.canChangePosition||this.parameters.isPickerMode)?this.$el.sortable('disable'):this.$el.sortable({helper:'clone'});}else{this.$el.html(Twig.render(ResourceManagerResults,{'nodes':this.prepareResults(event.nodes),'resourceTypes':this.parameters.resourceTypes}));}},setListMode:function(event){this.listMode=event.mode;this.$el.empty();var orderedNodesWithoutIndex=[];var orderedNodesWithIndex=[];var j=0;for(var i in this.nodes){if(this.nodes[i].index_dir===null){orderedNodesWithoutIndex[j]=this.nodes[i];j++;}else{orderedNodesWithIndex[this.nodes[i].index_dir]=this.nodes[i];}}
var orderedNodes=orderedNodesWithoutIndex.concat(orderedNodesWithIndex);orderedNodes.forEach(function(node){this.renderNode(node);}.bind(this));},renderNode:function(node){if(this.parameters.restrictForOwner==1&&node.creator_id!=this.parameters.currentUserId&&node.type!=='directory'){return;}
var view=(this.listMode==='list')?new views.ListViewElement(this.parameters,this.dispatcher,this.zoomValue):new views.Thumbnail(this.parameters,this.dispatcher,this.zoomValue);view.render(node,true&&this.directoryId!=='0');this.$el.append(view.$el);},reloadPage:function(){window.location.reload();}});})();
(function(){'use strict';window.Claroline=window.Claroline||{};window.Claroline.ResourceManager=window.Claroline.ResourceManager||{};window.Claroline.ResourceManager.Views=window.Claroline.ResourceManager.Views||{};Claroline.ResourceManager.Views.Thumbnail=Backbone.View.extend({className:'node-thumbnail node ui-state-default',tagName:'li',events:{'click a.node-menu-action':'menuAction'},initialize:function(parameters,dispatcher,zoomValue){this.parameters=parameters;this.dispatcher=dispatcher;this.zoomValue=zoomValue;},menuAction:function(event){event.preventDefault();var action=event.currentTarget.getAttribute('data-action');var nodeId=event.currentTarget.getAttribute('data-id');var isCustom=event.currentTarget.getAttribute('data-is-custom')==='yes';var eventName=isCustom?'custom-action':action;var isForm=event.currentTarget.getAttribute('data-action-type')==='display-form';var name=event.currentTarget.getAttribute('data-node-name');eventName=isCustom&&isForm?'custom-action-form':eventName
if(action==='delete'){var node=[];node[3]=name;var body=Twig.render(ResourceDeleteConfirmMessage,{'nodes':[node]});this.dispatcher.trigger('confirm',{header:Translator.trans('delete',{},'platform'),body:body,callback:_.bind(function(){this.dispatcher.trigger('delete',{ids:[nodeId],view:this.parameters.viewName});},this)});}else{this.dispatcher.trigger(eventName,{action:action,nodeId:nodeId,view:this.parameters.viewName,isCustomAction:isCustom});}},render:function(node,isSelectionAllowed){this.el.id=node.id;this.$el.addClass(this.zoomValue);node.displayableName=Claroline.Utilities.formatText(node.name,20,2);isSelectionAllowed=(node.type==='directory'&&!this.parameters.isDirectorySelectionAllowed)?false:true;var actions=this.parameters.resourceTypes.hasOwnProperty(node.type)?this.parameters.resourceTypes[node.type].actions:[];this.el.innerHTML=Twig.render(ResourceManagerThumbnail,{'node':node,'isSelectionAllowed':isSelectionAllowed,'hasMenu':true,'actions':actions,'webRoot':this.parameters.webPath,'viewName':this.parameters.viewName});}});})();
(function(){'use strict';window.Claroline=window.Claroline||{};window.Claroline.ResourceManager=window.Claroline.ResourceManager||{};window.Claroline.ResourceManager.Views=window.Claroline.ResourceManager.Views||{};Claroline.ResourceManager.Views.ListViewElement=Backbone.View.extend({className:'resource-li list-group-item node',tagName:'li',events:{'click a.node-menu-action':'menuAction'},initialize:function(parameters,dispatcher,zoomValue){this.parameters=parameters;this.dispatcher=dispatcher;this.zoomValue=zoomValue;},menuAction:function(event){event.preventDefault();var action=event.currentTarget.getAttribute('data-action');var nodeId=event.currentTarget.getAttribute('data-id');var isCustom=event.currentTarget.getAttribute('data-is-custom')==='yes';var eventName=isCustom?'custom-action':action;var isForm=event.currentTarget.getAttribute('data-action-type')==='display-form';var name=event.currentTarget.getAttribute('data-node-name');eventName=isCustom&&isForm?'custom-action-form':eventName
if(action==='delete'){var node=[];node[3]=name;var body=Twig.render(ResourceDeleteConfirmMessage,{'nodes':[node]});this.dispatcher.trigger('confirm',{header:Translator.trans('delete',{},'platform'),body:body,callback:_.bind(function(){this.dispatcher.trigger('delete',{ids:[nodeId],view:this.parameters.viewName});},this)});}else{this.dispatcher.trigger(eventName,{action:action,nodeId:nodeId,view:this.parameters.viewName,isCustomAction:isCustom});}},render:function(node,isSelectionAllowed){this.el.id=node.id;this.$el.addClass(this.zoomValue);node.displayableName=Claroline.Utilities.formatText(node.name,20,2);isSelectionAllowed=(node.type==='directory'&&!this.parameters.isDirectorySelectionAllowed)?false:true;var actions=this.parameters.resourceTypes.hasOwnProperty(node.type)?this.parameters.resourceTypes[node.type].actions:[];this.el.innerHTML=Twig.render(ResourceManagerListElement,{'node':node,'isSelectionAllowed':isSelectionAllowed,'hasMenu':true,'actions':actions,'webRoot':this.parameters.webPath,'viewName':this.parameters.viewName});}});})();
(function(){'use strict';window.Claroline=window.Claroline||{};window.Claroline.ResourceManager=window.Claroline.ResourceManager||{};window.Claroline.ResourceManager.Views=window.Claroline.ResourceManager.Views||{};var views=Claroline.ResourceManager.Views;views.Resources=Backbone.View.extend({tagName:"div",className:"tab-pane active",outerEvents:{'directory-data':'render'},initialize:function(parameters,dispatcher){this.parameters=parameters;this.dispatcher=dispatcher;this.tabName='resources';this.wrapper=null;this.isAppended=false;this.buildElement();_.each(this.outerEvents,function(method,event){this.dispatcher.on(event+'-'+this.parameters.viewName,this[method],this);},this);},buildElement:function(){this.wrapper=this.$el;this.el.id=this.tabName+'-tab-pane';this.$el.attr("role","tabpanel");this.subViews={breadcrumbs:new views.Breadcrumbs(this.parameters,this.dispatcher),actions:new views.Actions(this.parameters,this.dispatcher),nodes:new views.Nodes(this.parameters,this.dispatcher)};},render:function(){if(!this.isAppended){if(!this.parameters.breadcrumbElement){this.wrapper.append(this.subViews.breadcrumbs.el);}
this.wrapper.append(this.subViews.actions.el);this.wrapper.append(this.subViews.nodes.el);this.isAppended=true;}}});})();
(function(){'use strict';window.Claroline=window.Claroline||{};window.Claroline.ResourceManager=window.Claroline.ResourceManager||{};window.Claroline.ResourceManager.Views=window.Claroline.ResourceManager.Views||{};var views=Claroline.ResourceManager.Views;views.Master=Backbone.View.extend({outerEvents:{'directory-data':'render','open-picker':'openAsPicker','close-picker':'closeAsPicker'},initialize:function(parameters,dispatcher){this.parameters=parameters;this.dispatcher=dispatcher;this.wrapper=null;this.isAppended=false;this.pickerDirectoryId=null;this.buildElement();_.each(this.outerEvents,function(method,event){this.dispatcher.on(event+'-'+this.parameters.viewName,this[method],this);},this);this.dispatcher.on('save-picker-directory',function(event){this.pickerDirectoryId=event.directoryId;},this);this.dispatcher.on('open-directory',function(event){this.parameters.currentDirectoryId=event.nodeId;},this);},buildElement:function(){this.el.className='main resource-manager tabpanel';this.wrapper=this.$el;this.subViews={tabpanes:new views.Tabpanes(this.parameters,this.dispatcher)};if(this.parameters.isPickerMode){this.el.className='picker resource-manager';this.el.id='picker-'+this.parameters.viewName;this.$el.html(Twig.render(ModalWindow,{'modalId':'picker-'+this.parameters.viewName,'header':Translator.trans('resource_picker',{},'platform'),'body':'','style':'z-index: 2000;'}));this.wrapper=this.$('.modal-body');}else{this.subViews.form=new views.Form(this.dispatcher);this.subViews.rights=new views.Rights(this.dispatcher);this.subViews.confirm=new views.Confirm(this.dispatcher);}
if(this.parameters.isTinyMce){this.subViews.tabs=new views.Tabs(this.parameters,this.dispatcher);}},openAsPicker:function(){this.dispatcher.trigger('open-directory',{nodeId:this.pickerDirectoryId||this.parameters.directoryId,view:this.parameters.viewName,fromPicker:true});},closeAsPicker:function(){if(this.parameters.isPickerMode&&this.isAppended){this.$('.modal').modal('hide');}},render:function(){if(!this.isAppended){this.parameters.parentElement.append(this.$el);if(this.parameters.isTinyMce){this.wrapper.append(this.subViews.tabs.el);}
this.wrapper.append(this.subViews.tabpanes.el);if(!this.parameters.isPickerMode){this.wrapper.append(this.subViews.form.el);this.wrapper.append(this.subViews.rights.el);this.wrapper.append(this.subViews.confirm.el);}
this.isAppended=true;}
if(this.parameters.isPickerMode){this.$('.modal').modal('show');}}});})();
(function(){'use strict';window.Claroline=window.Claroline||{};window.Claroline.ResourceManager=window.Claroline.ResourceManager||{};window.Claroline.ResourceManager.Views=window.Claroline.ResourceManager.Views||{};var views=Claroline.ResourceManager.Views;views.Tabs=Backbone.View.extend({tagName:"ul",className:"nav nav-tabs",outerEvents:{'directory-data':'render'},events:{"shown.bs.tab a.tab-btn":"tabChanged"},initialize:function(parameters,dispatcher){this.parameters=parameters;this.dispatcher=dispatcher;this.isAppended=false;this.tabs=['resources','widgets'];this.buildElement();_.each(this.outerEvents,function(method,event){this.dispatcher.on(event+'-'+this.parameters.viewName,this[method],this);},this);},buildElement:function(){this.$el.attr("role","tablist");},tabChanged:function(event){this.dispatcher.trigger($(event.target).attr("aria-controls")+"-visible");},render:function(){if(!this.isAppended){this.$el.html(Twig.render(ResourceManagerTabs,{tabs:this.tabs}));this.isAppended=true;}}});})();
(function(){'use strict';window.Claroline=window.Claroline||{};window.Claroline.ResourceManager=window.Claroline.ResourceManager||{};window.Claroline.ResourceManager.Views=window.Claroline.ResourceManager.Views||{};var views=Claroline.ResourceManager.Views;views.Widgets=Backbone.View.extend({tagName:"div",className:"tab-pane widget-tree",initialize:function(parameters,dispatcher){this.parameters=parameters;this.dispatcher=dispatcher;this.tabName='widgets';this.wrapper=null;this.isAppended=false;this.buildElement();this.dispatcher.on('widgets-tab-pane-visible',this.getWorkspaces,this);this.dispatcher.on('workspace-list-returned',this.render,this)},buildElement:function(){this.wrapper=this.$el;this.el.id=this.tabName+'-tab-pane';this.$el.attr("role","tabpanel");},getWorkspaces:function(event){if(!this.isAppended){this.dispatcher.trigger('get-workspace-list');}},render:function(data){if(!this.isAppended){this.subViews={workspaces:new views.Treelist(this.parameters,this.dispatcher,data)};this.wrapper.append(this.subViews.workspaces.el);this.isAppended=true;}}});})();
(function(){'use strict';window.Claroline=window.Claroline||{};window.Claroline.ResourceManager=window.Claroline.ResourceManager||{};window.Claroline.ResourceManager.Views=window.Claroline.ResourceManager.Views||{};var views=Claroline.ResourceManager.Views;views.Treelist=Backbone.View.extend({tagName:"ul",initialize:function(parameters,dispatcher,data){this.parameters=parameters;this.dispatcher=dispatcher;this.items=data.items;this.itemParameters=_.omit(data,'items');this.wrapper=null;this.buildElement();},buildElement:function(){this.wrapper=this.$el;this.subViews=[];for(var i=0;i<this.items.length;i++){var data={};_.extend(data,this.items[i],this.itemParameters);this.subViews.push(new views.Treenode(this.parameters,this.dispatcher,data));}
if(this.items.length==0){this.subViews.push(new views.Treenode(this.parameters,this.dispatcher,null));}
this.render();},render:function(){for(var i=0;i<this.subViews.length;i++){this.wrapper.append(this.subViews[i].el);}}});})();
(function(){'use strict';window.Claroline=window.Claroline||{};window.Claroline.ResourceManager=window.Claroline.ResourceManager||{};window.Claroline.ResourceManager.Views=window.Claroline.ResourceManager.Views||{};var views=Claroline.ResourceManager.Views;views.Treenode=Backbone.View.extend({tagName:"li",events:{"click":"nodeClicked","click a.add-content":"addContent"},initialize:function(parameters,dispatcher,data){this.iconClasses={"workspace":"fa-book","tab":"fa-list-alt","widget":"fa-cog"};this.parameters=parameters;this.dispatcher=dispatcher;this.loaded=false;this.isEmpty=data==null;this.isLeaf=this.isEmpty||false;this.wrapper=null;this.node=data;this.buildElement();if(!this.isEmpty&&!this.isLeaf){var parents=_.values(data.parents);parents.push(data.id);this.dispatcher.on(this.node.acceptsType+'-list-returned-'+_.values(parents).join("-"),this.nodesReturned,this);}},buildElement:function(){this.wrapper=this.$el;if(!this.isEmpty){this.isLeaf=_.isNull(this.node.acceptsType);this.node.iconClass=this.iconClasses[this.node.type];var parentClass="";if(this.node.acceptsType){parentClass="widget-tree-parent-node"}
this.el.className='widget-tree-node '+this.node.type+'-node '+parentClass;this.el.id=this.node.type+'-node-'+this.node.id;}
this.render();},nodeClicked:function(event){if(!this.loaded&&!this.isLeaf){var eventData=this.node.parents;eventData[this.node.type]=this.node.id;this.dispatcher.trigger('get-'+this.node.acceptsType+'-list',eventData);}
else if(this.loaded&&!this.isLeaf){var children=this.$el.find('>ul');if(children.is(":visible")){children.hide('fast');}else{children.show('fast');}}
event.stopPropagation();},addContent:function(event){if(this.isLeaf){this.parameters.pickerCallback([this.node],null,true);this.dispatcher.trigger('close-picker-'+this.parameters.viewName);}
event.stopPropagation();},nodesReturned:function(data){this.subViews={treelist:new views.Treelist(this.parameters,this.dispatcher,data)};this.wrapper.append(this.subViews.treelist.el);this.loaded=true;},render:function(){var twigParams={isEmpty:this.isEmpty};if(!this.isEmpty){twigParams={isEmpty:this.isEmpty,name:this.node.name,iconClass:this.node.iconClass,isLeaf:this.isLeaf};}
this.$el.html(Twig.render(ResourceManagerTreeNode,twigParams));}});})();
(function(){'use strict';window.Claroline=window.Claroline||{};window.Claroline.ResourceManager=window.Claroline.ResourceManager||{};window.Claroline.ResourceManager.Views=window.Claroline.ResourceManager.Views||{};var views=Claroline.ResourceManager.Views;views.Tabpanes=Backbone.View.extend({tagName:"div",className:"tab-content",outerEvents:{'directory-data':'render'},initialize:function(parameters,dispatcher){this.parameters=parameters;this.dispatcher=dispatcher;this.wrapper=null;this.isAppended=false;this.buildElement();_.each(this.outerEvents,function(method,event){this.dispatcher.on(event+'-'+this.parameters.viewName,this[method],this);},this);},buildElement:function(){this.wrapper=this.$el;this.tabPanes={resources:new views.Resources(this.parameters,this.dispatcher),widgets:new views.Widgets(this.parameters,this.dispatcher)};},render:function(){if(!this.isAppended){this.wrapper.append(this.tabPanes.resources.el);if(this.parameters.isTinyMce){this.wrapper.append(this.tabPanes.widgets.el);}
this.isAppended=true;}}});})();
(function(){'use strict';window.Claroline=window.Claroline||{};window.Claroline.ResourceManager=window.Claroline.ResourceManager||{};Claroline.ResourceManager.Router=Backbone.Router.extend({initialize:function(dispatcher,defaultDirectoryId){this.dispatcher=dispatcher;this.defaultDirectoryId=defaultDirectoryId;this.dispatcher.on('open-directory',this.recordRoute,this);this.dispatcher.on('filter',this.recordRoute,this);this.route(/^$/,'default',this.openDefault,this);this.route(/^resources\/(\d+)(\?.*)?$/,'handle',this.handleRequest,this);},recordRoute:function(event){if(event.view==='main'&&!event.fromRouter){var route='resources/'+event.nodeId;if(event.parameters){route+='?'+$.param(event.parameters);}
this.navigate(route);}},openDefault:function(){this.dispatchMainEvent('open-directory',this.defaultDirectoryId);},handleRequest:function(directoryId,queryString){if(!queryString){this.dispatchMainEvent('open-directory',directoryId);}else{var parameters=decodeURIComponent(queryString.substr(1)).split('&');var searchParameters={};var knownParameters=['name','dateFrom','dateTo','types[]'];_.each(parameters,function(parameter){parameter=parameter.split('=');if(knownParameters.indexOf(parameter[0])!==-1){searchParameters[parameter[0].replace('[]','')]=parameter[1];}});this.dispatchMainEvent('filter',directoryId,searchParameters);}},dispatchMainEvent:function(eventName,directoryId,parameters){var event={nodeId:directoryId,view:'main',fromRouter:true};if(parameters){event.parameters=parameters;}
this.dispatcher.trigger(eventName,event);}});})();
(function(){'use strict';window.Claroline=window.Claroline||{};window.Claroline.ResourceManager=window.Claroline.ResourceManager||{};var server=Claroline.ResourceManager.Server=function(dispatcher){this.dispatcher=dispatcher;this.preFetchedDirectory=null;this.outerEvents={'open-directory':'openDirectory','submit-form':'submit','download':'download','open-tracking':'openTracking','delete':'delete','open-node':'open','copy-nodes':'copy','move-nodes':'move','order-nodes':'order','list-mode':'listMode','filter':'filter','change-zoom':'zoom','custom-action':'customAction','create-shortcuts':'createShortcuts','get-url':'get','get-workspace-list':'getWorkspaces','get-tab-list':'getVisibleTabsForWorkspace','get-widget-list':'getVisibleWidgetsForTabAndWorkspace','export':'export','publish':'publish','unpublish':'unpublish'};_.each(this.outerEvents,function(method,event){this.dispatcher.on(event,this[method],this);},this);$.ajaxSetup({headers:{'X_Requested_With':'XMLHttpRequest'},context:this});};server.prototype.setPreFetchedDirectory=function(directory){this.preFetchedDirectory=directory;};server.prototype.openDirectory=function(event){var eventName='directory-data-'+event.view;if(this.preFetchedDirectory&&this.preFetchedDirectory.id==event.nodeId){this.preFetchedDirectory.isSearchMode=false;this.dispatcher.trigger(eventName,this.preFetchedDirectory);}else{var url=Routing.generate('claro_resource_directory',{nodeId:event.nodeId});if(event.fromPicker){this.dispatcher.trigger('save-picker-directory',{directoryId:event.nodeId});url+='?keep-id';}
$.ajax({url:url,success:function(data){data.isSearchMode=false;this.dispatcher.trigger(eventName,data);}});}
this.preFetchedDirectory=null;};server.prototype.getWorkspaces=function(){var url=Routing.generate('claro_workspace_by_user_picker');$.ajax({url:url,success:function(data){data.type="workspace";data.acceptsType="tab";data.parents={};this.dispatcher.trigger('workspace-list-returned',data);}});};server.prototype.getVisibleTabsForWorkspace=function(event){var url=Routing.generate('claro_list_visible_workspace_home_tabs_picker',{'workspaceId':event.workspace});$.ajax({url:url,success:function(data){data.type="tab";data.acceptsType="widget";data.parents={"workspace":event.workspace};this.dispatcher.trigger('tab-list-returned-'+event.workspace,data);}});};server.prototype.getVisibleWidgetsForTabAndWorkspace=function(event){var url=Routing.generate('claro_workspace_home_tab_widget_list_picker',{'workspaceId':event.workspace,'homeTabId':event.tab});$.ajax({url:url,success:function(data){data.type="widget";data.acceptsType=null;data.parents={'workspace':event.workspace,"tab":event.tab};this.dispatcher.trigger('widget-list-returned-'+event.workspace+'-'+event.tab,data);}});};server.prototype.submit=function(event){$.ajax({url:event.formAction,data:event.formData,type:'POST',processData:false,contentType:false,success:function(data,textStatus,jqXHR){if(jqXHR.getResponseHeader('Content-Type')==='application/json'){this.dispatcher.trigger(event.eventOnSuccess,data);this.dispatcher.trigger('submit-success');}else{event.errorForm=data;this.dispatcher.trigger('error-form',event);}}});};server.prototype.delete=function(event){$.ajax({url:Routing.generate('claro_resource_delete',{}),data:{ids:event.ids||[event.nodeId]},success:function(){this.dispatcher.trigger('deleted-nodes-'+event.view,{ids:event.ids||[event.nodeId]});this.dispatcher.trigger('close-confirm');}});};server.prototype.copy=function(event){$.ajax({url:Routing.generate('claro_resource_copy',{parent:event.directoryId}),data:{ids:event.ids},success:function(data,textStatus,jqXHR){if(jqXHR.getResponseHeader('Content-Type')==='application/json'){this.dispatcher.trigger('created-nodes-'+event.view,data);}}});};server.prototype.move=function(event){$.ajax({url:Routing.generate('claro_resource_move',{newParent:event.directoryId}),data:{ids:event.ids},success:function(data){this.dispatcher.trigger('created-nodes-'+event.view,data);}});};server.prototype.filter=function(event){$.ajax({url:Routing.generate('claro_resource_filter',{nodeId:event.nodeId}),data:event.parameters,success:function(data){data.isSearchMode=true;this.dispatcher.trigger('directory-data-'+event.view,data);}});};server.prototype.order=function(event){$.ajax({url:Routing.generate('claro_resource_insert_at',{'node':event.nodeId,'index':event.index})});};server.prototype.zoom=function(event){$.ajax({url:Routing.generate('claro_resource_change_zoom',{'zoom':event.value})});};server.prototype.fetchManagerParameters=function(callback){$.ajax({url:Routing.generate('claro_resource_manager_parameters'),success:callback});};server.prototype.createShortcuts=function(event){$.ajax({url:Routing.generate('claro_resource_create_shortcut',{parent:event.directoryId}),data:{ids:event.ids},success:function(data){this.dispatcher.trigger('created-nodes-'+event.view,data);}});};server.prototype.get=function(event){$.ajax({url:event.url,success:function(data){this.dispatcher.trigger(event.onSuccess,data);}});};server.prototype.open=function(event){window.location=Routing.generate('claro_resource_open',{resourceType:event.resourceType,node:event.nodeId});};server.prototype.download=function(event){var route=Routing.generate('claro_resource_download',{});var ids=event.ids||[event.nodeId];window.location=route+'?'+$.param({ids:ids});};server.prototype.openTracking=function(event){window.location=Routing.generate('claro_resource_logs',{node:event.nodeId});};server.prototype.customAction=function(event){window.location=Routing.generate('claro_resource_action',{action:event.action,node:event.nodeId});};server.prototype.listMode=function(event){this.dispatcher.trigger('list-mode-'+event.viewName,{mode:event.mode});};server.prototype.export=function(event){var route=Routing.generate('claro_resource_export',{});var ids=event.ids||[event.nodeId];window.location=route+'?'+$.param({ids:ids});};server.prototype.publish=function(event){$.ajax({url:Routing.generate('claro_resource_publish',{}),data:{ids:event.ids||[event.nodeId]},success:function(){this.dispatcher.trigger('published-change-nodes-'+event.view,{ids:event.ids||[event.nodeId],published:true});this.dispatcher.trigger('close-confirm');}});};server.prototype.unpublish=function(event){$.ajax({url:Routing.generate('claro_resource_unpublish',{}),data:{ids:event.ids||[event.nodeId]},success:function(){this.dispatcher.trigger('published-change-nodes-'+event.view,{ids:event.ids||[event.nodeId],published:false});this.dispatcher.trigger('close-confirm');}});};})();
(function(){'use strict';window.Claroline=window.Claroline||{};window.Claroline.ResourceManager=window.Claroline.ResourceManager||{};var manager=window.Claroline.ResourceManager;var dispatcher=null;var server=null;var router=null;var views={};var isInitialized=false;var areLogsActivated=false;var hasFetchedParameters=false;var fetchedParameters={pickerDirectoryId:null,preFetchedDirectory:null,resourceTypes:null,webPath:null,language:null,zoom:null};manager.createFullManager=function(parameters){initialize();parameters=parameters||{};var mainParameters=buildParameters('main',parameters,false,true);var pickerParameters=buildParameters('defaultPicker',parameters,true,true);var sParameters=parameters||{};sParameters.isDirectorySelectionAllowed=false;var shortcutParameters=buildParameters('shortcutPicker',sParameters,true,true);views['main']=new manager.Views.Master(mainParameters,dispatcher);views['defaultPicker']=new manager.Views.Master(pickerParameters,dispatcher);views['shortcutPicker']=new manager.Views.Master(shortcutParameters,dispatcher);router=new manager.Router(dispatcher,mainParameters.directoryId);Backbone.history.start();};manager.createPicker=function(name,parameters,open){if(manager.hasPicker(name)){throw new Error('Picker name "'+name+'" is already in use');}
if(['main','defaultPicker','shortcutPicker'].indexOf(name)!==-1){throw new Error('Invalid picker name "'+name+'" (reserved for internal use)');}
initialize();parameters=parameters||{};fetchMissingParameters(parameters,function(){var pickerParameters=buildParameters(name,parameters,true);views[name]=new manager.Views.Master(pickerParameters,dispatcher);open&&dispatcher.trigger('open-picker-'+name);});};manager.hasPicker=function(name){return views.hasOwnProperty(name)&&views[name].parameters.isPickerMode;};manager.get=function(name){return views[name];};manager.picker=function(name,action){if(!manager.hasPicker(name)){throw new Error('Unknown picker "'+name+'"');}
action=action==='close'?'close':'open';dispatcher.trigger(action+'-picker-'+name);};manager.destroy=function(name){delete views[name];};manager.logEvents=function(){if(!areLogsActivated){initialize();var originalTrigger=dispatcher.trigger;dispatcher.trigger=function(event,args){var listenerCount=_.keys(dispatcher._events).indexOf(event)!==-1?_.keys(dispatcher._events[event]).length:0;console.debug('Triggering "'+event+'" with',args,'['+listenerCount+' listener(s) attached]');originalTrigger.apply(dispatcher,[event,args]);};areLogsActivated=true;}};function initialize(){if(!isInitialized){dispatcher=_.extend({},Backbone.Events);server=new manager.Server(dispatcher);isInitialized=true;}}
function buildParameters(viewName,parameters,isPicker,isDefault){var allowDirectorySelection=true;if(parameters.isDirectorySelectionAllowed!==undefined)
allowDirectorySelection=parameters.isDirectorySelectionAllowed;var mergedParameters={viewName:viewName,isPickerMode:isPicker,restrictForOwner:parameters.restrictForOwner||false,isWorkspace:parameters.isWorkspace||false,directoryId:resolveDirectoryId(parameters,isPicker,isDefault),preFetchedDirectory:parameters.preFetchedDirectory||fetchedParameters.preFetchedDirectory||null,parentElement:parameters.parentElement||$('body'),breadcrumbElement:isPicker?null:parameters.breadcrumbElement||null,resourceTypes:resolveResourceTypes(parameters),language:parameters.language||fetchedParameters.language||'en',webPath:parameters.webPath||fetchedParameters.webPath||'',zoom:parameters.zoom||fetchedParameters.zoom||'zoom100',pickerCallback:parameters.callback||function(){},isPickerMultiSelectAllowed:isDefault||parameters.isPickerMultiSelectAllowed||false,isDirectorySelectionAllowed:allowDirectorySelection,currentDirectoryId:null,isTinyMce:parameters.isTinyMce||false,currentUsername:fetchedParameters.currentUsername,currentUserId:fetchedParameters.currentUserId,displayMode:parameters.displayMode||'default',workspaceId:parameters.workspaceId||null};if(mergedParameters.preFetchedDirectory){server.setPreFetchedDirectory(mergedParameters.preFetchedDirectory);}
return mergedParameters;}
function resolveDirectoryId(parameters,isPicker,isDefault){if(isPicker){if(isDefault){return parameters.pickerDirectoryId||'0';}
return parameters.directoryId||fetchedParameters.directoryId||'0';}
return parameters.directoryId||'0';}
function resolveResourceTypes(parameters){var types=parameters.resourceTypes||fetchedParameters.resourceTypes||{};if(parameters.typeWhiteList){types=_.pick(types,parameters.typeWhiteList);}else if(parameters.typeBlackList){types=_.omit(types,parameters.typeBlackList);}
return types;}
function fetchMissingParameters(givenParameters,callback){var expectedParameters=['resourceTypes','webPath','language','zoom','directoryId'];var hasMissingParameter=_.some(expectedParameters,function(parameter){return!givenParameters.hasOwnProperty(parameter);});if(!hasMissingParameter||hasFetchedParameters){callback();}else{server.fetchManagerParameters(function(data){fetchedParameters.directoryId=data.pickerDirectoryId;fetchedParameters.preFetchedDirectory=data.preFetchedDirectory;fetchedParameters.resourceTypes=data.resourceTypes;fetchedParameters.language=data.language;fetchedParameters.webPath=data.webPath;fetchedParameters.zoom=data.zoom;fetchedParameters.currentUsername=data.currentUsername;fetchedParameters.currentUserId=data.currentUserId;hasFetchedParameters=true;callback();});}}})();
(function(){'use strict';window.Claroline.Home={};var home=window.Claroline.Home;var modal=window.Claroline.Modal;var routing=window.Routing;var translator=window.Translator;home.path=$('#homePath').html();home.locale=$('#homeLocale').html();home.asset=$('#homeAsset').html();if(!home.path){home.path='./';}
if(!home.locale){home.locale='en';}
if(!home.asset){home.asset='./';}
home.findUrls=function(text)
{var source=(text||'').toString();var urlArray=[];var matchArray;var regexToken=/(((ftp|https?):\/\/)[\-\w@:%_\+.~#?,&\/\/=]+)|((mailto:)?[_.\w-]+@([\w][\w\-]+\.)+[a-zA-Z]{2,3})/g;while((matchArray=regexToken.exec(source))!==null){var token=matchArray[0];urlArray.push(token);}
return urlArray;};home.insertContent=function(creatorElement,data,type,father,update)
{update=typeof(update)!=='undefined'?update:null;var contentPath='content/'+data+'/'+type;if(father){contentPath+='/'+father;}
$.ajax(home.path+contentPath).done(function(data){if(father&&!update){$('.creator'+father).after(data);$('.creator'+father).find('.collapse'+father).collapse('hide');}else if(father&&update){$(creatorElement).parents('.creator'+father).first().replaceWith(data);}else if(update){$(creatorElement).replaceWith(data);}else{$(creatorElement).next().prepend(data).hide().fadeIn('slow');}
$('.contents').trigger('ContentModified');});};home.emptyContent=function(creatorElement)
{$('input',creatorElement).val('');$('textarea',creatorElement).val('').data('saved','true');};home.creator=function(element,id,update)
{id=typeof(id)!=='undefined'?id:null;update=typeof(update)!=='undefined'?update:null;var creatorElement=$(element).parents('.creator').get(0);var form=$('form',creatorElement).first().serializeArray();var type=$(creatorElement).data('type');var father=$(creatorElement).data('father');var route='content/create/'+type;if(father){route+='/'+father;}
if(update){route='content/update/'+id;}
if(!home.creatorIsEmpty(form)){$.post(home.path+route,form).done(function(data){if(!isNaN(data)&&data!==''){home.insertContent(creatorElement,data,type,father);home.emptyContent(creatorElement);}else if(data==='true'){home.insertContent(creatorElement,id,type,father,update);}else{modal.error();}}).error(function(){modal.error();});}};home.reloadContent=function(element,id,type){$.ajax(routing.generate('claroline_get_content_by_id_and_type',{'content':id,'type':type})).done(function(data){$(element).replaceWith(data);$('.contents').trigger('ContentModified');}).error(function(){modal.error();});};home.deleteContent=function(element,type)
{var path=typeof(type)==='undefined'||type===false?'delete':'deletetype';var id=element.data('id');if(id){$.ajax(home.path+'content/'+path+'/'+id).done(function(data){if(data==='true'){if(type){element=element.parent();}
element.hide('slow',function(){$(this).remove();$('.contents').trigger('ContentModified');});}else{modal.error();}}).error(function(){modal.error();});}};home.publishType=function(element)
{var id=element.data('id');if(id){$.ajax(routing.generate('claro_content_publish_type',{'type':id})).done(function(data){if(data==='true'){$('.type-publish > span',element).text(translator.trans('unpublish',{},'platform'));$('strong > .text-muted > span',element).text(translator.trans('publish',{},'platform'));$('strong > .text-muted > .text-danger',element).removeClass('text-danger').addClass('text-success');}else{$('.type-publish > span',element).text(translator.trans('to_publish',{},'platform'));$('strong > .text-muted > span',element).text(translator.trans('unpublished',{},'platform'));$('strong > .text-muted > .text-success',element).removeClass('text-success').addClass('text-danger');}}).error(function(){modal.error();});}};home.creatorIsEmpty=function(form)
{if(form instanceof Array){for(var lang in form){if(form.hasOwnProperty(lang)&&form[lang].value!==undefined&&form[lang].value!==''){return false;}}}
return true;};home.changeSize=function(size,id,type,element){if(id&&type&&element){$.post(home.path+'content/update/'+id+'/'+size+'/'+type).done(function(data){if(data==='true'){$(element).removeClass(function(index,css){return(css.match(/\bcontent-\d+/g)||[]).join(' ');});modal.hide();$(element).addClass(size);$(element).trigger('DOMSubtreeModified');$('#sizes').modal('hide');$('.contents').trigger('ContentModified');}else{modal.error();}}).error(function(){modal.error();});}};home.changeRegion=function(name,id){if(name&&id){$.ajax(home.path+'region/'+name+'/'+id).done(function(){location.reload();}).error(function(){modal.error();});}};home.collapse=function(element,id,type)
{$.ajax(routing.generate('claroline_content_collapse',{'content':id,'type':type})).done(function(data){if(data==='true'){home.reloadContent(element,id,type);}else{modal.error();}}).error(function(){modal.error();});};home.generatedContent=function(url,action,error)
{error=typeof(error)!=='undefined'?error:true;$.post(home.path+'content/graph',{'generated_content_url':url}).done(function(data){if(data!=='false'){action(data);}}).error(function(){if(error){modal.error();}});};home.canGenerateContent=function(url,action)
{$.post(home.path+'cangeneratecontent',{'url':url}).success(function(data){if(data.trim()!=='false'){action(data);}});};$('body').on('click','.content-translatable .content-menu .dropdown-menu a',function(){var translatable=$(this).parents('.content-translatable').first();var lang=$(this).text();$('.content-menu button span',translatable).text(lang);$('.lang',translatable).each(function(){if($(this).data('lang')===lang){$(this).removeClass('hide');}else{$(this).addClass('hide');}});});}());
(function(){'use strict';var routing=window.Routing;var modal=window.Claroline.Modal;$('body').on('click','.locale-select',function(){if(!$(this).parents('.modal').get(0)){modal.fromRoute('claroline_locale_select');}else{$.ajax(routing.generate('claroline_locale_change',{'locale':$(this).html().toLowerCase()})).done(function(){var form=document.createElement('form');form.action=document.URL;form.method='post';document.body.appendChild(form);form.submit();});}});}());
(function(){'use strict';window.Claroline.ResourcePicker={};var manager=window.Claroline.ResourceManager;var common=window.Claroline.Common;var modal=window.Claroline.Modal;var translator=window.Translator;var routing=window.Routing;var activePicker=null;var timeoutId=null;var defaultCallback=function(nodes){var nodeId=_.keys(nodes)[0];var name=nodes[_.keys(nodes)][0];var type=nodes[_.keys(nodes)][1];$(activePicker).prev().val(nodeId);$(activePicker).prev().data('name',name);$(activePicker).prev().data('type',type);$(activePicker).prev().trigger('change');$('input',activePicker).val(name);checkView();};window.Claroline.ResourcePicker.initialize=function(id){var pickerName='formResourcePicker';var field=$('#'+id);var element=field.next('.input-group');$('input.form-control',element).on('focus',function(){activePicker=this.parentNode;openPicker(pickerName,customParameters);});var inputGroupButton=$('.input-group-btn',element);$('button.resource-browse',inputGroupButton).on('click',function(){activePicker=this.parentNode.parentNode;openPicker(pickerName,customParameters);});$('button.resource-download',inputGroupButton).on('click',function(){activePicker=this.parentNode.parentNode;modal.fromRoute('claro_upload_modal',null,function(element){element.on('click','.resourcePicker',function(){openPicker(pickerName,customParameters);}).on('click','.filePicker',function(){$('#file_form_file').click();}).on('change','#file_form_file',function(){common.uploadfile(this,element,defaultCallback);});});});var customParameters=processCustomParameters(field.data());var name=field.data('name');if(name){$('input',element).val(name);}
if(field.next().hasClass('help-block')){field.next().appendTo(element);}
field.addClass('resource-picker-done').addClass('hide');checkView(element);};function processCustomParameters(datas){var customParameters=null;var simpleParameterList=['restrictForOwner','isPickerMultiSelectAllowed','isDirectorySelectionAllowed',];var arrayParameterList=['typeBlackList','typeWhiteList'];for(var i=0;i<simpleParameterList.length;i++){var simpleParameterName=simpleParameterList[i];if(undefined!==datas[simpleParameterName]){customParameters=customParameters||{};customParameters[simpleParameterName]=datas[simpleParameterName];}}
for(var i=0;i<arrayParameterList.length;i++){var arrayParameterName=arrayParameterList[i];if(undefined!==datas[arrayParameterName]){customParameters=customParameters||{};customParameters[arrayParameterName]=datas[arrayParameterName].split(',');}}
return customParameters;}
function openPicker(pickerName,customParameters){if(!manager.hasPicker(pickerName)){var parameters={callback:defaultCallback};if(customParameters){_.keys(customParameters).forEach(function(parameter){parameters[parameter]=customParameters[parameter];});}
manager.createPicker(pickerName,parameters,true);}else{manager.picker(pickerName,'open');}};function checkView(targetPicker){activePicker=targetPicker||activePicker;var nodeId=$(activePicker).prev().val();var type=$(activePicker).prev().data('type');if(nodeId&&type){$('.resource-view',activePicker).removeClass('disabled').attr('href',routing.generate('claro_resource_open',{resourceType:type,node:nodeId}));}else{$('.resource-view',activePicker).attr('href','').addClass('disabled');}};}());
(function(){'use strict';window.Claroline=window.Claroline||{};var utilities=window.Claroline.Utilities={};utilities.formatText=function(text,maxLengthPerLine,maxLines){if(text.length<=maxLengthPerLine){return text;}
maxLengthPerLine=maxLengthPerLine||20;maxLines=maxLines||1;var lines=new Array(maxLines),curLine=0,curText=text,blankCuts=0,newText='';while(curText.length>0&&curLine<maxLines){lines[curLine]=curText.substr(0,maxLengthPerLine);if(curLine!==maxLines-1){for(var i=lines[curLine].length;i>0;i--){var c=lines[curLine].charAt(i-1);if(!((c>='a'&&c<='z')||(c>='A'&&c<='Z')||(c>='0'&&c<='9'))){blankCuts++;break;}}
if(i>0){lines[curLine]=lines[curLine].substr(0,i);}
curText=curText.substr(lines[curLine].length,curText.length);}
curLine++;}
if(curText.length>0){if(lines[curLine-1].length>maxLengthPerLine||((text.length+blankCuts)>(maxLengthPerLine*maxLines))){lines[curLine-1]=lines[curLine-1].substr(0,maxLengthPerLine-3);lines[curLine-1]=lines[curLine-1]+'...';}}
for(var j=0;j<lines.length;++j){newText+=j===lines.length-1?lines[j]:lines[j]+'<br/>';}
return newText;};})();
(function(){'use strict';var env=$('#sf-environement').attr('data-env');var stackedRequests=0;var modal=window.Claroline.Modal;var translator=window.Translator;var claroDate=window.Claroline.ClaroDate;var ajaxServerErrorHandler=function(statusCode,responseText){if(env!=='prod'){var w=window.open();$(w.document.body).html(responseText);}else{modal.confirmContainer(translator.trans('error',{},'platform'),responseText);}};var ajaxAuthenticationErrorHandler=function(form){modal.create(form).on('submit','#login-form',function(e){var $this=$(e.currentTarget);var inputs={};e.preventDefault();$.each($this.find('input'),function(i,item){var $item=$(item);inputs[$item.attr('name')]=$item.val();});$.ajax({type:'POST',url:e.currentTarget.action,cache:false,data:inputs,success:function(data){if(data.has_error){$('.form-group',$this).addClass('has-error');}else{window.location.reload();}}});});};$(document).bind('ajaxSend',function(){stackedRequests++;$('.please-wait').show();}).bind('ajaxComplete',function(){stackedRequests--;if(stackedRequests===0){$('.please-wait').hide();}});$(document).ajaxError(function(event,jqXHR){if(jqXHR.status===403&&jqXHR.getResponseHeader('XXX-Claroline')!=='resource-error'){ajaxAuthenticationErrorHandler(jqXHR.responseText);}else if(jqXHR.status===500||jqXHR.status===422||jqXHR.status===403){ajaxServerErrorHandler(jqXHR.status,jqXHR.responseText);}});Twig.setFunction('path',function(route,parameters){return Routing.generate(route,parameters);});Twig.setFilter('trans',function(name,parameters,domain){return translator.trans(name,parameters,domain);});Twig.setFilter('transchoice',function(name,amt,parameters,domain){return translator.transChoice(name,amt,parameters,domain);});Twig.setFunction('getCurrentUrl',function(){return location.pathname;});var shiftWindow=function(){scrollBy(0,-50);};$(document).ready(function(){if(location.hash){setTimeout(function(){shiftWindow();},300);}});$(window).on('hashchange',shiftWindow);})();
var UserPicker=function(){this.pickerName='picker-name';this.pickerTitle=Translator.trans('user_selector',{},'platform');this.multiple='single';this.showAllUsers=0;this.showFilters=1;this.showId=0;this.showPicture=0;this.showUsername=1;this.showMail=0;this.showCode=0;this.showGroups=0;this.showPlatformRoles=0;this.attachName=1;this.returnDatas=0;this.userIds=[];this.forcedUserIds=[];this.selectedUserIds=[];this.forcedGroupIds=[];this.forcedRoleIds=[];this.forcedWorkspaceIds=[];this.shownWorkspaceIds=[];this.parameters={};this.parameters.excludedUserIds=this.userIds;this.parameters.forcedUserIds=this.forcedUserIds;this.parameters.selectedUserIds=this.selectedUserIds;this.parameters.forcedGroupIds=this.forcedGroupIds;this.parameters.forcedRoleIds=this.forcedRoleIds;this.parameters.forcedWorkspaceIds=this.forcedWorkspaceIds;this.parameters.shownWorkspaceRoleIds=this.shownWorkspaceIds;this.callBack=function(results){};};UserPicker.prototype.configure=function(configurationDatas,callBack){if(configurationDatas['picker_name']!==undefined){this.pickerName=configurationDatas['picker_name'];}
if(configurationDatas['picker_title']!==undefined){this.pickerTitle=configurationDatas['picker_title'];}
if(configurationDatas['multiple']!==undefined){this.multiple=configurationDatas['multiple']?'multiple':'single';}
if(configurationDatas['show_all_users']!==undefined){this.showAllUsers=configurationDatas['show_all_users']?1:0;}
if(configurationDatas['show_filters']!==undefined){this.showFilters=configurationDatas['show_filters']?1:0;}
if(configurationDatas['show_id']!==undefined){this.showId=configurationDatas['show_id']?1:0;}
if(configurationDatas['show_picture']!==undefined){this.showPicture=configurationDatas['show_picture']?1:0;}
if(configurationDatas['show_username']!==undefined){this.showUsername=configurationDatas['show_username']?1:0;}
if(configurationDatas['show_mail']!==undefined){this.showMail=configurationDatas['show_mail']?1:0;}
if(configurationDatas['show_code']!==undefined){this.showCode=configurationDatas['show_code']?1:0;}
if(configurationDatas['show_groups']!==undefined){this.showGroups=configurationDatas['show_groups']?1:0;}
if(configurationDatas['show_platform_roles']!==undefined){this.showPlatformRoles=configurationDatas['show_platform_roles']?1:0;}
if(configurationDatas['attach_name']!==undefined){this.attachName=configurationDatas['attach_name']?1:0;}
if(configurationDatas['return_datas']!==undefined){this.returnDatas=configurationDatas['return_datas']?1:0;}
if(configurationDatas['blacklist']!==undefined){this.userIds=configurationDatas['blacklist'];}
if(configurationDatas['whitelist']!==undefined){this.forcedUserIds=configurationDatas['whitelist'];}
if(configurationDatas['selected_users']!==undefined){this.selectedUserIds=configurationDatas['selected_users'];}
if(configurationDatas['forced_groups']!==undefined){this.forcedGroupIds=configurationDatas['forced_groups'];}
if(configurationDatas['forced_roles']!==undefined){this.forcedRoleIds=configurationDatas['forced_roles'];}
if(configurationDatas['forced_workspaces']!==undefined){this.forcedWorkspaceIds=configurationDatas['forced_workspaces'];}
if(configurationDatas['shown_workspaces']!==undefined){this.shownWorkspaceIds=configurationDatas['shown_workspaces'];}
this.parameters={};this.parameters.excludedUserIds=this.userIds;this.parameters.forcedUserIds=this.forcedUserIds;this.parameters.selectedUserIds=this.selectedUserIds;this.parameters.forcedGroupIds=this.forcedGroupIds;this.parameters.forcedRoleIds=this.forcedRoleIds;this.parameters.forcedWorkspaceIds=this.forcedWorkspaceIds;this.parameters.shownWorkspaceIds=this.shownWorkspaceIds;this.callBack=callBack||this.callBack;};UserPicker.prototype.open=function(){var userPicker=this;var modal=window.Claroline.Modal;var route=Routing.generate('claro_user_picker',{'pickerName':userPicker.pickerName,'pickerTitle':userPicker.pickerTitle,'mode':userPicker.multiple,'showAllUsers':userPicker.showAllUsers,'showFilters':userPicker.showFilters,'showId':userPicker.showId,'showPicture':userPicker.showPicture,'showUsername':userPicker.showUsername,'showMail':userPicker.showMail,'showCode':userPicker.showCode,'showGroups':userPicker.showGroups,'showPlatformRoles':userPicker.showPlatformRoles,'attachName':userPicker.attachName});route+='?'+$.param(this.parameters);$.ajax({url:route,type:'GET',success:function(modalContent){var modalElement=modal.create(modalContent,'userpicker',{'z-index':2000});var modalId='#user-picker-modal-'+userPicker.pickerName;var currentSearch=$(modalId+' #user-picker-datas-box').data('search');var currentMax=$(modalId+' #user-picker-datas-box').data('max');var currentOrderedBy=$(modalId+' #user-picker-datas-box').data('ordered-by');var currentOrder=$(modalId+' #user-picker-datas-box').data('order');var selectedUserNamesTxt=$(modalId+' #user-picker-main-datas-box').data('selected-users-names');selectedUserNamesTxt=selectedUserNamesTxt.trim();var selectedUserNames=(selectedUserNamesTxt==='undefined'||selectedUserNamesTxt==='')?[]:selectedUserNamesTxt.split(';;;');var filterType='none';var secondFilterValue='none';var secondFilterName='none';var thirdFilterValue='none';var thirdFilterName='none';var groupFilters=[];var roleFilters=[];var workspaceFilters=[];var groupIds=[];var roleIds=[];var workspaceIds=[];var userIds=[];var selectedUsers=[];function displaySecondFilter()
{if(filterType==='none'){resetFilters(true,true,true);}else{$(modalId+' #box-filter-level-2').show('slow',function(){secondFilterValue='none';thirdFilterValue='none';$(modalId+' #filter-level-2').val('none');$(modalId+' #filter-level-3').val('none');$.ajax({url:Routing.generate('claro_filters_list_for_user_picker',{'filterType':filterType}),type:'GET',success:function(datas){$(modalId+' #filter-level-2').empty();var option='<option value="none" id="'+filterType+'-none">--- '+
Translator.trans('select_a_'+filterType,{},'platform')+' ---</option>';$(modalId+' #filter-level-2').append(option);for(var i=0;i<datas.length;i++){option='<option value="'+
datas[i]['id']+'" id="'+filterType+'-'+
datas[i]['id']+'">'+
datas[i]['name']+'</option>';$(modalId+' #filter-level-2').append(option);}
$(modalId+' #box-filter-level-2').show('slow',function(){$(this).removeClass('hidden');});}});});}}
function displayThirdFilter()
{if(filterType==='workspace'&&secondFilterValue!=='none'){thirdFilterValue='none';$.ajax({url:Routing.generate('claro_workspace_roles_list_for_user_picker',{'workspace':secondFilterValue}),type:'GET',success:function(datas){$(modalId+' #filter-level-3').empty();var option='<option value="none" id="ws-role-none">--- '+
Translator.trans('all_roles',{},'platform')+' ---</option>';$(modalId+' #filter-level-3').append(option);for(var i=0;i<datas.length;i++){option='<option value="'+
datas[i]['id']+'" id="ws-role-'+
datas[i]['id']+'">'+
datas[i]['name']+'</option>';$('#filter-level-3').append(option);}
$(modalId+' #box-filter-level-3').show('slow',function(){$(this).removeClass('hidden');});}});}else{resetFilters(false,false,true);}}
function displayFilterCreateButton()
{if(filterType!=='none'&&secondFilterValue!=='none'){$(modalId+' #box-filter-create-btn').show('slow',function(){$(this).removeClass('hidden');});}else{$(modalId+' #box-filter-create-btn').hide('slow');}}
function resetFilters(first,second,third)
{if(first){$(modalId+' #filter-level-1').val('none');filterType='none';}
if(second){$(modalId+' #box-filter-level-2').hide('slow',function(){$(modalId+' #filter-level-2').val('none');$(modalId+' #filter-level-2').empty();secondFilterValue='none';secondFilterName='none';});}
if(third){$(modalId+' #box-filter-level-3').hide('slow',function(){$(modalId+' #filter-level-3').val('none');$(modalId+' #filter-level-3').empty();thirdFilterValue='none';thirdFilterName='none';});}
displayFilterCreateButton();}
function updateIdsArray(type)
{switch(type){case'group':groupIds=[];for(var key in groupFilters){if(groupFilters[key]!==null){groupIds.push(parseInt(key));}}
userPicker.parameters.groupIds=groupIds;break;case'role':roleIds=[];for(var key in roleFilters){if(roleFilters[key]!==null){roleIds.push(parseInt(key));}}
userPicker.parameters.roleIds=roleIds;break;case'workspace':workspaceIds=[];for(var key in workspaceFilters){if(workspaceFilters[key]!==null){workspaceIds.push(parseInt(key));}}
userPicker.parameters.workspaceIds=workspaceIds;break;case'user':userIds=[];for(var key in selectedUsers){if(selectedUsers[key]!==null){userIds.push({id:parseInt(key),name:selectedUsers[key]});}}
break;default:break}}
function createFilter()
{switch(filterType){case'group':var groupId=parseInt(secondFilterValue);if(groupFilters[groupId]===undefined||groupFilters[groupId]===null){groupFilters[groupId]=secondFilterName;updateIdsArray('group');var filterElement='<li class="filter-element" data-filter-type="group" data-filter-value="'+
groupId+'">'+'<span class="label label-info">'+
secondFilterName+' <i class="fa fa-times-circle delete-filter-btn pointer-hand"></i>'+'</span></li>';$(modalId+' #filters-list-box').append(filterElement);}
break;case'role':var roleId=parseInt(secondFilterValue);if(roleFilters[roleId]===undefined||roleFilters[roleId]===null){roleFilters[roleId]=secondFilterName;updateIdsArray('role');var filterElement='<li class="filter-element" data-filter-type="role" data-filter-value="'+
roleId+'">'+'<span class="label label-success">'+
secondFilterName+' <i class="fa fa-times-circle delete-filter-btn pointer-hand"></i>'+'</span></li>';$(modalId+' #filters-list-box').append(filterElement);}
break;case'workspace':if(thirdFilterValue==='none'){var workspaceId=parseInt(secondFilterValue);if(workspaceFilters[workspaceId]===undefined||workspaceFilters[workspaceId]===null){workspaceFilters[workspaceId]=secondFilterName;updateIdsArray('workspace');var filterElement='<li class="filter-element" data-filter-type="workspace" data-filter-value="'+
workspaceId+'">'+'<span class="label label-danger">'+
secondFilterName+' <i class="fa fa-times-circle delete-filter-btn pointer-hand"></i>'+'</span></li>';$(modalId+' #filters-list-box').append(filterElement);}}else{var roleId=parseInt(thirdFilterValue);if(roleFilters[roleId]===undefined||roleFilters[roleId]===null){var roleFilterName=thirdFilterName+' ('+
secondFilterName+')';roleFilters[roleId]=roleFilterName;updateIdsArray('role');var filterElement='<li class="filter-element" data-filter-type="role" data-filter-value="'+
roleId+'">'+'<span class="label label-success">'+
roleFilterName+' <i class="fa fa-times-circle delete-filter-btn pointer-hand"></i>'+'</span>'+'</li>';$(modalId+' #filters-list-box').append(filterElement);}}
break;default:break;}
updateFiltersBadge();}
function deleteFilter(type,value)
{switch(type){case'group':groupFilters[value]=null;updateIdsArray('group');break;case'role':roleFilters[value]=null;updateIdsArray('role');break;case'workspace':workspaceFilters[value]=null;updateIdsArray('workspace');break;default:break;}
updateFiltersBadge();}
function checkSelectedUsers()
{for(var i=0;i<userIds.length;i++){$(modalId+' #picker-user-chk-'+userIds[i]['id']).prop('checked',true);}}
function uncheckUser(userId)
{$(modalId+' #picker-user-chk-'+userId).prop('checked',false);}
function updateSelectedUsersBadge()
{var nbUsers=userIds.length;$(modalId+' #selected-users-box-badge').html(nbUsers);if(nbUsers===0){$(modalId+' #picker-no-user-alert').show('slow',function(){});}else{$(modalId+' #picker-no-user-alert').hide('slow',function(){});}}
function updateFiltersBadge()
{var nbFilters=groupIds.length+roleIds.length+workspaceIds.length;$(modalId+' #filters-box-badge').html(nbFilters);if(nbFilters===0){$(modalId+' #picker-no-filter-alert').show('slow',function(){});}else{$(modalId+' #picker-no-filter-alert').hide('slow',function(){});}}
function addUserToSelectedUsersBox(userId,name)
{$(modalId+' #selected-user-label-'+userId).remove();var element='<li class="user-element" id="selected-user-label-'+
userId+'">'+'<span class="label label-primary">'+
name+' <i class="fa fa-times-circle remove-selected-user-btn pointer-hand" data-user-id="'+
userId+'"></i>'+'</span></li>';$(modalId+' #selected-users-list-box').append(element);}
function removeUserFromSelectedUsersBox(userId)
{$(modalId+' #selected-user-label-'+userId).remove();}
function emptySelectedUsersBox()
{$(modalId+' #selected-users-list-box').empty();}
function refreshUsersList()
{var route=currentSearch===''?Routing.generate('claro_users_list_for_user_picker',{'max':currentMax,'orderedBy':currentOrderedBy,'order':currentOrder,'mode':userPicker.multiple,'showAllUsers':userPicker.showAllUsers,'showId':userPicker.showId,'showPicture':userPicker.showPicture,'showUsername':userPicker.showUsername,'showMail':userPicker.showMail,'showCode':userPicker.showCode,'showGroups':userPicker.showGroups,'showPlatformRoles':userPicker.showPlatformRoles,'attachName':userPicker.attachName}):Routing.generate('claro_searched_users_list_for_user_picker',{'search':currentSearch,'max':currentMax,'orderedBy':currentOrderedBy,'order':currentOrder,'mode':userPicker.multiple,'showAllUsers':userPicker.showAllUsers,'showId':userPicker.showId,'showPicture':userPicker.showPicture,'showUsername':userPicker.showUsername,'showMail':userPicker.showMail,'showCode':userPicker.showCode,'showGroups':userPicker.showGroups,'showPlatformRoles':userPicker.showPlatformRoles,'attachName':userPicker.attachName});route+='?'+$.param(userPicker.parameters);$.ajax({url:route,type:'GET',success:function(datas){$(modalId+' #user-picker-users-list').html(datas);checkSelectedUsers();}});}
function initializeSelectedUsers()
{var matchedSelected=(userPicker.parameters['selectedUserIds'].length===selectedUserNames.length);for(var i=0;i<userPicker.parameters['selectedUserIds'].length;i++){var name=matchedSelected?selectedUserNames[i]:'???';selectedUsers[userPicker.parameters['selectedUserIds'][i]]=name;addUserToSelectedUsersBox(userPicker.parameters['selectedUserIds'][i],name);}
updateIdsArray('user');updateSelectedUsersBadge();checkSelectedUsers();}
modalElement.on('click','a',function(event){event.preventDefault();var element=event.currentTarget;var route=$(element).attr('href');route+='?'+$.param(userPicker.parameters);$.ajax({url:route,type:'GET',success:function(datas){$(modalId+' #user-picker-users-list').html(datas);checkSelectedUsers();}});});modalElement.on('click','#search-user-btn',function(){currentSearch=$(modalId+' #search-user-input').val();refreshUsersList();});modalElement.on('keypress','#search-user-input',function(e){if(e.keyCode===13){e.preventDefault();currentSearch=$(this).val();refreshUsersList();}});modalElement.on('change','#max-select',function(){currentMax=$(this).val();refreshUsersList();});modalElement.on('change','#filter-level-1',function(){filterType=$(this).val();displaySecondFilter();displayThirdFilter();displayFilterCreateButton();});modalElement.on('change','#filter-level-2',function(){secondFilterValue=$(this).val();secondFilterName=$(modalId+' #'+filterType+'-'+secondFilterValue).html();displayThirdFilter();displayFilterCreateButton();});modalElement.on('change','#filter-level-3',function(){thirdFilterValue=$(this).val();thirdFilterName=$(modalId+' #ws-role-'+thirdFilterValue).html();});modalElement.on('click','#filter-create-btn',function(){createFilter();resetFilters(true,true,true);refreshUsersList();});modalElement.on('click','.delete-filter-btn',function(){var parentElement=$(this).parents('.filter-element');var type=parentElement.data('filter-type');var value=parentElement.data('filter-value');deleteFilter(type,parseInt(value));parentElement.remove();refreshUsersList();});modalElement.on('click','.picker-user-chk',function(){var userId=$(this).val();if(userPicker.multiple==='multiple'){if($(this).prop('checked')){var firstName=$(this).data('user-first-name');var lastName=$(this).data('user-last-name');if(parseInt(userPicker.showUsername)===1){var username=$(this).data('user-username');selectedUsers[userId]=firstName+' '+lastName+' ('+username+')';}else{selectedUsers[userId]=firstName+' '+lastName;}
addUserToSelectedUsersBox(userId,selectedUsers[userId]);}else{selectedUsers[userId]=null;removeUserFromSelectedUsersBox(userId);}}else if(userPicker.multiple==='single'){var firstName=$(this).data('user-first-name');var lastName=$(this).data('user-last-name');emptySelectedUsersBox();selectedUsers=[];if(parseInt(userPicker.showUsername)===1){var username=$(this).data('user-username');selectedUsers[userId]=firstName+' '+lastName+' ('+username+')';}else{selectedUsers[userId]=firstName+' '+lastName;}
addUserToSelectedUsersBox(userId,selectedUsers[userId]);}
updateIdsArray('user');updateSelectedUsersBadge();});modalElement.on('click','#picker-all-users-chk',function(){if($(this).prop('checked')){$(modalId+' .picker-user-chk').each(function(){$(this).prop('checked',true);var userId=$(this).val();var firstName=$(this).data('user-first-name');var lastName=$(this).data('user-last-name');var username=$(this).data('user-username');selectedUsers[userId]=firstName+' '+lastName+' ('+username+')';addUserToSelectedUsersBox(userId,selectedUsers[userId]);});}else{$(modalId+' .picker-user-chk').each(function(){$(this).prop('checked',false);var userId=$(this).val();selectedUsers[userId]=null;removeUserFromSelectedUsersBox(userId);});}
updateIdsArray('user');updateSelectedUsersBadge();});modalElement.on('click','.picker-user-select',function(){var userId=$(this).data('user-id');$(modalId+' #picker-user-chk-'+userId).trigger('click');});modalElement.on('click','.remove-selected-user-btn',function(){var userId=$(this).data('user-id');selectedUsers[userId]=null;removeUserFromSelectedUsersBox(userId);uncheckUser(userId);updateIdsArray('user');updateSelectedUsersBadge();});modalElement.on('click','.submit',function(){if(userPicker.returnDatas){var ids=[];for(var i=0;i<userIds.length;i++){ids[i]=parseInt(userIds[i]['id']);}
var params={};params.userIds=ids;var route=Routing.generate('claro_users_infos_request');route+='?'+$.param(params);$.ajax({url:route,type:'GET',success:function(datas){(datas.length>0)?userPicker.callBack(datas):userPicker.callBack(null);}});}else{if(userPicker.multiple==='multiple'){var ids=[];var names=[];for(var i=0;i<userIds.length;i++){ids[i]=parseInt(userIds[i]['id']);names[i]=userIds[i]['name'];}
$('#user-picker-input-'+userPicker.pickerName).val(ids).trigger('input');$('#user-picker-input-view-'+userPicker.pickerName).val(names).trigger('input');(ids.length>0)?userPicker.callBack(ids):userPicker.callBack(null);}else if(userPicker.multiple==='single'){if(userIds.length>0){$('#user-picker-input-'+userPicker.pickerName).val(parseInt(userIds[0]['id'])).trigger('input');$('#user-picker-input-view-'+userPicker.pickerName).val(userIds[0]['name']).trigger('input');userPicker.callBack(userIds[0]['id']);}else{$('#user-picker-input-'+userPicker.pickerName).val(null).trigger('input');$('#user-picker-input-view-'+userPicker.pickerName).val(null).trigger('input');userPicker.callBack(null);}}}
modalElement.modal('hide');});initializeSelectedUsers();}});};